!function(e){var t={};function n(o){if(t[o])return t[o].exports;var i=t[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(o,i,function(t){return e[t]}.bind(null,i));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=4)}([function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function a(e){try{c(o.next(e))}catch(e){r(e)}}function s(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.isNil=t.combine=t.mergeDeep=t.pick=t.omit=t.timeAgo=t.getTodayDate=t.formatNotionDateToIsoDate=t.formatDateToNotionDate=t.arrayMove=t.getChipColor=t.throttle=t.sleep=t.print=t.makeid=t.call=t.dataURItoBlob=t.ConcurrentQueue=t.promisifyCallback=t.promisify=t.a2r=t.sortByKey=void 0;const i=n(8);t.sortByKey=function(e,t){return e.sort((function(e,n){var o=e[t],i=n[t];return o&&i?o<i?-1:o>i?1:0:1}))},t.a2r=function(e,t){let n={};return e.forEach(e=>{"string"==typeof e?n[e]=e:n[e[t]]=e}),n},t.promisify=function(e){return new Promise((t,n)=>{e(t)})},t.promisifyCallback=function(e,t){return new Promise((n,o)=>{e(t,n)})};t.ConcurrentQueue=class{constructor(e=1){this.running=0,this.taskQueue=[],this._resolve=null,this.concurrency=e}_checkDone(){return o(this,void 0,void 0,(function*(){this._resolve&&0==this.running&&0==this.taskQueue.length&&(this._resolve(),this._resolve=null)}))}_runTask(e){return o(this,void 0,void 0,(function*(){this.running++;try{yield e()}catch(e){(0,t.print)("error",e)}this.running--,this.taskQueue.length>0&&this._runTask(this.taskQueue.shift()),this._checkDone()}))}_enqueueTask(e){this.taskQueue.push(e)}push(e){this.running<this.concurrency?this._runTask(e):this._enqueueTask(e)}totallyEmpty(){return o(this,void 0,void 0,(function*(){return new Promise(e=>{if(this._resolve)throw"error queue only one";this._resolve=e,this._checkDone()})}))}},t.dataURItoBlob=function(e){for(var t=atob(e.split(",")[1]),n=[],o=0;o<t.length;o++)n.push(t.charCodeAt(o));return new Blob([new Uint8Array(n)],{type:"image/jpeg"})},t.call=function(e){new Promise((t,n)=>{t(e())})},t.makeid=function(e){for(var t="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",o=n.length,i=0;i<e;i++)t+=n.charAt(Math.floor(Math.random()*o));return t},t.print=(...e)=>{};t.sleep=e=>o(void 0,void 0,void 0,(function*(){return new Promise(t=>setTimeout(t,e))})),t.throttle=function(e,t){let n,o,i;return(...r)=>{const a=new Date;return o&&(o(void 0),clearTimeout(i),o=null),new Promise(s=>{const c=n?Math.max(0,t-(a.getTime()-n.getTime())):0;o=s,i=setTimeout((function(){n=a,o=null,s(e.apply(null,r))}),c)})}},t.getChipColor=function(e){return e.color in i.notionColors?i.notionColors[e.color]:i.notionColors.default};t.arrayMove=(e,t,n)=>(((e,t,n)=>{const o=n<0?e.length+n:n,i=e.splice(t,1)[0];e.splice(o,0,i)})(e=e.slice(),t,n),e),t.formatDateToNotionDate=function(e){let t="string"==typeof e?new Date(e):e;var n=new Date(t.getTime()),o=String(n.getDate()).padStart(2,"0"),i=String(n.getMonth()+1).padStart(2,"0");return n.getFullYear()+"-"+i+"-"+o},t.formatNotionDateToIsoDate=function(e){return new Date(e).toISOString()},t.getTodayDate=function(e=0){var t=new Date,n=new Date(t.getTime()+864e5*e),o=String(n.getDate()).padStart(2,"0"),i=String(n.getMonth()+1).padStart(2,"0");return n.getFullYear()+"-"+i+"-"+o},t.timeAgo=function(e){const t=new Date;var n=Date.parse(t.toString())-Date.parse(e.toString());const o=e=>e>1?"s":"";if(n<6e4)return"just now";if(n<36e5){const e=Math.round(n/6e4);return e+` minute${o(e)} ago`}if(n<864e5){const e=Math.round(n/36e5);return Math.round(n/36e5)+` hour${o(e)} ago`}if(n<2592e6){const e=Math.round(n/864e5);return e+` day${o(e)} ago`}if(n<31536e6){const e=Math.round(n/2592e6);return e+` month${o(e)} ago`}{const e=Math.round(n/31536e6);return e+` year${o(e)} ago`}};function r(e){return e&&"object"==typeof e&&!Array.isArray(e)}function a(e,...t){if(!t.length)return e;const n=t.shift();if(r(e)&&r(n))for(const t in n)r(n[t])?(e[t]||Object.assign(e,{[t]:{}}),a(e[t],n[t])):Object.assign(e,{[t]:n[t]});return a(e,...t)}t.omit=(e,...t)=>{const n={};let o;for(o in e)t.includes(o)||(n[o]=e[o]);return n},t.pick=function(e,...t){const n={};for(const o of t)o in e&&(n[o]=e[o]);return n},t.mergeDeep=a,t.combine=function(e){return e.reduce((e,t)=>a(e,t),{})},t.isNil=function(e){return null==e}},function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function a(e){try{c(o.next(e))}catch(e){r(e)}}function s(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((o=o.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.db=t.migrations=void 0;const r=n(0),a=n(48),s=n(6),c=n(49),l=n(50),u=n(51),d=n(52),p=n(53),h=n(54),f=n(55),v=n(56),g=n(57),m=n(2),y=n(58),b=n(83),_=n(16),w=i(n(37));function C(e,t){return Object.keys(e).reduce((n,o)=>n&&(0,w.default)(e[o],t[o]),!0)}t.migrations=[{db:u.databaseV1,migration:c.migrationV1},{db:a.databaseV2,migration:l.migrationV2},{db:d.databaseV3,migration:p.migrationV3},{db:h.databaseV4,migration:f.migrationV4},{db:v.databaseV5,migration:g.migrationV5},{db:y.databaseV6,migration:b.migrationV6}],t.db=(0,s.rootDatabase)(Object.assign(Object.assign({},y.databaseV6),{custom:{saveUser(e){return o(this,void 0,void 0,(function*(){const n=yield t.db.user.load();return n&&C(e,n)?e:yield t.db.user.save(e)}))},saveForm(e){return o(this,void 0,void 0,(function*(){const n=e.collection,i=e.page;yield Promise.all([n&&t.db.notionCollection.save(n.id,n),i&&t.db.notionPage.save(i.id,i),(()=>o(this,void 0,void 0,(function*(){const o=Object.assign(Object.assign(Object.assign(Object.assign({},(0,r.omit)(e,"collection","page","daps")),n&&{notionCollectionId:n.id,notionParentCollectionId:n.parent_id}),i&&{notionPageId:i.id}),{fields:e.daps}),a=yield t.db.form.get(e.id);a&&C(o,a)||(yield t.db.form.save(e.id,o))})))()])}))},createCapturedWebpage(e){return o(this,void 0,void 0,(function*(){let n=null;return e.url&&(n=(0,_.cleanupUrl)(e.url),yield t.db.urlToCapturedWebpage.save(n,{url:n,capturedWebpageId:e.capturedWebpageId})),yield t.db.capturedWebpage.save(e.capturedWebpageId,Object.assign(Object.assign(Object.assign({},e.savingTo&&{savingTo:e.savingTo,notionBookmarkId:e.notionBookmarkId}),{id:e.capturedWebpageId,url:n,title:e.title,notionCollectionId:e.notionCollectionId,notionPageId:e.notionPageId,notionSpaceId:e.notionSpaceId,icon:e.icon,clipFormat:m.ClipFormat.bookmark,formId:e.formId,notionListAfterId:e.notionListAfterId,createdAt:(new Date).toISOString(),highlights:[]}),e.source&&{source:e.source}))}))},createHighlight(e){return o(this,void 0,void 0,(function*(){const n=yield t.db.capturedWebpage.get(e.capturedWebpageId);if(!n)throw new Error("capturedWebpage not found");yield t.db.capturedWebpage.save(e.capturedWebpageId,Object.assign(Object.assign({},n),{highlights:[...n.highlights,e.id]}));const o=Object.assign(Object.assign({},e),{id:e.id,_sync:"pending"});return yield t.db.highlight.save(e.id,o),o}))}}}))},function(e,t,n){"use strict";var o,i;Object.defineProperty(t,"__esModule",{value:!0}),t.NotionBlockBackgroundColor=t.clipOptionsMap=t.premiumFeatureClipOptionMap=t.showCountClipOptionMap=t.ClipOption=t.ClipIntegration=t.ClipFormat=t.HighlightFormat=void 0,function(e){e.bullet="bullet",e.code="code",e.quote="quote"}(t.HighlightFormat||(t.HighlightFormat={})),function(e){e.extractFullPage="extractFullPage",e.bookmark="bookmark"}(t.ClipFormat||(t.ClipFormat={})),function(e){e.twitter="twitter",e.youtube="youtube",e.gmail="gmail"}(o=t.ClipIntegration||(t.ClipIntegration={})),function(e){e.noClip="noClip",e.defaultClip="defaultClip",e.selectZone="selectZone",e.clipTweet="clipTweet",e.clipYoutubeVideo="clipYoutubeVideo",e.clipTwitterThread="clipTwitterThread",e.clipMail="clipMail",e.clipMailConversation="clipMailConversation"}(i=t.ClipOption||(t.ClipOption={})),t.showCountClipOptionMap={[i.clipTwitterThread]:!0},t.premiumFeatureClipOptionMap={[i.clipTwitterThread]:!0},t.clipOptionsMap={[o.twitter]:[i.noClip,i.clipTweet,i.clipTwitterThread],[o.youtube]:[i.noClip,i.clipYoutubeVideo],[o.gmail]:[i.noClip,i.clipMail]},function(e){e.default="default"}(t.NotionBlockBackgroundColor||(t.NotionBlockBackgroundColor={}))},function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function a(e){try{c(o.next(e))}catch(e){r(e)}}function s(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.executeAsyncScript=t.executeClipContent=t.executeQuickCapture=t.executeClipper=t.executeScriptV2=t.executeScript=t.executeCode=void 0;const i=n(4),r=n(5),a=n(0),s=n(22);function c(e,t){return o(this,void 0,void 0,(function*(){const n=t||(yield(0,r.currentTab)()).id;return yield new Promise(t=>chrome.tabs.executeScript(n,{code:e},e=>{t(e[0])}))}))}function l(e,t){return o(this,void 0,void 0,(function*(){return yield new Promise(n=>chrome.tabs.executeScript(t,{file:"/"+e},e=>{n(e[0])}))}))}t.executeCode=c,t.executeScript=function(e,t){return o(this,void 0,void 0,(function*(){const n=t||(yield(0,r.currentTab)());return yield new Promise(t=>chrome.tabs.executeScript(n.id,{file:"/"+e},e=>{t(e[0])}))}))},t.executeScriptV2=l,t.executeClipper=function(e,t){return o(this,void 0,void 0,(function*(){return yield c(e,t),l("clipper.js",t)}))},t.executeQuickCapture=function(e,t){return o(this,void 0,void 0,(function*(){return l("content/content.js",t)}))},t.executeClipContent=function(e,t){return o(this,void 0,void 0,(function*(){return yield c(e,t),l("clipContent.js",t)}))},t.executeAsyncScript=function(e,t,n){return o(this,void 0,void 0,(function*(){const c=yield(0,r.currentTab)(),l=Math.floor(65536*(1+Math.random())).toString(16).substring(1);return yield new Promise(r=>chrome.tabs.executeScript(c.id,{code:`\n        var idName = "${(0,s.getIdName)()}";\n        var asyncId = '${l}';\n        var extraParamsJson = ${n&&`'${JSON.stringify(n)}'`||"null"};\n        `},()=>(i.asyncIds[l]=e=>o(this,void 0,void 0,(function*(){const n=yield t(e);return n&&(r(n),delete i.asyncIds[l]),(0,a.print)("receive",n),n})),chrome.tabs.executeScript(c.id,{file:"/"+e},e=>((0,a.print)("received",e),!0)))))}))}},function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function a(e){try{c(o.next(e))}catch(e){r(e)}}function s(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.addContextMenuRightClick=t.asyncIds=t.isFirefox=t.extpay=void 0,n(45);const i=n(0),r=n(46),a=n(44),s=n(21),c=n(18),l=n(1);function u(){chrome.contextMenus.create({title:"Save Page to Notion",id:"stn_save_page",contexts:["page"],documentUrlPatterns:["*://*/*"]}),t.isFirefox||(chrome.contextMenus.create({title:"Take Full Page Screenshot",id:"stn_take_full_page_screenshot",contexts:["page"],documentUrlPatterns:["*://*/*"]}),chrome.contextMenus.create({title:"Select Zone to Screenshot",id:"stn_select_zone_screenshot",contexts:["page"],documentUrlPatterns:["*://*/*"]}))}t.extpay={getUser(){return o(this,void 0,void 0,(function*(){return null}))},openPaymentPage(){return o(this,void 0,void 0,(function*(){}))}},t.isFirefox=!(null===chrome||void 0===chrome?void 0:chrome.app),t.asyncIds={},chrome.contextMenus.create({title:"Add Highlight",id:"stn_add_highlights",contexts:["selection"],documentUrlPatterns:["*://*/*"]}),t.addContextMenuRightClick=u,u(),function(){o(this,void 0,void 0,(function*(){chrome.browserAction.onClicked.addListener(a.injectPopupIframe),chrome.contextMenus.onClicked.addListener(s.contextMenuOnClick),chrome.commands.onCommand.addListener(s.takeHighlightOrNoteByCommand),chrome.runtime.onMessage.addListener(r.handleMessage),chrome.runtime.onInstalled.addListener(e=>o(this,void 0,void 0,(function*(){l.db.info.save({installedAt:(new Date).toISOString()})}))),chrome.runtime.onConnect.addListener(r.handleSocketCommunication),(0,c.checkUserHasTabsPermission)().then(e=>o(this,void 0,void 0,(function*(){e&&(yield(0,i.sleep)(1e3),(0,c.turnOnSavedPageBadgeChecking)())}))),(0,c.checkCanHaveQuickCaptureFloatingButton)().then(e=>o(this,void 0,void 0,(function*(){e&&(0,c.startCaptureWatch)()})))}))}()},function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function a(e){try{c(o.next(e))}catch(e){r(e)}}function s(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.currentTab=void 0,t.currentTab=function(){return o(this,void 0,void 0,(function*(){return new Promise((e,t)=>{try{chrome.tabs.query({currentWindow:!0,active:!0},(function(t){e(t[0])}))}catch(e){t(e)}})}))}},function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function a(e){try{c(o.next(e))}catch(e){r(e)}}function s(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((o=o.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.removeOldStorageKeys=t.rootDatabase=t.rootConfig=t.genSingle=t.genCrud=void 0;const r=n(28),a=i(n(7)),s=n(20),c=n(1);function l({oldDatabase:e,newDatabase:t,migration:n}){return o(this,void 0,void 0,(function*(){(0,s.log)("migration step 1 - load data");const i=yield function(e){return o(this,void 0,void 0,(function*(){return Object.fromEntries(yield Promise.all(Object.keys(e).map(t=>o(this,void 0,void 0,(function*(){const n=yield"crud"==e[t].type?e[t].all():e[t].load();return[t,n]})))))}))}(e);(0,s.log)("migration step 2 - run migration code");const r=yield n.up(i,a.default);(0,s.log)("migration step 3 - remove old storage keys",r),yield Promise.all(n.storageKeysToRemove.map(e=>a.default.remove(e))),(0,s.log)("migration step 4 - add data to database",r),yield function(e,t){return o(this,void 0,void 0,(function*(){const n=Object.keys(e).flatMap(n=>{var o;return"crud"==e[n].type?Object.keys(null!==(o=t[n])&&void 0!==o?o:[]).map(o=>e[n].save(o,t[n][o])):[e[n].save(t[n])]});return yield Promise.all(n),t}))}(t,r)}))}function u(e){return(...n)=>o(this,void 0,void 0,(function*(){return t.rootConfig||(t.rootConfig=yield a.default.get("rootConfig",{migration:0}),yield function(){return o(this,void 0,void 0,(function*(){if(!(t.rootConfig.migration>=c.migrations.length))for(let e=t.rootConfig.migration;e<c.migrations.length;e++)yield(0,r.logWrapper)("run migration "+e,()=>o(this,void 0,void 0,(function*(){var t;yield l({oldDatabase:(null===(t=c.migrations[e-1])||void 0===t?void 0:t.db)||{},newDatabase:c.migrations[e].db,migration:c.migrations[e].migration})}))),yield a.default.set("rootConfig",{migration:e+1})}))}()),e(...n)}))}t.genCrud=function(e,t,n=a.default){return{type:"crud",_t:t,get:o=>n.get(`data-${e}-${o}`,t),save:(t,i,r)=>o(this,void 0,void 0,(function*(){return yield n.set(`data-${e}-${t}`,i,!(null==r?void 0:r.noSync)),i})),remove:t=>o(this,void 0,void 0,(function*(){yield n.remove(`data-${e}-${t}`)})),delete:t=>o(this,void 0,void 0,(function*(){yield n.remove(`data-${e}-${t}`)})),all:()=>o(this,void 0,void 0,(function*(){return Object.fromEntries(Object.entries(yield n.getAll(new RegExp(`^data-${e}.*$`))).map(([t,n])=>[t.replace(`data-${e}-`,""),n]))})),syncSet:i=>o(this,void 0,void 0,(function*(){const o=yield n.get(`data-${e}-${i}`,t);yield n.syncSet(`data-${e}-${i}`,o,!0)}))}},t.genSingle=function(e,t,n=a.default,i){return{type:"single",_t:t,load:()=>n.get("data-"+e,t),save:(r,a)=>o(this,void 0,void 0,(function*(){const o=yield n.get("data-"+e,t),s=Object.assign(Object.assign({},o),r);return yield n.set("data-"+e,s,!(null==a?void 0:a.noSync)&&(i&&Object.keys(r).some(e=>i.includes(e)))),s})),remove:()=>o(this,void 0,void 0,(function*(){yield n.remove("data-"+e)})),syncSave:()=>o(this,void 0,void 0,(function*(){const o=yield n.get("data-"+e,t);yield n.syncSet("data-"+e,o,!0)}))}},t.rootConfig=null,t.rootDatabase=function(e){let t={};return Object.entries(e).forEach(([e,n])=>{t[e]=Object.fromEntries(Object.entries(n).map(([e,t])=>[e,"_t"===e||"type"===e?t:u(t)]))}),t},t.removeOldStorageKeys=function(e){return Promise.all(e.map(e=>a.default.remove(e)))}},function(e,t,n){"use strict";var o,i,r,a,s=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function a(e){try{c(o.next(e))}catch(e){r(e)}}function s(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.remove=t.set=t.getAll=t.get=void 0;const c=n(0);function l(e,t){return 0===t?e:e+"_"+t}const u=(null===(i=null===(o=chrome.storage)||void 0===o?void 0:o.sync)||void 0===i?void 0:i.QUOTA_BYTES_PER_ITEM)||8192,d=(null===(a=null===(r=chrome.storage)||void 0===r?void 0:r.sync)||void 0===a?void 0:a.MAX_ITEMS)||512;function p(e,t){var n,o="";let i=!1;for(n=0;n<d&&void 0!==t[l(e,n)];n++)i=!0,o+=t[l(e,n)];if(i)return JSON.parse(o)}function h(e,t){return s(this,void 0,void 0,(function*(){return new Promise(n=>{!function(e,t,n){chrome.storage.local.get(null,(function(o){const i=p(e,o);void 0!==i?t(i):n()}))}(e,e=>{n(e)},()=>s(this,void 0,void 0,(function*(){(0,c.print)("no value found, saving default"),yield v(e,t),n(t)})))})}))}function f(e){return s(this,void 0,void 0,(function*(){return new Promise(t=>{chrome.storage.local.get(null,(function(n){const o=Object.keys(n).filter(t=>function(e){return!1===/.*_\d+$/g.test(e)}(t)&&e.test(t)).map(e=>[e,p(e,n)]).filter(([e,t])=>!(0,c.isNil)(t));t(Object.fromEntries(o))}))})}))}function v(e,t=null){return s(this,void 0,void 0,(function*(){new Promise(n=>{!function(e,t,n){var o,i,r=0,a={};let s=JSON.stringify(t),c=[];for(;s.length>0;)i=l(e,r),o=s.substr(0,u-i.length-2),c.push(o.length),a[i]=o,s=s.substr(u-i.length-2),r++;chrome.storage.local.set(a,n),chrome.storage.local.remove(l(e,r))}(e,t,()=>{n()})})}))}function g(e){return s(this,void 0,void 0,(function*(){new Promise(t=>{!function(e,t){chrome.storage.local.get(null,(function(n){var o,i=[];for(o=0;o<d&&void 0!==n[l(e,o)];o++)i.push(l(e,o));chrome.storage.local.remove(i,()=>{t()})}))}(e,()=>{t()})})}))}t.get=h,t.getAll=f,t.set=v,t.remove=g,t.default={set:v,get:h,getAll:f,remove:g,syncSet:(e,t=null)=>s(void 0,void 0,void 0,(function*(){return null}))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.errorCodesMap=t.randomNotionColor=t.notionColors=t.NOTION_ACTIVE_USER_ID=t.NOTION_CLIENT_DATA_KEY=t.COOKIE_KEY=t.WHATS_NEW_LINK=t.APP_VERSION_FULL=t.APP_VERSION=t.APP_NAME_SLUG=t.APP_NAME=void 0,t.APP_NAME="Save to Notion",t.APP_NAME_SLUG="save-to-notion",t.APP_VERSION="1.1.4",t.APP_VERSION_FULL="1.1.4",t.WHATS_NEW_LINK="https://www.notion.so/What-s-new-Save-To-Notion-b85cff00e8c24b10a893a6aa18a887fa",t.COOKIE_KEY="cookie",t.NOTION_CLIENT_DATA_KEY="notion-client-data-v2",t.NOTION_ACTIVE_USER_ID="notion-active-user-id",t.notionColors={default:"rgba(206, 205, 202, 0.5)",gray:"rgba(155, 154, 151, 0.4)",brown:"rgba(140, 46, 0, 0.2)",yellow:"rgba(233, 168, 0, 0.2)",green:"rgba(0, 135, 107, 0.2)",orange:"rgba(245, 93, 0, 0.2)",blue:"rgba(0, 120, 223, 0.2)",purple:"rgba(103, 36, 222, 0.2)",pink:"rgba(221, 0, 129, 0.2)",red:"rgba(255, 0, 26, 0.2)"},t.randomNotionColor=function(){return Object.keys(t.notionColors)[Math.floor(Math.random()*Object.keys(t.notionColors).length)]},t.errorCodesMap={NO_INTERNET:"Wasn't able to send this item to Notion, ensure you are connected to internet",BACKGROUND_ON_SUBMIT_NOT_LOGGED_IN_TO_NOTION:"it seems you are not logged in to Notion, please log in and try again",BACKGROUND_FORMATING_ERROR:"Formatting error, please contact the developer",BACKGROUND_FAILED_TO_FETCH_NOTION_TEMPLATE:"failed to fetch the Notion Template, please check that it exists",BACKGROUND_FAILED_TO_CREATE_PAGE:"failed to create the page",BACKGROUND_FAILED_CODE:"An error occurred while saving the page. Please ensure you are logged in to notion.so in this browser with access to the correct workspace, then try again with the clipper.",BACKGROUND_TOKEN_EXPIRED:"Can't access the workspace - please go to notion.so on this browser and check you are logged in to the right workspace"}},function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function a(e){try{c(o.next(e))}catch(e){r(e)}}function s(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((o=o.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.getAllCollectionPages=t.addAtFirstCollectionPage=t.getCachedPageInCollection=t.upsertCachedCollectionPage=t.deleteCachedCollectionPage=t.getCachedCollectionPagesAndOrder=t.getCachedCollectionPages=t.getClientBackground=t.NotionClient=t.fetchNotionClient=t.decrypt=t.refreshCollection=t.applyRefreshCollectionOnData=t.applyRefreshCollection=t.throttle=t.loadTemplateBlocksMap=t.getTemplateBlocksMap=t.getUpToDateTemplateBlocksMap=t.getTransacOperationsFromWebClipping=t.getTransacOperationsFromTemplate=t.getHighlightData=t.getPageHighlightData=t.copyBlockOperation=t.saveForm=t.saveFormData=t.resetCurrentPopupState=t.getCurrentPopupState=t.saveCurrentPopupState=t.getFormData=t.getUpdatedFormDataWithCollection=t.FailingToGetWorkspaceException=t.FormCorruptedException=t.AlreadyTriedToLoadDatabaseException=t.FailingToLoadNotionCollectionException=t.FailingToLoadNotionPageException=t.FailingToLoadFormCorruptedException=t.FailingToLoadFormException=t.getClient=void 0;const r=n(8),a=n(28),s=n(29),c=n(30),l=n(1),u=i(n(7)),d=n(20),p=n(84),h=n(14),f=n(13),v=n(0),g=n(12),m=n(38);var y=n(17);Object.defineProperty(t,"getClient",{enumerable:!0,get:function(){return y.getClient}});class b extends s.CustomException{constructor(){super(...arguments),this.errorMsg="can't load the form"}}t.FailingToLoadFormException=b;class _ extends s.CustomException{constructor(){super(...arguments),this.errorMsg="Failed to load the form, please re-create another one"}}t.FailingToLoadFormCorruptedException=_;class w extends s.CustomException{constructor(){super(...arguments),this.errorMsg="can't fetch Notion page",this.helpMsg="ensure you are logged in the right workspace"}}t.FailingToLoadNotionPageException=w;class C extends s.CustomException{constructor(){super(...arguments),this.errorMsg="can't fetch Notion database",this.helpMsg="ensure you are logged in the right workspace"}}t.FailingToLoadNotionCollectionException=C;class O extends s.CustomException{constructor(){super(...arguments),this.errorMsg="Can't access Notion database",this.helpMsg="ensure you do have access to this database"}}t.AlreadyTriedToLoadDatabaseException=O;class I extends s.CustomException{constructor(){super(...arguments),this.errorMsg="Form Corrupted",this.helpMsg="please contact the developer"}}t.FormCorruptedException=I;class k extends s.CustomException{constructor(){super(...arguments),this.errorMsg="can't access database's workspace",this.helpMsg="go to notion.so and check you are logged in to the right workspace"}}function P(e,{client:t,saveToNotionClient:n,app:i}){return o(this,void 0,void 0,(function*(){return(0,a.logWrapper)(`fetch collection '${e.notionCollectionId}'`,()=>o(this,void 0,void 0,(function*(){(0,d.log)("refresh workspace"),yield t.refreshWorkspaces();const o=function(e,t){var n;const o=e.user.spaces.find(e=>e.id===t);return o?null===(n=o.user)||void 0===n?void 0:n.id:null}(t,e.spaceId);if((0,d.log)("userId",o,e.spaceId,t.user.spaces),null===o)throw new k;yield t.setActiveUserId(o),(0,d.log)("refresh collection");const r=yield B(t,{parent_id:e.notionParentCollectionId,id:e.notionCollectionId},e.fields,{checkTemplateUpToDate:(0,m.findTemplateFieldDefaultValue)(Object.assign(Object.assign({},e),{daps:e.fields}))}),a=Object.assign(Object.assign({},(0,v.omit)(e,"fields")),{userId:o,daps:e.fields,collection:r.collection});(0,d.log)("apply refresh on forms & save it");const s=F(r,a);return yield x(s),j(s.id,{client:t,saveToNotionClient:n,app:i,alreadyTriedToFetchDatabase:!0})})))}))}function j(e,{client:t,saveToNotionClient:n,app:i,alreadyTriedToFetchDatabase:r}){return o(this,void 0,void 0,(function*(){return(0,a.logWrapper)(`get form data for '${e}'`,()=>o(this,void 0,void 0,(function*(){var o;let a=yield l.db.form.get(e);if(!a){const t=yield null===(o=null==n?void 0:n.custom)||void 0===o?void 0:o.getForm(e);if(console.log("loaded form",e,a,t,i.getFormFromList(e)),!t)throw new _;yield l.db.form.save(e,t),a=yield l.db.form.get(e)}if(a.notionPageId){const e=yield l.db.notionPage.get(a.notionPageId);if(!e)throw new w;return Object.assign(Object.assign({},(0,v.omit)(a,"fields")),{page:e,daps:a.fields,collection:null})}if(!a.notionCollectionId||!a.notionParentCollectionId){const t=null==i?void 0:i.getFormFromList(e);if(!t||!t.notionCollectionId||!t.notionParentCollectionId)throw new I;a=Object.assign(Object.assign({},a),{notionCollectionId:t.notionCollectionId,notionParentCollectionId:t.notionParentCollectionId})}const s=yield l.db.notionCollection.get(a.notionCollectionId);if(!s){if(r)throw new O;try{return yield P(a,{client:t,saveToNotionClient:n,app:i})}catch(e){if(null==e?void 0:e.errorMsg)throw e;throw new C}}return Object.assign(Object.assign({},(0,v.omit)(a,"fields")),{daps:a.fields,collection:s})})))}))}function T(e){return o(this,void 0,void 0,(function*(){return u.default.set("popup-state",Object.assign(Object.assign({},e),{createdAt:Date.now(),lastUpdatedAt:Date.now()}))}))}function S(){return o(this,void 0,void 0,(function*(){return T(null)}))}function x(e){return o(this,void 0,void 0,(function*(){yield l.db.custom.saveForm(M(e))}))}function M(e){return Object.assign(Object.assign({},e),{collection:Object.assign({},e.collection),name:e.name.length&&e.name||"Untitled",daps:e.daps.filter(e=>null!=e.property)})}function A(e,t,n,o){const i=o||(0,g.v4)();let r={id:i,table:"block",path:[],command:"update",args:{}},a=[r];if("none"==e.role)return{id:i,ops:[Object.assign(Object.assign({},r),{args:{type:"text",parent_id:t}})]};let s=e.value;return r.args=Object.assign(Object.assign({},(0,v.omit)(s,"is_template","created_time","last_edited_time","content")),{id:i,parent_id:t,copied_from:s.id}),s.content,{id:i,ops:a}}function U(e){return o(this,void 0,void 0,(function*(){return yield u.default.get("page-"+e,null)}))}function E(e,t){return o(this,void 0,void 0,(function*(){let n=yield e.loadPageChunk({pageId:t});return yield u.default.set("TEMPLATE-"+t,n),n}))}t.FailingToGetWorkspaceException=k,t.getUpdatedFormDataWithCollection=P,t.getFormData=j,t.saveCurrentPopupState=T,t.getCurrentPopupState=function(e){return o(this,void 0,void 0,(function*(){const t=yield u.default.get("popup-state",null);if(!t)return t;S();const n=Date.now();switch(t.pos){case"fillForm":return t.url!=e||n-t.lastUpdatedAt>6e4?null:t;case"settings":return n-t.lastUpdatedAt>6e4?null:t}}))},t.resetCurrentPopupState=S,t.saveFormData=function(e,t,n,i,r,a){var s;return o(this,void 0,void 0,(function*(){let o,c=null!==(s=(yield l.db.user.load())["quickNote"==a?"quickCaptureForms":"forms"])&&void 0!==s?s:[],u=i?(d=i,Object.fromEntries(Object.keys(d).filter(e=>void 0!==d[e]).map(e=>[e,d[e]]))):void 0;var d;if("new"==t){let t=(0,v.makeid)(4);if(null==e?void 0:e.id)t=e.id;else for(;c.some(e=>e.id==t);)t=(0,v.makeid)(4);e.id=t,void 0!==r?c.splice(r,0,Object.assign({name:e.name,id:t},u||{})):c.push(Object.assign({name:e.name,id:t},u||{})),yield l.db.custom.saveUser("quickNote"==a?{quickCaptureForms:c}:{forms:c}),yield l.db.custom.saveForm(M(e)),o={id:t,name:e.name}}else c=c.map(t=>t.id!=n?t:Object.assign({name:e.name,id:n,favorite:!0===t.favorite},u||{})),o={id:n,name:e.name},yield l.db.custom.saveUser("quickNote"==a?{quickCaptureForms:c}:{forms:c}),yield l.db.custom.saveForm(M(e));return o}))},t.saveForm=x,t.copyBlockOperation=A,t.getPageHighlightData=U,t.getHighlightData=function(e){return o(this,void 0,void 0,(function*(){const t=yield U(e);return null==t?{success:!1,errorMsg:"page not saved"}:{success:!0,res:t}}))},t.getTransacOperationsFromTemplate=function(e,t,n){return o(this,void 0,void 0,(function*(){return A(e[t],void 0,0,n).ops}))},t.getTransacOperationsFromWebClipping=function(){return o(this,void 0,void 0,(function*(){return[]}))},t.getUpToDateTemplateBlocksMap=function e(t,n,i){return o(this,void 0,void 0,(function*(){let o;return i?((0,v.print)("refreshing the template..."),o=yield(0,p.fetchFullContentPage)(n,t.authToken),yield u.default.set("TEMPLATE-"+n,o)):(o=yield u.default.get("TEMPLATE-"+n,null),null==o?o=yield e(t,n,!0):(0,v.print)("got template from cache!")),(0,v.print)(o,"[43m -- content template [0m"),o}))},t.getTemplateBlocksMap=function(e,t,n){return o(this,void 0,void 0,(function*(){let o=yield u.default.get("TEMPLATE-"+t,null);return(null==o||n)&&(o=yield E(e,t)),o}))},t.loadTemplateBlocksMap=E,t.throttle=function(e,t){let n,o,i;return(...r)=>{const a=new Date;return o&&(o(void 0),clearTimeout(i),o=null),new Promise(s=>{const c=n?Math.max(0,t-(a.getTime()-n.getTime())):0;o=s,i=setTimeout((function(){n=a,o=null,s(e.apply(null,r))}),c)})}};const N=["pageCover","pageFrontImage","pageIcon","template","pageContent","content"];function D(e,t){var n;if((0,v.print)("result",e,t),e.needToResetCollection)return{daps:t,collection:void 0};let o=[];for(let i of t){let t,r=e.fieldsToModify.find(e=>e.key==i.key);if(i.property&&(N.some(e=>e==i.property.id)?((0,v.print)("reaplie",i.property),t=i.property,"template"==i.property.type&&e.needToRefreshTemplate&&(i.options.defaultValue=null===(n=e.collection)||void 0===n?void 0:n.template)):t=Object.assign(Object.assign({},e.collection.schema[i.property.id]),{id:i.property.id})),r)switch(r.action){case"remove":continue;case"removeDefaultValue":o.push(Object.assign(Object.assign({},i),{property:t,options:{}}))}else o.push(Object.assign(Object.assign({},i),{property:t}))}return{collection:e.collection,daps:o}}function F(e,t){const{collection:n,daps:o}=D(e,t.daps);return Object.assign(Object.assign(Object.assign(Object.assign({},t),{collection:n,daps:o}),e.needToRemoveTemplate&&{daps:o.map(e=>{var t;return"template"==(null===(t=e.property)||void 0===t?void 0:t.type)?Object.assign(Object.assign({},e),{options:Object.assign(Object.assign({},e.options),{defaultValue:null})}):e})}),{needToRefreshTemplate:e.needToRefreshTemplate})}function R(e,t){var n,i,r,a,s,c;return o(this,void 0,void 0,(function*(){const o=(yield e.loadPageChunk({pageId:t,limit:1,cursor:{stack:[[{id:t,table:"block",index:0}]]},chunkNumber:0,verticalColumns:!1})).recordMap.block[t];return o?((0,v.print)(o,"[43m -- get template info [0m"),{name:(0,f.getDepVal)(null===(n=null==o?void 0:o.value)||void 0===n?void 0:n.properties,"title","Untitled"),id:t,lastEditedTime:o.value.last_edited_time||Date.now(),icon:(null===(r=null===(i=o.value)||void 0===i?void 0:i.format)||void 0===r?void 0:r.page_icon)||null,properties:(null===(a=o.value)||void 0===a?void 0:a.properties)||null,fileIds:(null===(s=o.value)||void 0===s?void 0:s.file_ids)||null,format:(null===(c=o.value)||void 0===c?void 0:c.format)||null}):null}))}function B(e,t,n,i,r){var a,s;return o(this,void 0,void 0,(function*(){let o={needToResetCollection:!1,fieldsToModify:[]};if(r)o.collection=r;else{const n=yield e.loadPageChunk({pageId:t.parent_id,limit:1,cursor:{stack:[[{id:t.parent_id,table:"block",index:0}]]},chunkNumber:0,verticalColumns:!1});if(!n)throw new Error("refresh failed");if(!(t.id in((null===(a=null==n?void 0:n.recordMap)||void 0===a?void 0:a.collection)||{})))return o.needToResetCollection=!0,o;o.collection=n.recordMap.collection[t.id].value}let c=Object.assign(Object.assign({},o.collection),t.templatesInfo&&{templatesInfo:null!==(s=t.templatesInfo)&&void 0!==s?s:[]});if(i.getTemplatesInfo&&c.template_pages&&(c.templatesInfo=yield Promise.all(c.template_pages.map(t=>R(e,t)))),o.collection=c,i.checkTemplateUpToDate){if((c.template_pages||[]).some(e=>i.checkTemplateUpToDate.id)){let t=yield R(e,i.checkTemplateUpToDate.id);const n=t.lastEditedTime>i.checkTemplateUpToDate.lastEditedTime,r=!i.checkTemplateUpToDate.properties&&!i.checkTemplateUpToDate.format,a=n||r;(0,v.print)({doesNotHasPropertiesOrFormat:r,isOutdated:n},"checking template is up to date",i.checkTemplateUpToDate,t),a&&(o.needToRefreshTemplate=!0),o.collection.template=t}else o.needToRemoveTemplate=!0}let l=o.collection.schema;const u=yield e.getCollectionLocally(t.id,t.parent_id,l);for(let e of n)if(e.property){if(N.some(t=>t==e.property.id))continue;if(e.property.id in u.schema){let t=u.schema[e.property.id];if(e.property.type!=t.type)o.fieldsToModify.push({key:e.key,action:"removeDefaultValue"});else if(["select","status","multi_select"].includes(e.property.type))switch(e.property.type){case"select":case"status":!e.options.defaultSelectId||t.options&&t.options.some(t=>t.id==e.options.defaultSelectId)||o.fieldsToModify.push({key:e.key,action:"removeDefaultValue"});break;case"multi_select":!e.options.defaultSelectIds||t.options&&e.options.defaultSelectIds.every(e=>t.options.some(t=>t.id==e))||o.fieldsToModify.push({key:e.key,action:"removeDefaultValue"})}}else o.fieldsToModify.push({key:e.key,action:"remove"})}return o}))}function W(e){try{return window.btoa(e)}catch(t){return e}}function L(e){try{return window.atob(e)}catch(t){return e}}function V(e,t){return o(this,void 0,void 0,(function*(){try{yield e.fetchUserInfos()}catch(e){return{status:"error",errorMsg:"cookie_expired"}}return yield u.default.set(r.NOTION_CLIENT_DATA_KEY,W(JSON.stringify(e.user))),yield u.default.set(r.COOKIE_KEY,W(t)),{status:"ok",client:e}}))}t.applyRefreshCollection=D,t.applyRefreshCollectionOnData=F,t.refreshCollection=B,t.decrypt=L,t.fetchNotionClient=V;class ${constructor(e){this.authToken=e,this.user={id:null,spaces:[],givenName:null,spacesMap:{}}}bg(e,t){return new Promise(n=>{chrome.runtime.sendMessage({type:"notion",cmd:e,params:t},e=>{n(e.data)})})}searchCollections(...e){return this.bg("searchCollections",e)}getWorkspaces(){return this.bg("getWorkspaces",[])}setCacheUser(){return o(this,void 0,void 0,(function*(){return u.default.set(r.NOTION_CLIENT_DATA_KEY,W(JSON.stringify(this.user)))}))}refreshWorkspaces(){return o(this,void 0,void 0,(function*(){const e=yield this.getWorkspaces();if(null!=e){let t=(0,v.a2r)(this.user.spaces||[],"id");this.user.spaces=e.map(e=>e.id in t?Object.assign(Object.assign({},t[e.id]),e):e);for(let e of this.user.spaces)this.user.spacesMap[e.id]=e;yield this.setCacheUser()}return this.user.spaces}))}refreshSpacePersons(e){return o(this,void 0,void 0,(function*(){const t=yield this.getSpacePersons({spaceId:e});return this.user.spaces.forEach((n,o)=>{n.id==e&&(this.user.spaces[o]=Object.assign(Object.assign({},n),{persons:t}),this.user.spacesMap[n.id]=n)}),yield this.setCacheUser(),{user:this.user,persons:t}}))}_submitTransaction(...e){return this.bg("_submitTransaction",e)}setActiveUserId(e){return this.bg("setActiveUserId",[e])}fetchUserInfos(){return o(this,void 0,void 0,(function*(){const e=yield this.bg("loadUserContent",[{}]);(0,v.print)("got",e);let t=Object.keys(e.recordMap.notion_user);this.user.id=t[0];let n=e.recordMap.notion_user[this.user.id];this.user.givenName=n.value.given_name,(0,v.print)("loadUSerContent.space",e.recordMap.space);for(let t in e.recordMap.space){let n={id:t,name:e.recordMap.space[t].value.name};this.user.spaces.push(n),this.user.spacesMap[t]=n}}))}searchCollectionPages(...e){return this.bg("searchCollectionPages",e)}createRecord(...e){return this.bg("createRecord",e)}addValueToPropertyCollection(...e){return this.bg("addValueToPropertyCollection",e)}loadPageChunk(...e){return this.bg("loadPageChunk",e)}getCollectionLocally(e,t,n){return o(this,void 0,void 0,(function*(){let o=new h.Collection(e,"",t,this);return o.initLocally(n),o}))}setUserInfos(e){this.user=e}getSpacePersons({spaceId:e}){return this.bg("getSpacePersons",[{spaceId:e}])}}t.NotionClient=$,t.getClientBackground=function(e){return o(this,void 0,void 0,(function*(){let t;const n=yield(0,v.promisifyCallback)(c.chromeCookiesGet,{url:"https://www.notion.so",name:"token_v2"});if(!n)return{status:"error",errorMsg:"need_to_login_to_notion"};const o=n.value;let i=yield u.default.get(r.COOKIE_KEY,null);i&&(i=L(i));let a=yield u.default.get(r.NOTION_CLIENT_DATA_KEY,null);return a&&(a=JSON.parse(L(a))),t=new $(o),i&&i==o&&a&&null!=!a.spacesMap?(t.setUserInfos(a),{status:"ok",client:t}):(yield u.default.remove(r.NOTION_CLIENT_DATA_KEY),yield u.default.remove(r.COOKIE_KEY),e&&e("fetching_client"),yield V(t,o))}))};const H={},q={};function K(e){return o(this,void 0,void 0,(function*(){if(e in H)return H[e].map;const t=yield u.default.get("collection-pages-"+e,{count:0,map:{},order:[]});return H[e]=t,t.map}))}function z(e,t){return o(this,void 0,void 0,(function*(){yield K(e);const n=H[e];q[e]||(t&&(n.order=[t,...n.order.filter(e=>e!=t)]),q[e]=setTimeout(()=>o(this,void 0,void 0,(function*(){let t=n.map;const o=Object.fromEntries(n.order.map((e,t)=>[e,t])),i=Object.keys(t).sort((e,n)=>{var i,r;const a=null!==(i=o[e])&&void 0!==i?i:-1,s=null!==(r=o[n])&&void 0!==r?r:-1;return a>=0&&s>=0?a-s:a>=0?-1:s>=0?1:t[e].name.toLowerCase()<t[n].name.toLowerCase()?-1:1});let r={};i.forEach(e=>r[e]=n.map[e]),n.map=r,yield u.default.set("collection-pages-"+e,Object.assign(Object.assign({},n),{map:r})),q[e]=null})),200))}))}t.getCachedCollectionPages=K,t.getCachedCollectionPagesAndOrder=function(e){return o(this,void 0,void 0,(function*(){if(e in H)return{map:H[e].map,order:H[e].order};const t=yield u.default.get("collection-pages-"+e,{count:0,map:{},order:[]});return H[e]=t,{map:t.map,order:t.order}}))},t.deleteCachedCollectionPage=function(e,t){return o(this,void 0,void 0,(function*(){const n=yield K(t),o=H[t];return e in n&&(delete n[e],o.count--,o.order=o.order.filter(t=>t!=e),z(t),!0)}))},t.upsertCachedCollectionPage=function(e,t){return o(this,void 0,void 0,(function*(){const n=yield K(t),o=H[t];if(!(e.id in n)){if(o.count>300){let e=Object.keys(o.map);delete o.map[e[e.length-1]],o.order=o.order.filter(t=>t!=e[e.length-1]),o.count--}o.count++,o.order=[e.id,...o.order]}return n[e.id]=e,z(t),n}))},t.getCachedPageInCollection=function(e,t){return o(this,void 0,void 0,(function*(){return(yield K(t))[e]}))},t.addAtFirstCollectionPage=function(e,t){return o(this,void 0,void 0,(function*(){return z(t,e)}))},t.getAllCollectionPages=function(e){return o(this,void 0,void 0,(function*(){const t=yield K(e),n=H[e];let o=[];return n.order.forEach(e=>{o.push(t[e])}),o}))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.defaultAppSettings=void 0;const o=n(2);t.defaultAppSettings={highlightAsBulletPoint:!1,showPremiumFeatures:!1,supportGmailIntegration:!1,highlightFormat:null===o.HighlightFormat||void 0===o.HighlightFormat?void 0:o.HighlightFormat.bullet,openDesktopUrl:!1}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.genUuid=void 0;const o=n(12);t.genUuid=function(){return(0,o.v4)()}},function(e,t,n){"use strict";var o;n.r(t);var i=new Uint8Array(16);function r(){if(!o&&!(o="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return o(i)}var a=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;for(var s=function(e){return"string"==typeof e&&a.test(e)},c=[],l=0;l<256;++l)c.push((l+256).toString(16).substr(1));var u,d,p=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(c[e[t+0]]+c[e[t+1]]+c[e[t+2]]+c[e[t+3]]+"-"+c[e[t+4]]+c[e[t+5]]+"-"+c[e[t+6]]+c[e[t+7]]+"-"+c[e[t+8]]+c[e[t+9]]+"-"+c[e[t+10]]+c[e[t+11]]+c[e[t+12]]+c[e[t+13]]+c[e[t+14]]+c[e[t+15]]).toLowerCase();if(!s(n))throw TypeError("Stringified UUID is invalid");return n},h=0,f=0;var v=function(e,t,n){var o=t&&n||0,i=t||new Array(16),a=(e=e||{}).node||u,s=void 0!==e.clockseq?e.clockseq:d;if(null==a||null==s){var c=e.random||(e.rng||r)();null==a&&(a=u=[1|c[0],c[1],c[2],c[3],c[4],c[5]]),null==s&&(s=d=16383&(c[6]<<8|c[7]))}var l=void 0!==e.msecs?e.msecs:Date.now(),v=void 0!==e.nsecs?e.nsecs:f+1,g=l-h+(v-f)/1e4;if(g<0&&void 0===e.clockseq&&(s=s+1&16383),(g<0||l>h)&&void 0===e.nsecs&&(v=0),v>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");h=l,f=v,d=s;var m=(1e4*(268435455&(l+=122192928e5))+v)%4294967296;i[o++]=m>>>24&255,i[o++]=m>>>16&255,i[o++]=m>>>8&255,i[o++]=255&m;var y=l/4294967296*1e4&268435455;i[o++]=y>>>8&255,i[o++]=255&y,i[o++]=y>>>24&15|16,i[o++]=y>>>16&255,i[o++]=s>>>8|128,i[o++]=255&s;for(var b=0;b<6;++b)i[o+b]=a[b];return t||p(i)};var g=function(e){if(!s(e))throw TypeError("Invalid UUID");var t,n=new Uint8Array(16);return n[0]=(t=parseInt(e.slice(0,8),16))>>>24,n[1]=t>>>16&255,n[2]=t>>>8&255,n[3]=255&t,n[4]=(t=parseInt(e.slice(9,13),16))>>>8,n[5]=255&t,n[6]=(t=parseInt(e.slice(14,18),16))>>>8,n[7]=255&t,n[8]=(t=parseInt(e.slice(19,23),16))>>>8,n[9]=255&t,n[10]=(t=parseInt(e.slice(24,36),16))/1099511627776&255,n[11]=t/4294967296&255,n[12]=t>>>24&255,n[13]=t>>>16&255,n[14]=t>>>8&255,n[15]=255&t,n};var m=function(e,t,n){function o(e,o,i,r){if("string"==typeof e&&(e=function(e){e=unescape(encodeURIComponent(e));for(var t=[],n=0;n<e.length;++n)t.push(e.charCodeAt(n));return t}(e)),"string"==typeof o&&(o=g(o)),16!==o.length)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");var a=new Uint8Array(16+e.length);if(a.set(o),a.set(e,o.length),(a=n(a))[6]=15&a[6]|t,a[8]=63&a[8]|128,i){r=r||0;for(var s=0;s<16;++s)i[r+s]=a[s];return i}return p(a)}try{o.name=e}catch(e){}return o.DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8",o.URL="6ba7b811-9dad-11d1-80b4-00c04fd430c8",o};function y(e){return 14+(e+64>>>9<<4)+1}function b(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function _(e,t,n,o,i,r){return b((a=b(b(t,e),b(o,r)))<<(s=i)|a>>>32-s,n);var a,s}function w(e,t,n,o,i,r,a){return _(t&n|~t&o,e,t,i,r,a)}function C(e,t,n,o,i,r,a){return _(t&o|n&~o,e,t,i,r,a)}function O(e,t,n,o,i,r,a){return _(t^n^o,e,t,i,r,a)}function I(e,t,n,o,i,r,a){return _(n^(t|~o),e,t,i,r,a)}var k=m("v3",48,(function(e){if("string"==typeof e){var t=unescape(encodeURIComponent(e));e=new Uint8Array(t.length);for(var n=0;n<t.length;++n)e[n]=t.charCodeAt(n)}return function(e){for(var t=[],n=32*e.length,o=0;o<n;o+=8){var i=e[o>>5]>>>o%32&255,r=parseInt("0123456789abcdef".charAt(i>>>4&15)+"0123456789abcdef".charAt(15&i),16);t.push(r)}return t}(function(e,t){e[t>>5]|=128<<t%32,e[y(t)-1]=t;for(var n=1732584193,o=-271733879,i=-1732584194,r=271733878,a=0;a<e.length;a+=16){var s=n,c=o,l=i,u=r;n=w(n,o,i,r,e[a],7,-680876936),r=w(r,n,o,i,e[a+1],12,-389564586),i=w(i,r,n,o,e[a+2],17,606105819),o=w(o,i,r,n,e[a+3],22,-1044525330),n=w(n,o,i,r,e[a+4],7,-176418897),r=w(r,n,o,i,e[a+5],12,1200080426),i=w(i,r,n,o,e[a+6],17,-1473231341),o=w(o,i,r,n,e[a+7],22,-45705983),n=w(n,o,i,r,e[a+8],7,1770035416),r=w(r,n,o,i,e[a+9],12,-1958414417),i=w(i,r,n,o,e[a+10],17,-42063),o=w(o,i,r,n,e[a+11],22,-1990404162),n=w(n,o,i,r,e[a+12],7,1804603682),r=w(r,n,o,i,e[a+13],12,-40341101),i=w(i,r,n,o,e[a+14],17,-1502002290),o=w(o,i,r,n,e[a+15],22,1236535329),n=C(n,o,i,r,e[a+1],5,-165796510),r=C(r,n,o,i,e[a+6],9,-1069501632),i=C(i,r,n,o,e[a+11],14,643717713),o=C(o,i,r,n,e[a],20,-373897302),n=C(n,o,i,r,e[a+5],5,-701558691),r=C(r,n,o,i,e[a+10],9,38016083),i=C(i,r,n,o,e[a+15],14,-660478335),o=C(o,i,r,n,e[a+4],20,-405537848),n=C(n,o,i,r,e[a+9],5,568446438),r=C(r,n,o,i,e[a+14],9,-1019803690),i=C(i,r,n,o,e[a+3],14,-187363961),o=C(o,i,r,n,e[a+8],20,1163531501),n=C(n,o,i,r,e[a+13],5,-1444681467),r=C(r,n,o,i,e[a+2],9,-51403784),i=C(i,r,n,o,e[a+7],14,1735328473),o=C(o,i,r,n,e[a+12],20,-1926607734),n=O(n,o,i,r,e[a+5],4,-378558),r=O(r,n,o,i,e[a+8],11,-2022574463),i=O(i,r,n,o,e[a+11],16,1839030562),o=O(o,i,r,n,e[a+14],23,-35309556),n=O(n,o,i,r,e[a+1],4,-1530992060),r=O(r,n,o,i,e[a+4],11,1272893353),i=O(i,r,n,o,e[a+7],16,-155497632),o=O(o,i,r,n,e[a+10],23,-1094730640),n=O(n,o,i,r,e[a+13],4,681279174),r=O(r,n,o,i,e[a],11,-358537222),i=O(i,r,n,o,e[a+3],16,-722521979),o=O(o,i,r,n,e[a+6],23,76029189),n=O(n,o,i,r,e[a+9],4,-640364487),r=O(r,n,o,i,e[a+12],11,-421815835),i=O(i,r,n,o,e[a+15],16,530742520),o=O(o,i,r,n,e[a+2],23,-995338651),n=I(n,o,i,r,e[a],6,-198630844),r=I(r,n,o,i,e[a+7],10,1126891415),i=I(i,r,n,o,e[a+14],15,-1416354905),o=I(o,i,r,n,e[a+5],21,-57434055),n=I(n,o,i,r,e[a+12],6,1700485571),r=I(r,n,o,i,e[a+3],10,-1894986606),i=I(i,r,n,o,e[a+10],15,-1051523),o=I(o,i,r,n,e[a+1],21,-2054922799),n=I(n,o,i,r,e[a+8],6,1873313359),r=I(r,n,o,i,e[a+15],10,-30611744),i=I(i,r,n,o,e[a+6],15,-1560198380),o=I(o,i,r,n,e[a+13],21,1309151649),n=I(n,o,i,r,e[a+4],6,-145523070),r=I(r,n,o,i,e[a+11],10,-1120210379),i=I(i,r,n,o,e[a+2],15,718787259),o=I(o,i,r,n,e[a+9],21,-343485551),n=b(n,s),o=b(o,c),i=b(i,l),r=b(r,u)}return[n,o,i,r]}(function(e){if(0===e.length)return[];for(var t=8*e.length,n=new Uint32Array(y(t)),o=0;o<t;o+=8)n[o>>5]|=(255&e[o/8])<<o%32;return n}(e),8*e.length))}));var P=function(e,t,n){var o=(e=e||{}).random||(e.rng||r)();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,t){n=n||0;for(var i=0;i<16;++i)t[n+i]=o[i];return t}return p(o)};function j(e,t,n,o){switch(e){case 0:return t&n^~t&o;case 1:return t^n^o;case 2:return t&n^t&o^n&o;case 3:return t^n^o}}function T(e,t){return e<<t|e>>>32-t}var S=m("v5",80,(function(e){var t=[1518500249,1859775393,2400959708,3395469782],n=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"==typeof e){var o=unescape(encodeURIComponent(e));e=[];for(var i=0;i<o.length;++i)e.push(o.charCodeAt(i))}else Array.isArray(e)||(e=Array.prototype.slice.call(e));e.push(128);for(var r=e.length/4+2,a=Math.ceil(r/16),s=new Array(a),c=0;c<a;++c){for(var l=new Uint32Array(16),u=0;u<16;++u)l[u]=e[64*c+4*u]<<24|e[64*c+4*u+1]<<16|e[64*c+4*u+2]<<8|e[64*c+4*u+3];s[c]=l}s[a-1][14]=8*(e.length-1)/Math.pow(2,32),s[a-1][14]=Math.floor(s[a-1][14]),s[a-1][15]=8*(e.length-1)&4294967295;for(var d=0;d<a;++d){for(var p=new Uint32Array(80),h=0;h<16;++h)p[h]=s[d][h];for(var f=16;f<80;++f)p[f]=T(p[f-3]^p[f-8]^p[f-14]^p[f-16],1);for(var v=n[0],g=n[1],m=n[2],y=n[3],b=n[4],_=0;_<80;++_){var w=Math.floor(_/20),C=T(v,5)+j(w,g,m,y)+b+t[w]+p[_]>>>0;b=y,y=m,m=T(g,30)>>>0,g=v,v=C}n[0]=n[0]+v>>>0,n[1]=n[1]+g>>>0,n[2]=n[2]+m>>>0,n[3]=n[3]+y>>>0,n[4]=n[4]+b>>>0}return[n[0]>>24&255,n[0]>>16&255,n[0]>>8&255,255&n[0],n[1]>>24&255,n[1]>>16&255,n[1]>>8&255,255&n[1],n[2]>>24&255,n[2]>>16&255,n[2]>>8&255,255&n[2],n[3]>>24&255,n[3]>>16&255,n[3]>>8&255,255&n[3],n[4]>>24&255,n[4]>>16&255,n[4]>>8&255,255&n[4]]}));var x=function(e){if(!s(e))throw TypeError("Invalid UUID");return parseInt(e.substr(14,1),16)};n.d(t,"v1",(function(){return v})),n.d(t,"v3",(function(){return k})),n.d(t,"v4",(function(){return P})),n.d(t,"v5",(function(){return S})),n.d(t,"NIL",(function(){return"00000000-0000-0000-0000-000000000000"})),n.d(t,"version",(function(){return x})),n.d(t,"validate",(function(){return s})),n.d(t,"stringify",(function(){return p})),n.d(t,"parse",(function(){return g}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getDepVal=t.formatDate=void 0;const o=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];t.formatDate=e=>{const t=new Date(e),n=t.getMonth();return`${o[n]} ${t.getDate()}, ${t.getFullYear()}`},t.getDepVal=function(e,n,o){if("string"==typeof(null==e?void 0:e[n]))return e[n];if(null==e||null==e[n]||!Array.isArray(e[n])||!e[n].every(e=>Array.isArray(e)))return o;let i="";return e[n].forEach(([e,n])=>{if(!n)return void(i+=e);const o=n.flatMap(e=>{switch(e[0]){case"d":return[function(e){let n;switch(e.type){case"datetime":case"date":return n=e.start_date,(0,t.formatDate)(n);case"daterange":case"datetimerange":n=e.start_date;const o=e.end_date;return`${(0,t.formatDate)(n)} â†’ ${(0,t.formatDate)(o)}`;default:return null}}(e[1])];default:return[]}});o.length&&(i+=o.join(" "))}),i}},function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function a(e){try{c(o.next(e))}catch(e){r(e)}}function s(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((o=o.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.DummyNotionClient=t.client=t.Collection=t.getFilenameFromUrl=t.parsePageId=t.fetchRetry=void 0;const r=n(68),a=n(75),s=n(0),c=n(9),l=n(8),u=i(n(7)),d=n(12),p=n(2),h=n(15),f=n(11),v=n(35),g=n(13);t.fetchRetry=function(e,t={},n=1e3,o=3){return new Promise((i,r)=>{let a,s=0;const c=()=>{fetch(e,t).then(e=>{if(e.ok)return e.json();throw e}).then(e=>i(e)).catch(e=>{a=e,++s>=o?r(a):setTimeout(c,n)})};c()})};t.parsePageId=e=>{if(e){const n=e.replace(/\-/g,"").slice(-32);return`${(t=n).substr(0,8)}-${t.substr(8,4)}-${t.substr(12,4)}-${t.substr(16,4)}-${t.substr(20)}`}var t};t.getFilenameFromUrl=function(e){return e.split("/").pop().split("#")[0].split("?")[0]};const m={"youtube.com":!0};class y{constructor(e,t,n,o,i){this.id=e,this.parentId=n,this.fetched=!1,this.schema={},this.viewId=t,this.rows={},this.spaceId=i,this.client=o}initLocally(e){this._extractSchema(e),this.fetched=!0}_extractSchema(e){this.schema={};for(let t of Object.keys(e)){let n=e[t];this.schema[t]=Object.assign(Object.assign({},n),{id:t,strippedName:""})}}createRow(e,t,n,i){var r;return o(this,void 0,void 0,(function*(){let o=[],a=null;if(n==p.ClipOption.defaultClip&&(null==i?void 0:i.url)){const t=new h.NotionV3Client({token:this.client.authToken,activeUserId:this.client.agent.activeUserId});a=yield t.custom.createWebClippedPage(this.parentId,{title:null!==(r=e.title)&&void 0!==r?r:"No title",url:i.url})}else{let{id:e,operations:n}=this.client.createRecordOperations("block",{id:this.id,_table:"collection",spaceId:t},{type:"page"});a=e,o=n}this.rows[a]={id:a};let s=!1;if(i)try{let e=new URL(i.url);(e.hostname.startsWith("www.")&&e.hostname.substring(4)||e.hostname)in m&&(s=!1)}catch(e){}return this.updateRow({where:{id:a},data:e,operations:o,skipFrontImage:s})}))}findRow({where:e}){if(e.id&&e.id in this.rows)return this.rows[e.id];let t=Object.keys(e).length;for(let n in this.rows){let o=this.rows[n],i=0;for(let t in e){if(o[t]!=e[t])break;i++}if(i==t)return o}return null}updateRow({where:e,data:t,operations:n,skipFrontImage:i}){var r;return o(this,void 0,void 0,(function*(){let l=[],u=null,p=n,f=this.findRow({where:e});if(!f)throw"can't update because row not found";let g=f.id;if(t.__template){const e=yield(0,c.getTransacOperationsFromTemplate)(t.__template.blocksMap,t.__template.id,f.id);p.push(...e)}let m=[];t.pageFrontImage&&0==i&&[...t.pageFrontImage].reverse().forEach((e,t)=>{const{newBlockId:n,newDividerBlockId:o,operations:i}=function(e,{imgUrl:t,fileId:n,width:o,height:i,opts:r}){const a=(0,d.v4)(),c=(1==r.addDivider||void 0===r.addDivider)&&(0,d.v4)(),l={large:{width:672,height:380},normal:{width:672,height:250},small:{width:336,height:175}},u=l[r.size].width,p=l[r.size].height;let h=null,f=null,v=!1,g=!1;switch(r.type){case"coverLike":"large"==r.size&&(g=!0),h=o,f=i,h!=u&&(f=Math.floor(f*(u/h)),h=u),f>p&&(h=Math.floor(h*(p/f)),f=p),h<u&&(g=!1),(0,s.print)("heve",f,h),f=null;break;case"fullWidthCover":v=!0,f=p}return{newBlockId:a,newDividerBlockId:c,operations:[{id:a,table:"block",path:[],command:"set",args:{type:"text",id:a,version:1}},{id:a,table:"block",path:[],command:"update",args:{parent_id:e,parent_table:"block",alive:!0}},{table:"block",id:e,path:["content"],command:"listBefore",args:{id:a}},{id:a,table:"block",path:[],command:"update",args:{type:"image"}},{id:a,table:"block",path:["properties"],command:"update",args:{source:[[t]]}},{id:a,table:"block",path:["format"],command:"update",args:{display_source:t}},{id:a,table:"block",path:["format"],command:"update",args:{block_height:f,block_width:h,block_full_width:v,block_page_width:g}},...n&&[{id:a,table:"block",path:["file_ids"],command:"set",args:[n]}]||[],...c&&[{id:c,table:"block",path:[],command:"set",args:{type:"divider",id:c,properties:{}}},{id:c,table:"block",path:[],command:"update",args:{parent_id:e,parent_table:"block",alive:!0}},{table:"block",id:e,path:["content"],command:"listAfter",args:{after:a,id:c}}]||[]]}}(f.id,Object.assign(Object.assign({},e),{opts:Object.assign(Object.assign({},e.opts),{addDivider:0===t})}));p.push(...i),u=o||n});for(let e in t){if("__template"==e||"pageFrontImage"==e)continue;(null===(r=t[e])||void 0===r?void 0:r.fileId)&&m.push(t[e].fileId),Array.isArray(t[e])&&t[e].forEach(t=>{t.fileId&&m.push(t.fileId),"pageCover"==e?l.push({path:["format","page_cover"],value:t.imgUrl}):"pageIcon"==e&&l.push({path:["format","page_icon"],value:t.imgUrl})});let n=this.schema[e];if(!n)continue;let o=["properties",n.id],i=(0,v.castToNotionValue)(t[e],n);l.push({path:o,value:i})}m.length&&l.push({path:["file_ids"],value:m}),yield this.client.updateDataRecord(g,l,p),t.__template&&(yield function({clientAuthToken:e,currentUserId:n,spaceId:i,activeUserId:r}){return o(this,void 0,void 0,(function*(){yield(0,a.sleep)(30);const o=new h.NotionV3Client({token:e,activeUserId:r});yield o.custom.createAsyncTaskToCopyTemplateContent({templateId:t.__template.id,targetPageId:f.id,currentUserId:n,spaceId:i})}))}({clientAuthToken:this.client.authToken,currentUserId:this.client.user.id,spaceId:this.spaceId,activeUserId:this.client.agent.activeUserId}));let y=this.rows[g];for(let e in t)y[e]=t[e];return{id:y.id,highlightAfterId:u}}))}}function b(e,t,n){var o,i,r,a,s;let c=[],l=null===(o=e[null!=n?n:"block"])||void 0===o?void 0:o[t];for(;null!=l&&l.value;)"page"==l.value.type&&c.push({name:(0,g.getDepVal)(l.value.properties,"title","Untitled"),icon:(null===(i=l.value.format)||void 0===i?void 0:i.page_icon)||null}),l=(null===(a=e[null!==(r=l.parent_table)&&void 0!==r?r:"block"])||void 0===a?void 0:a[null===(s=l.value)||void 0===s?void 0:s.parent_id])||null;return c.reverse(),c}t.Collection=y,t.client=null;const _={id:null,spaces:[],givenName:null,spacesMap:{}};t.DummyNotionClient=class{constructor(e,t){this.agent=(0,r.createAgent)({token:e,debug:!1,activeUserId:t}),this.authToken=e,this.user=_}setActiveUserId(e){return o(this,void 0,void 0,(function*(){(0,s.print)("activeUserId",e),this.agent.activeUserId=e,u.default.set(l.NOTION_ACTIVE_USER_ID,e)}))}addValueToPropertyCollection(e,t,n,i,r){return o(this,void 0,void 0,(function*(){let o=Object.assign({},e.schema),a={id:i,value:n,color:r};return o[t]=Object.assign(Object.assign({},o[t]),{options:[...o[t].options||[],a]}),yield this._submitTransaction([{id:e.id,table:"collection",path:[],command:"update",args:{schema:o}}]),a}))}setUserInfos(e){this.user=e}loadPageChunk(e){return this.agent.loadPageChunk(e)}checkPageAlive(e){var t,n,i,r;return o(this,void 0,void 0,(function*(){const o=yield this.agent._post("/api/v3/syncRecordValues",{requests:[{pointer:{table:"block",id:e},version:-1}]});return{alive:null===(r=null===(i=null===(n=null===(t=null==o?void 0:o.recordMap)||void 0===t?void 0:t.block)||void 0===n?void 0:n[e])||void 0===i?void 0:i.value)||void 0===r?void 0:r.alive}}))}fetchUserInfos(){return o(this,void 0,void 0,(function*(){const e=yield this.agent.loadUserContent({});let t=Object.keys(e.recordMap.notion_user);this.user.id=t[0];let n=e.recordMap.notion_user[this.user.id];this.user.givenName=n.value.given_name;for(let t in e.recordMap.space){let n=e.recordMap.space[t];this.user.spaces.push({id:t,name:n.value.name})}}))}createRecordOperations(e,t,n={}){let o=(0,d.v4)(),i=Object.assign({id:o,version:1,alive:!0,created_by:this.user.id,created_time:Date.now(),space_id:t.spaceId,last_edited_by:this.user.id,last_edited_time:Date.now(),parent_id:t.id,parent_table:t._table},n);return{id:o,operations:[this._buildOperation({id:o,command:"set",args:i,table:e})]}}createRecord(e,t,n={}){return o(this,void 0,void 0,(function*(){let o=n.id||(0,d.v4)(),i=Object.assign({id:o,version:1,alive:!0,created_by:this.user.id,created_time:Date.now(),last_edited_by:this.user.id,last_edited_time:Date.now(),parent_id:t.id,parent_table:t._table},n);return yield this._submitTransaction([this._buildOperation({id:o,command:"set",args:i,table:e})]),o}))}updateDataRecord(e,t,n){return o(this,void 0,void 0,(function*(){return yield this._submitTransaction([...n||[],...null==t?void 0:t.map(t=>this._buildOperation({id:e,command:"set",table:"block",path:t.path,args:t.value}))]),e}))}getCollectionLocally(e,t,n,i){return o(this,void 0,void 0,(function*(){let o=new y(e,"",t,this,i);return o.initLocally(n),o}))}_buildOperation(e){return{id:(e=Object.assign({table:"block",path:[],args:{},command:"set"},e)).id,path:e.path,args:e.args,command:e.command,table:e.table}}searchCollectionPages(e,t,n,i=this.user.id){var r,a;return o(this,void 0,void 0,(function*(){let o=yield this.agent.search({type:"BlocksInParent",query:e,spaceId:n,parentId:t,limit:20,filters:{isDeletedOnly:!1,excludeTemplates:!0,isNavigableOnly:!0,requireEditPermissions:!1,ancestors:[],createdBy:[],editedBy:[],lastEditedTime:{},createdTime:{}},sort:"Relevance",source:"relation_menu"}),i=[];for(let e of o.results){let t=e.id;if(!(t in o.recordMap.block))continue;let n=o.recordMap.block[t].value;i.push({id:n.id,name:(0,g.getDepVal)(n.properties,"title","Untitled"),title:null===(r=n.properties)||void 0===r?void 0:r.title,icon:(null===(a=n.format)||void 0===a?void 0:a.page_icon)||null})}return i}))}searchCollections(e="",t=this.user.spaces[0].id){return o(this,void 0,void 0,(function*(){let n=yield this.agent.search({type:"BlocksInSpace",query:e,spaceId:t,limit:20,filters:{isDeletedOnly:!1,excludeTemplates:!0,isNavigableOnly:!1,navigableBlockContentOnly:!0,requireEditPermissions:!1,includePublicPagesWithoutExplicitAccess:!1,ancestors:[],createdBy:[],editedBy:[],lastEditedTime:{},createdTime:{},inTeams:[]},sort:{field:"relevance"},source:"quick_find_input_change",searchExperimentOverrides:{},searchSessionId:(0,f.genUuid)(),searchSessionFlowNumber:1,recentPagesForBoosting:[]}),o=[],i=[];for(let e in n.recordMap.block){let t=n.recordMap.block[e].value;"page"==t.type&&(console.log("getting parent",t),t.parents=b(n.recordMap,t.parent_id,t.parent_table),i.push(t))}for(let e in n.recordMap.collection){let t=n.recordMap.collection[e].value;t.parents=b(n.recordMap,t.parent_id,"block"),o.push(t)}return{collections:o,pages:i,query:e}}))}getWorkspaces(){var e;return o(this,void 0,void 0,(function*(){const t=new h.NotionV3Client({token:this.authToken,activeUserId:this.agent.activeUserId}),n=yield t.custom.getUsers(),o=yield t.post("/getPublicSpaceData",{type:"space-ids",spaceIds:n.reduce((e,t)=>[...e,...t.spaceIds],[])});return(0,s.sortByKey)(null===(e=o.results)||void 0===e?void 0:e.map(e=>{return{id:e.id,user:n.find(t=>null!=t.spaceIds.find(t=>t==e.id)),name:e.name,icon:e.icon,planInfo:`${t=e.planType||"Unknown",t.charAt(0).toUpperCase()+t.slice(1)} Plan - ${e.memberCount||0} member${e.memberCount>1?"s":""}`};var t}),"name")}))}_submitTransaction(e){return o(this,void 0,void 0,(function*(){return this.agent.submitTransaction({requestId:(0,d.v4)(),transactions:[{id:(0,d.v4)(),operations:e}]})}))}appendBulletPointToPage(e,n,i,r){return o(this,void 0,void 0,(function*(){const o=(0,d.v4)();e=(0,t.parsePageId)(e);const a={[p.HighlightFormat.bullet]:{type:"bulleted_list"},[p.HighlightFormat.code]:{type:"code",properties:{language:[["Plain Text"]]}},[p.HighlightFormat.quote]:{type:"quote"}},c=[{id:o,table:"block",path:[],command:"update",args:(0,s.combine)([{type:"bulleted_list",id:o,parent_id:e,parent_table:"block",alive:!0,version:1,created_time:Date.now(),last_edited_time:Date.now(),properties:{title:[[n]]}},a[r]])},{table:"block",id:e,path:["content"],command:i?"listAfter":"listBefore",args:Object.assign(Object.assign({},i?{after:i}:{}),{id:o})}];yield this._submitTransaction(c);return o}))}getSpacePersons({spaceId:e}){return o(this,void 0,void 0,(function*(){return new h.NotionV3Client({token:this.authToken,activeUserId:this.agent.activeUserId}).custom.getSpacePersons({spaceId:e})}))}}},function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function a(e){try{c(o.next(e))}catch(e){r(e)}}function s(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.NotionV3Client=void 0;const i=n(0),r=n(12),a=n(2),s=n(14),c=n(76),l=n(11);t.NotionV3Client=class{constructor({token:e,activeUserId:t}){this.defaultHeaders={accept:"*/*","accept-language":"en-US,en;q=0.9","accept-encoding":"gzip, deflate, br",origin:"https://www.notion.so",referer:"https://www.notion.so"},this.custom={saveTransaction:e=>o(this,void 0,void 0,(function*(){return this.post("/saveTransactions",{requestId:(0,l.genUuid)(),transactions:[{id:(0,l.genUuid)(),spaceId:e.spaceId,operations:e.operations}]})})),saveBlock:e=>o(this,void 0,void 0,(function*(){})),search:e=>o(this,void 0,void 0,(function*(){return this.search({type:"BlocksInSpace",query:e.text,spaceId:e.spaceId,limit:20,filters:{isDeletedOnly:!1,excludeTemplates:!0,isNavigableOnly:!1,navigableBlockContentOnly:!0,requireEditPermissions:!1,includePublicPagesWithoutExplicitAccess:!1,ancestors:[],createdBy:[],editedBy:[],lastEditedTime:{},createdTime:{},inTeams:[]},sort:{field:"relevance"},source:"quick_find_input_change",searchExperimentOverrides:{},searchSessionId:(0,l.genUuid)(),searchSessionFlowNumber:1,recentPagesForBoosting:[]})})),createAsyncTaskToCopyTemplateContent:({templateId:e,targetPageId:t,currentUserId:n,spaceId:i})=>o(this,void 0,void 0,(function*(){yield this.post("/enqueueTask",{task:{eventName:"duplicateBlock",request:{sourceBlock:{id:e,spaceId:i},targetBlock:{id:t,spaceId:i},appendContentOnly:!0,resolveTemplateVariables:{currentUserId:n,currentTimeZone:"Europe/Vienna"}}}})})),getPage:e=>o(this,void 0,void 0,(function*(){var t,n,o;const i=yield this.post("/syncRecordValues",{requests:[{pointer:{table:"block",id:e.pageId},version:-1}]});return{value:null===(o=null===(n=null===(t=null==i?void 0:i.recordMap)||void 0===t?void 0:t.block)||void 0===n?void 0:n[e.pageId])||void 0===o?void 0:o.value}})),getCollection:e=>o(this,void 0,void 0,(function*(){var t,n,o;const i=yield this.post("/syncRecordValues",{requests:[{pointer:{table:"collection",id:e.collectionId},version:-1}]});return{value:null===(o=null===(n=null===(t=null==i?void 0:i.recordMap)||void 0===t?void 0:t.collection)||void 0===n?void 0:n[e.collectionId])||void 0===o?void 0:o.value}})),getSpacePersons:({spaceId:e})=>o(this,void 0,void 0,(function*(){var t;const n=yield this.post("/getVisibleUsers",{spaceId:e}),r=new i.ConcurrentQueue(4);let a=[];return null===(t=n.users||n.visibleUsers)||void 0===t||t.forEach(e=>{r.push(()=>o(this,void 0,void 0,(function*(){var t,n,o,r;const s=yield this.post("/syncRecordValues",{requests:[{pointer:{table:"notion_user",id:e.userId},version:-1}]});let c=(null===(t=null==s?void 0:s.recordMap)||void 0===t?void 0:t.notion_user)&&(null===(r=null===(n=null==s?void 0:s.recordMap)||void 0===n?void 0:n.notion_user[Object.keys(null===(o=null==s?void 0:s.recordMap)||void 0===o?void 0:o.notion_user)[0]])||void 0===r?void 0:r.value);c&&((0,i.print)("fetched user",c),a.push(c))})))}),yield r.totallyEmpty(),(0,i.sortByKey)(a,"given_name")})),uploadFile:({dataB64:e,onProgress:t,record:n,noBlob:r})=>o(this,void 0,void 0,(function*(){var o;let a=e.substr(5,e.indexOf(";")-5);const s=yield this.post("/getUploadFileUrl",{bucket:"secure",name:`stn-${(0,i.makeid)(40)}.jpeg`,contentType:a,record:n,supportExtraHeaders:!1,contentLength:e.length}),l=(u=s.url,d=n.spaceId,null===(p=u.match(new RegExp(`https://.*?/${d}/(.*?)/.*`)))||void 0===p?void 0:p[1]);var u,d,p;try{const n=yield(0,c.fetchWithProgress)(s.signedPutUrl,{headers:Object.assign({"Content-Type":a},Object.fromEntries((null===(o=s.putHeaders)||void 0===o?void 0:o.map(e=>[e.name,e.value]))||[])),method:"PUT",body:r?e:(0,i.dataURItoBlob)(e),onProgress:t});return(0,i.print)("resp upload to Notion",n),(0,i.print)("vv",s.url,l),{success:!0,url:s.url,fileId:l}}catch(e){return(0,i.print)("error uploading",e),{success:!1}}})),createWebClippedPage:(e,{title:t,url:n})=>o(this,void 0,void 0,(function*(){var o;const i=yield this.addWebClipperURLs({blockId:e,items:[{title:t,url:n}],from:"chrome",type:"block"});if(!i.createdBlockIds&&!(null===(o=i.createdBlockIds)||void 0===o?void 0:o[0]))throw new Error(`addWebClipperURLs failed with following content: ${JSON.stringify(i)} - might be an expired token`);return i.createdBlockIds[0]})),setCaption:e=>o(this,void 0,void 0,(function*(){return yield this.submitOperations([{pointer:{id:e.notionBlockId,table:"block",spaceId:e.notionSpaceId},path:["properties","caption"],command:"set",args:[[e.caption]],size:5}],e.notionSpaceId),null})),getSpaceIds:()=>o(this,void 0,void 0,(function*(){var e;const t=yield this.post("/getSpaces");(0,i.print)("getSpaceIds",t);let n={};return Object.keys(t).forEach(e=>{var o;n=Object.assign(Object.assign({},n),(null===(o=t[e])||void 0===o?void 0:o.space_view)||{})}),null===(e=Object.keys(n))||void 0===e?void 0:e.map(e=>{var t;return null===(t=n[e].value)||void 0===t?void 0:t.space_id}).filter(e=>null!=e)})),getUsers:()=>o(this,void 0,void 0,(function*(){var e;const t=yield this.post("/getSpaces");let n={};return Object.keys(t).forEach(e=>{var o,i,r;if(!t[e].notion_user)return;let a=(null===(o=t[e].notion_user[e])||void 0===o?void 0:o.value)||{id:e};n[e]=Object.assign(Object.assign({},a),{spaceIds:[]}),n[e].spaceIds=null===(r=Object.keys((null===(i=t[e])||void 0===i?void 0:i.space_view)||{}))||void 0===r?void 0:r.map(n=>{var o,i,r;return null===(r=null===(i=null===(o=t[e])||void 0===o?void 0:o.space_view[n])||void 0===i?void 0:i.value)||void 0===r?void 0:r.space_id})}),null===(e=Object.keys(n))||void 0===e?void 0:e.map(e=>n[e])})),addBlockGetOperations:e=>{var t,n;const o=(0,r.v4)();let c=(0,s.parsePageId)(e.notionParentId);const l={[a.HighlightFormat.bullet]:{type:"bulleted_list"},[a.HighlightFormat.code]:{type:"code",properties:{language:[["Plain Text"]]}},[a.HighlightFormat.quote]:{type:"quote"},page:{type:"page"},callout:{type:"callout",format:{page_icon:null!==(t=e.calloutIcon)&&void 0!==t?t:"ðŸ“‹"}}},u=[{id:o,table:"block",path:[],command:"update",args:(0,i.combine)([Object.assign(Object.assign({type:"bulleted_list",id:o,space_id:e.notionSpaceId,parent_id:c,parent_table:e.notionParentTable||"block",alive:!0,version:1,created_time:Date.now(),last_edited_time:Date.now()},e.userId&&{created_by_table:"notion_user",created_by_id:e.userId,last_edited_by_table:"notion_user",last_edited_by_id:e.userId}),{properties:Object.assign(Object.assign({},e.text&&{title:Array.isArray(e.text)?e.text:[[e.text]]}),e.properties||{})}),l[e.blockFormat]||{type:e.blockFormat},e.properties&&{properties:e.properties}||{},e.format&&{format:e.format}||{},e.fileIds&&{file_ids:e.fileIds}||{},e.withChildren&&{content:e.withChildren.content}||{}])},..."page"!=e.blockFormat||e.isSubpage?[{table:"block",id:c,path:["content"],command:e.afterId?"listAfter":"listBefore",args:Object.assign(Object.assign({},e.afterId?{after:e.afterId}:{}),{id:o})}]:[],...e.blockColor&&[{table:"block",id:o,path:["format"],command:"update",args:{block_color:"gray"}}]||[],...(null===(n=e.withChildren)||void 0===n?void 0:n.contentBlocks)&&e.withChildren.contentBlocks.map(t=>({table:"block",id:t.value.id,path:[],command:"update",args:Object.assign({parent_id:o,parent_table:"block",space_id:e.notionSpaceId},t.value)}))||[]];return{newBlockId:o,operations:u}},addBlock:e=>o(this,void 0,void 0,(function*(){let t=[];const{operations:n,newBlockId:o}=this.custom.addBlockGetOperations(e);t=e.extraOperationsFn?[...n,...e.extraOperationsFn({newBlockId:o,operations:n})]:n;yield this.submitOperations(t,e.notionSpaceId);return e.withCallback&&(yield e.withCallback(o)),o})),updateBlockText:e=>o(this,void 0,void 0,(function*(){let t=(0,s.parsePageId)(e.notionParentId);yield this.submitOperations([{pointer:{table:"block",id:e.notionBlockId,spaceId:e.notionSpaceId},path:["properties","title"],command:"set",args:[[e.text]]},{pointer:{table:"block",id:e.notionBlockId,spaceId:e.notionSpaceId},path:[],command:"update",args:{last_edited_time:Date.now()}},{pointer:{table:"block",id:t,spaceId:e.notionSpaceId},path:[],command:"update",args:{last_edited_time:Date.now()}}],e.notionSpaceId)})),removeBlock:e=>{this.submitOperations([{pointer:{table:"block",id:e.notionBlockId,spaceId:e.notionSpaceId},path:[],command:"update",args:{alive:!1}},{pointer:{table:"block",id:e.notionParentId,spaceId:e.notionSpaceId},path:["content"],command:"listRemove",args:{id:e.notionBlockId}}],e.notionSpaceId)},addBookmark:e=>o(this,void 0,void 0,(function*(){const t=(0,r.v4)();let n=(0,s.parsePageId)(e.notionParentId);return yield this.submitOperations([{id:t,table:"block",path:[],command:"update",args:{type:"text",id:t,parent_id:n,parent_table:"block",alive:!0,version:1,created_time:Date.now(),last_edited_time:Date.now(),properties:{title:[["[ðŸ”— LINK]",[["a",e.url]]],[" â€” "+(e.title.trim()||"Untitled")]]}}},{table:"block",id:n,path:["content"],command:"listAfter",args:{id:t}}],e.notionSpaceId),t})),loadNotionContext:()=>o(this,void 0,void 0,(function*(){var e,t;const n=yield this.custom.getUsers();if(!n.length)return null;const o=null!==(e=yield this.post("/getPublicSpaceData",{type:"space-ids",spaceIds:n.reduce((e,t)=>[...e,...t.spaceIds],[])}))&&void 0!==e?e:{results:[]},r=Object.fromEntries(n.map(e=>[e.id,e])),a=(0,i.sortByKey)(null===(t=o.results)||void 0===t?void 0:t.map(e=>{return{linkedUserIds:n.filter(t=>null!=t.spaceIds.find(t=>t==e.id)).map(e=>e.id),id:e.id,type:"space",name:e.name,icon:e.icon,planInfo:`${t=e.planType||"Unknown",t.charAt(0).toUpperCase()+t.slice(1)} Plan - ${e.memberCount||0} member${e.memberCount>1?"s":""}`};var t}),"name");return{usersMap:r,spacesMap:Object.fromEntries(a.map(e=>[e.id,e]))}}))},this.token=e,this.activeUserId=t}_axios(e,t="get",n={},i={}){var r;return o(this,void 0,void 0,(function*(){let o;const a=null!==(r=this._fetch)&&void 0!==r?r:fetch;if(o=yield a("https://www.notion.so/api/v3/"+(e.startsWith("/")&&e.slice(1)||e),{method:t.toUpperCase(),headers:Object.assign(Object.assign(Object.assign(Object.assign({"content-type":"application/json"},this.defaultHeaders),this.token&&{cookie:"token_v2="+this.token}),this.activeUserId&&{"x-notion-active-user-header":this.activeUserId}),i),body:JSON.stringify(n)}),!o.ok)throw new Error(`Notion API returned ${o.status} for route ${e}`);return o.json()}))}post(e,t={},n={}){return this._axios(e,"post",t,n)}put(e,t={},n={}){return this._axios(e,"put",t,n)}delete(e){return this._axios(e,"delete")}get(e){return this._axios(e,"get",null)}_setFetch(e){this._fetch=e}addWebClipperURLs(e){return this.post("/addWebClipperURLs",e)}submitOperations(e,t){return this.post("/submitTransaction",{requestId:(0,r.v4)(),transactions:[{id:(0,r.v4)(),operations:e}]})}loadPageChunk(e){return this.post("/loadPageChunk",Object.assign(Object.assign({},{limit:100,cursor:{stack:[]},chunkNumber:0,verticalColumns:!1}),e))}saveOperations(e,t){return this.post("/saveTransactions",{requestId:(0,r.v4)(),transactions:[{id:(0,r.v4)(),spaceId:t,operations:e}]})}search(e){return this.post("/search",e)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.cleanupUrl=void 0,t.cleanupUrl=function(e){return null==e?void 0:e.replace(/#.*$/,"")}},function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function a(e){try{c(o.next(e))}catch(e){r(e)}}function s(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((o=o.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.getNotionV3Client=t.getClientFromContentScript=t.getClient=void 0;const r=n(14),a=n(8),s=i(n(7)),c=n(0),l=n(9),u=n(30),d=n(15);function p(e,t=chrome.cookies.get){return o(this,void 0,void 0,(function*(){let n;const o=yield(0,c.promisifyCallback)(t,{url:"https://www.notion.so",name:"token_v2"});if(!o)return{status:"error",errorMsg:"need_to_login_to_notion"};const i=o.value;let u=yield s.default.get(a.COOKIE_KEY,null);u&&(u=(0,l.decrypt)(u));let d=yield s.default.get(a.NOTION_ACTIVE_USER_ID,null),p=yield s.default.get(a.NOTION_CLIENT_DATA_KEY,null);return p&&(p=JSON.parse((0,l.decrypt)(p))),n=new r.DummyNotionClient(i,d),u&&u==i&&p?(n.setUserInfos(p),{status:"ok",client:n}):(e&&e("fetching_client"),yield s.default.remove(a.COOKIE_KEY),yield s.default.remove(a.NOTION_CLIENT_DATA_KEY),yield s.default.remove(a.NOTION_ACTIVE_USER_ID),n=new r.DummyNotionClient(i,null),yield(0,l.fetchNotionClient)(n,i))}))}function h(){var e;return o(this,void 0,void 0,(function*(){return null===(e=yield(0,c.promisifyCallback)(chrome.cookies.get,{url:"https://www.notion.so",name:"token_v2"}))||void 0===e?void 0:e.value}))}t.getClient=p,t.getClientFromContentScript=function(e,t=u.chromeCookiesGet){return o(this,void 0,void 0,(function*(){return p(e,t)}))},t.getNotionV3Client=function(e){return o(this,void 0,void 0,(function*(){const[t,n]=yield Promise.all([h(),s.default.get(a.NOTION_ACTIVE_USER_ID,null)]),o=new d.NotionV3Client({token:t,activeUserId:n});return e&&(o.activeUserId=e),o}))}},function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function a(e){try{c(o.next(e))}catch(e){r(e)}}function s(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.stopCaptureWatch=t.startCaptureWatch=t.checkCanHaveQuickCaptureFloatingButton=t.askForAllUrlsAndTabsPermission=t.checkUserHasAllUrlsAndTabsPermission=t.askForTabsPermission=t.checkUserHasTabsPermission=t.turnOnSavedPageBadgeChecking=t.turnOffSavedPageBadgeChecking=t.handleTabOnActivated=t.handleTabOnUpdate=t.showSavedBadgeIfPossible=void 0;const i=n(1),r=n(16),a=n(21),s=n(5);function c(){chrome.browserAction.setBadgeText({text:""})}function l(e){return o(this,void 0,void 0,(function*(){const t=e||(yield(0,s.currentTab)());if(!(null==t?void 0:t.url))return;const n=t.url&&(0,r.cleanupUrl)(t.url);(yield i.db.urlToCapturedWebpage.get(n))?(chrome.browserAction.setBadgeText({text:"âœ“"}),chrome.browserAction.setBadgeBackgroundColor({color:"#BBF7D0"})):c()}))}function u(e,t,n){"complete"==t.status&&n.active&&l(n)}function d(e){l()}function p(){return new Promise(e=>{chrome.permissions.contains({permissions:["tabs"]},t=>{e(t)})})}function h(){return new Promise(e=>{chrome.permissions.contains({origins:["<all_urls>"],permissions:["tabs"]},t=>{e(t)})})}t.showSavedBadgeIfPossible=function(){return o(this,void 0,void 0,(function*(){(yield p())&&(yield l())}))},t.handleTabOnUpdate=u,t.handleTabOnActivated=d,t.turnOffSavedPageBadgeChecking=function(){chrome.tabs.onUpdated.removeListener(u),chrome.tabs.onActivated.removeListener(d),c(),chrome.permissions.remove({permissions:["tabs"]})},t.turnOnSavedPageBadgeChecking=function(){chrome.tabs.onUpdated.addListener(u),chrome.tabs.onActivated.addListener(d),l()},t.checkUserHasTabsPermission=p,t.askForTabsPermission=function(){return new Promise(e=>{chrome.permissions.request({permissions:["tabs"]},t=>{e(t)})})},t.checkUserHasAllUrlsAndTabsPermission=h,t.askForAllUrlsAndTabsPermission=function(){return new Promise(e=>{chrome.permissions.request({origins:["<all_urls>"],permissions:["tabs"]},t=>{e(t)})})},t.checkCanHaveQuickCaptureFloatingButton=function(){return o(this,void 0,void 0,(function*(){if(!(yield h()))return!1;return(yield i.db.quickCapture.load()).enabled}))};let f={};function v(e){f[e]||(f[e]=setTimeout(()=>o(this,void 0,void 0,(function*(){yield(0,a.injectContentScriptAndStartWatching)(e),f[e]=null})),20))}function g(e,t,n){"loading"==t.status&&n.active&&setTimeout(()=>v(e),100)}function m(e){v(e.tabId)}t.startCaptureWatch=function(){chrome.tabs.onUpdated.addListener(g),chrome.tabs.onActivated.addListener(m)},t.stopCaptureWatch=function(){return o(this,void 0,void 0,(function*(){chrome.tabs.onUpdated.removeListener(g),chrome.tabs.onActivated.removeListener(m),yield(0,a.stopQuickCaptureWatch)()}))}},function(e,t,n){"use strict";var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,i)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&o(t,e,n);return i(t,e),t},a=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function a(e){try{c(o.next(e))}catch(e){r(e)}}function s(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.addNotionSyncEvent=t.notionSyncMap=t.Queue=t.NoEventException=void 0;const s=n(1),c=n(0),l=r(n(89)),u=n(29),d=n(17),p=n(24);class h extends u.CustomException{constructor(){super(...arguments),this.name="NoEventException",this.errorMsg="event not implemented yet"}}t.NoEventException=h;class f{constructor(){this.concurrency=1,this.running=0,this.taskQueue=[],this.runTask=e=>{this.running++,e(e=>{this.running--,this.taskQueue.length>0&&this.runTask(this.taskQueue.shift())})},this.enqueueTask=e=>this.taskQueue.push(e),this.push=e=>this.running<this.concurrency?this.runTask(e):this.enqueueTask(e)}}t.Queue=f;const v=new class{constructor(){this.queue=new f,s.db.notionSync.load().then(e=>this.notionSync=e)}addEvent(e){return a(this,void 0,void 0,(function*(){const t=Object.assign(Object.assign({},e),{_eventId:(0,c.makeid)(10)});return this.notionSync.pendingEvents.push(t),yield s.db.notionSync.save(this.notionSync),chrome.runtime.sendMessage({popup:{name:"notionSyncPendingEvent",args:t}}),this.queue.push(e=>a(this,void 0,void 0,(function*(){yield this.processEvent(t),this.notionSync.pendingEvents=this.notionSync.pendingEvents.filter(e=>e._eventId!==t._eventId),yield s.db.notionSync.save(this.notionSync),chrome.runtime.sendMessage({popup:{name:"notionSyncCompletedEvent",args:t}}),e()}))),!0}))}processEvent(e){return a(this,void 0,void 0,(function*(){try{const t=yield(0,d.getNotionV3Client)(),n={notionClient:t,log:e=>(0,c.print)(e),db:s.db,updateToast:p.bgActionsMap.updateAndShowToastEvent};(0,c.print)("start processing EVENT",e.type);const o=l[e.type];if(!o)throw new h;return e.activeUserId&&(t.activeUserId=e.activeUserId),yield o(e,n),!0}catch(e){const t=e;return console.error(t),{errorName:t.name,errorMsg:null==t?void 0:t.errorMsg}}}))}};t.notionSyncMap={addNotionSyncEvent:e=>a(void 0,void 0,void 0,(function*(){yield v.addEvent(e.event)}))},t.addNotionSyncEvent=function(e){return v.addEvent(e)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.logProgress=t.success=t.error=t.log=void 0;const o=n(0);let i=0;t.log=(e="",...t)=>{(0,o.print)(`${" ".repeat(4*i)}${e}`,...t)};t.error=(e="",...t)=>{(0,o.print)(`${" ".repeat(4*i)}${e}`,...t)};t.success=(e="",...t)=>{(0,o.print)(`${" ".repeat(4*i)}${e}`,...t)};t.logProgress=e=>{(0,t.log)(e+"â€¦"),i+=1;let n=!1;return{_startingTime:Date.now(),_getDiffTime(){return Date.now()-this._startingTime},_getDiffTimeStr(){const e=this._getDiffTime()/1e3;return e<.1?"":` (+${e.toFixed(2)}s)`},done(e="",...o){if(n)throw new Error("You can't call done() twice");(0,t.success)(e+this._getDiffTimeStr(),...o),i-=1,n=!0},error(e=""){if(n)throw new Error("You can't call done() twice");(0,t.error)(e+this._getDiffTimeStr()),i-=1,n=!0}}}},function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function a(e){try{c(o.next(e))}catch(e){r(e)}}function s(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.takeHighlightOrNoteByCommand=t.contextMenuOnClick=t.stopQuickCaptureWatch=t.injectContentScriptAndStartWatching=t.injectContentScriptAndOpenModal=t.injectContentScriptIfNotAlready=t.takeHighlight=t.takeHighlightV2=t.injectContentScript=void 0;const i=n(0),r=n(3),a=n(23),s=n(25),c=n(1),l=n(43),u=n(5),d=n(44),p=n(16),h=n(2),f=n(97),v=n(24);function g(e){return o(this,void 0,void 0,(function*(){(yield(0,r.executeCode)("window.__stnInjectScript !== undefined",e))||(yield(0,r.executeScriptV2)("content/content.js",e))}))}function m(e,t){var n;return o(this,void 0,void 0,(function*(){let o,s;try{o=yield(0,r.executeScript)("getSelectedText.js"),s=yield(0,a.runGetSelectionRangeRepresentation)()}catch(e){(0,i.print)("got some error",e),o={pageUrl:(yield(0,u.currentTab)()).url,selectionText:t}}(0,i.print)("takeHighlight",o,s);const l=(0,p.cleanupUrl)(o.pageUrl),d=yield(0,a.getCapturedWebpage)(l),f=(null===(n=yield c.db.user.load())||void 0===n?void 0:n.settings.highlightFormat)||h.HighlightFormat.bullet;(0,i.print)("x-1/ saved, now opening"),yield c.db.captureContext.save({type:"highlight",highlightContextData:{text:o.selectionText,highlightFormat:f,selectionRange:s,capturedWebpage:d}}),(0,i.print)("x/ saved, now opening",e),yield y(e)}))}function y(e){return o(this,void 0,void 0,(function*(){(0,i.print)("x+1/ injectContentScriptAndOpenModal"),(0,l.injectQuickCapture)(e),yield(0,i.sleep)(10);yield(0,f.waitForAsync)(()=>o(this,void 0,void 0,(function*(){(0,i.print)("waiting for ping",0);return 1==(yield(0,s.contentAsk)("ping",void 0,e))})),{timeout:7e3,interval:20}),(0,i.print)("showModal..."),yield(0,s.contentAsk)("showModal",void 0,e)}))}function b(e){let t="string"==typeof e?new Date(e):e;var n=new Date(t.getTime()),o=String(n.getDate()).padStart(2,"0"),i=String(n.getMonth()+1).padStart(2,"0"),r=n.getFullYear();const a=String(n.getMinutes()).padStart(2,"0");return r+"-"+i+"-"+o+" "+String(n.getHours()).padStart(2,"0")+":"+a}function _(e,t,n){return o(this,void 0,void 0,(function*(){const o=yield(0,v.screenshot)(e);if(!o.success)return;const r=(0,p.cleanupUrl)(n),s=yield(0,a.getCapturedWebpage)(r);yield c.db.captureContext.save({type:"highlight",highlightContextData:{type:"image",text:"New Screenshot "+b(new Date),image:{imageBase64:o.imageBase64},url:n,capturedWebpage:s}}),(0,i.print)("x/ saved, now opening",t),yield y(t)}))}t.injectContentScript=g,t.takeHighlightV2=function(e){return o(this,void 0,void 0,(function*(){yield g(e);return yield(0,s.contentAsk)("getHighlightRange",void 0,null)}))},t.takeHighlight=m,t.injectContentScriptIfNotAlready=function(e){return o(this,void 0,void 0,(function*(){yield(0,l.injectQuickCapture)(e)}))},t.injectContentScriptAndOpenModal=y,t.injectContentScriptAndStartWatching=function(e){return o(this,void 0,void 0,(function*(){yield g(e),yield(0,s.contentAsk)("startWatch",yield c.db.quickCapture.load())}))},t.stopQuickCaptureWatch=function(){return o(this,void 0,void 0,(function*(){return new Promise(e=>{chrome.tabs.query({},t=>o(this,void 0,void 0,(function*(){yield Promise.all(t.map(e=>o(this,void 0,void 0,(function*(){yield(0,s.contentAsk)("stopWatch",void 0,e.id)})))),yield e(void 0)})))})}))},t.contextMenuOnClick=function(e,t){return o(this,void 0,void 0,(function*(){const n=null==t?void 0:t.url;return"stn_save_page"==e.menuItemId?(0,d.injectPopupIframe)(t):"stn_take_full_page_screenshot"==e.menuItemId?_("takeScreenshot",null==t?void 0:t.id,n):"stn_select_zone_screenshot"==e.menuItemId?_("capturePortion",null==t?void 0:t.id,n):((0,i.print)("highlight",e,t),m(t.id,e.selectionText))}))},t.takeHighlightOrNoteByCommand=function(e){return o(this,void 0,void 0,(function*(){m((yield(0,u.currentTab)()).id)}))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getIdName=void 0,t.getIdName=function(){return""+chrome.runtime.id.replace(/[\W_]+/g,"")}},function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function a(e){try{c(o.next(e))}catch(e){r(e)}}function s(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.highlight=t.runRemoveSelection=t.runGetSelectionRangeRepresentation=t.runHighlightSelection=t.getCapturedWebpage=void 0;const i=n(40),r=n(88),a=n(1),s=n(19),c=n(3),l=n(11);function u(e){return o(this,void 0,void 0,(function*(){const t=yield a.db.urlToCapturedWebpage.get(e);if(!t)return null;return yield a.db.capturedWebpage.get(t.capturedWebpageId)}))}function d(e=null,t){return o(this,void 0,void 0,(function*(){yield(0,c.executeCode)(`\n    var __action = "findHighlight";\n    var __highlights = ${JSON.stringify(e)}; \n    var __highlightId = ${JSON.stringify(t||null)}; \n`),yield(0,c.executeScript)("highlightSelection.js")}))}function p(){return o(this,void 0,void 0,(function*(){return yield(0,c.executeCode)('\n    var __action = "getSelectionRangeRepresentation";\n    var __highlights = null; \n    var __highlightId = null; \n'),yield(0,c.executeScript)("highlightSelection.js")}))}t.getCapturedWebpage=u,t.runHighlightSelection=d,t.runGetSelectionRangeRepresentation=p,t.runRemoveSelection=function(e){return o(this,void 0,void 0,(function*(){return yield(0,c.executeCode)(`\n    var __action = "removeSelection";\n    var __highlights = null;\n    var __highlightId = ${JSON.stringify(e)}; \n`),yield(0,c.executeScript)("highlightSelection.js")}))},t.highlight=function(e){return o(this,void 0,void 0,(function*(){const t=yield u(e.pageUrl);if(!t)return void(0,r.displaySnackBar)({action:"fail",msg:"No Notion Page Found, ",tutorial:!0,timeout:3e3});const n=yield p(),o=(0,l.genUuid)();d(null,o);const c=yield a.db.custom.createHighlight((0,i.cast)({id:o,type:"highlight",text:e.selectionText,selectionRange:n,capturedWebpageId:t.id,notionBlockId:null,createdAt:(new Date).toISOString(),notionUserId:null,uploadedAt:"",showCaption:!1}));(0,s.addNotionSyncEvent)({type:"addHighlight",capturedWebpageId:t.id,highlight:c}),chrome.runtime.sendMessage({popup:{name:"highlightAdded",args:{capturedWebpageId:t.id,highlightId:c.id}}})}))}},function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function a(e){try{c(o.next(e))}catch(e){r(e)}}function s(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((o=o.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.addFeedback=t.addTelemetryEvent=t.bgActionsMap=t.screenshot=void 0;const r=n(8),a=n(40),s=n(93),c=n(95),l=n(1),u=n(11),d=n(17),p=i(n(7)),h=n(13),f=n(2),v=n(0),g=n(25),m=n(21),y=n(23),b=n(18),_=n(96),w=n(3),C=n(19),O=n(4),I=n(5),k=n(41),P=n(39),j=n(16);function T(e,t){return o(this,void 0,void 0,(function*(){const n=yield new Promise(n=>(0,w.executeAsyncScript)("screenshot.js",n,Object.assign({type:e},t)));return 0==n.success?{success:!1}:n}))}function S(e){var t,n;return o(this,void 0,void 0,(function*(){let o=yield l.db.quickCaptureSession.load();if(!o||!o.notionContext){const e=yield M();if(!e)return null;const t=e.spacesMap[Object.keys(e.spacesMap)[0]];if(!t)return null;let n=(yield U({text:"",spaceId:t.id,userId:t.linkedUserIds[0]}))[0];o=yield l.db.quickCaptureSession.save({page:n,notionContext:e})}if(function(e){var t;return null!=(null===(t=null==e?void 0:e.highlightContextData)||void 0===t?void 0:t.capturedWebpage)}(e.context)){const i=null===(n=null===(t=e.context)||void 0===t?void 0:t.highlightContextData)||void 0===n?void 0:n.capturedWebpage;o.page={id:i.notionPageId,type:"page",properties:{title:i.title},format:{page_icon:i.icon},spaceId:i.notionSpaceId}}return o}))}function x(e,t){var n;const o=null===(n=null==t?void 0:t.spacesMap[e])||void 0===n?void 0:n.linkedUserIds[0];return o||null}function M(){return o(this,void 0,void 0,(function*(){const e=yield(0,d.getNotionV3Client)();return yield e.custom.loadNotionContext()}))}function A(e,t,n){var o,i,r,a,s;let c=[],l=null===(o=e[null!=n?n:"block"])||void 0===o?void 0:o[t];for(;null!=l&&l.value;)"page"==l.value.type&&c.push({name:(0,h.getDepVal)(l.value.properties,"title","Untitled"),icon:(null===(i=l.value.format)||void 0===i?void 0:i.page_icon)||null}),l=(null===(a=e[null!==(r=l.parent_table)&&void 0!==r?r:"block"])||void 0===a?void 0:a[null===(s=l.value)||void 0===s?void 0:s.parent_id])||null;return c.reverse(),c}function U(e){return o(this,void 0,void 0,(function*(){const t=yield(0,d.getNotionV3Client)(e.userId),n=yield t.custom.search(e);return n.results.map(e=>{var t,o,i,r,a;const s=null===(t=n.recordMap.block[e.id])||void 0===t?void 0:t.value;return"collection_view"==(null==s?void 0:s.type)||"collection_view_page"==(null==s?void 0:s.type)?Object.assign({type:"collection"},null===(r=n.recordMap.collection[s.collection_id||(null===(i=null===(o=s.format)||void 0===o?void 0:o.collection_pointer)||void 0===i?void 0:i.id)])||void 0===r?void 0:r.value):s||(null===(a=n.recordMap.collection[e.id])||void 0===a?void 0:a.value)}).filter(e=>e).map(t=>Object.assign(Object.assign({},t),{parents:A(n.recordMap,t.id,"collection"==t.type?"collection":"block"),spaceId:e.spaceId}))}))}function E(e){return o(this,void 0,void 0,(function*(){fetch("https://6kbxs6snzg.execute-api.us-east-1.amazonaws.com/v1/integration/telemetry",{method:"POST",keepalive:!0,headers:{"Content-Type":"application/json"},body:JSON.stringify({event:e.event,properties:e.properties})})}))}function N(e){return o(this,void 0,void 0,(function*(){try{const t=yield fetch("https://6kbxs6snzg.execute-api.us-east-1.amazonaws.com/v1/integration/feedback",{method:"POST",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}});return yield t.json()}catch(e){return{success:!1}}}))}t.screenshot=T,t.bgActionsMap={takeFullPageScreenshot:()=>T("takeScreenshot"),takeCustomAreaScreenshot:()=>T("capturePortion"),pickImageOnPage:()=>T("selectImage"),downloadRemoteImage:({url:e})=>T("fetchImageAsBase64",{url:e}),addTelemetryEvent:E,scanWebpage:function(){return o(this,void 0,void 0,(function*(){return yield new Promise(e=>(0,w.executeAsyncScript)("scanWebpage.js",e,{}))}))},removeContextMenuRightClick:()=>o(void 0,void 0,void 0,(function*(){yield chrome.contextMenus.remove("stn_save_page")})),fetch:({url:e,opts:t})=>o(void 0,void 0,void 0,(function*(){const n=yield fetch(e,t),o=n.json();return{status:n.status,json:o}})),addContextMenuRightClick:()=>o(void 0,void 0,void 0,(function*(){(0,O.addContextMenuRightClick)()})),updateAndShowToastEvent:e=>o(void 0,void 0,void 0,(function*(){const t=yield l.db.toastSession.load();let n=t.events.filter(e=>{if(!e.expiration)return!1;const t=e.expiration;return!(new Date(e.createdAt).getTime()+t<Date.now())});const i=e.id?t.events.findIndex(t=>t.id==e.id):-1;n=-1!=i?n.map((t,n)=>n==i?Object.assign(Object.assign({},t),e):t):[...n,Object.assign(Object.assign({},e),{createdAt:(new Date).toISOString(),expiration:1e4})],yield l.db.toastSession.save({events:n}),yield(0,g.contentAsk)("showToast",void 0),(0,v.sleep)(10).then(()=>o(void 0,void 0,void 0,(function*(){const t=yield(0,I.currentTab)();yield(0,s.toastAsk)("updateToastEvent",e,t.id)})))})),removeToastEvent:(e,t)=>o(void 0,void 0,void 0,(function*(){const n=(yield l.db.toastSession.load()).events.filter(t=>t.id!=e.id);yield l.db.toastSession.save({events:n}),yield(0,s.toastAsk)("removeToastEvent",e,t.tab.id)})),closeToast:()=>o(void 0,void 0,void 0,(function*(){yield(0,g.contentAsk)("closeToast",void 0)})),notionLoadElement:e=>o(void 0,void 0,void 0,(function*(){const t=yield(0,d.getNotionV3Client)(e.userId);return(0,c.notionLoadElement)(e,{notionClient:t,log:null,db:l.db})})),syncNotionPage:e=>o(void 0,void 0,void 0,(function*(){const n=yield S({});if(!n)return{errorCode:"notionSessionExpired"};const o=x(e.spaceId,n.notionContext);if(!o&&!x(e.spaceId,yield t.bgActionsMap.refreshNotionContext(void 0)))return{errorCode:"noSpaceAccessGranted"};const i=yield t.bgActionsMap.notionLoadElement({id:e.pageId,type:e.type,userId:o});if(!i.success){const n=yield t.bgActionsMap.refreshNotionContext(void 0);if(!n)return{errorCode:"notionSessionExpired"};return x(e.spaceId,n)?{errorCode:"noPageReadAccessGranted"}:{errorCode:"noSpaceAccessGranted"}}return{syncPage:i.item}})),loadGmail:(e,t)=>o(void 0,void 0,void 0,(function*(){yield(0,m.injectContentScriptIfNotAlready)(t.tab.id);return yield(0,g.contentAsk)("loadGmail",void 0,t.tab.id)})),openFeedbackModal:({context:e},t)=>o(void 0,void 0,void 0,(function*(){yield l.db.captureContext.save({type:"feedback",feedbackContextData:e}),yield(0,m.injectContentScriptAndOpenModal)(t.tab.id)})),addFeedback:N,tryQuickCapture:(e,t)=>o(void 0,void 0,void 0,(function*(){(0,_.telemetry)("try_quick_capture"),yield(0,m.injectContentScriptAndOpenModal)(t.tab.id)})),startCaptureWatch:(e,t)=>o(void 0,void 0,void 0,(function*(){(0,b.startCaptureWatch)(),yield(0,m.injectContentScriptAndStartWatching)(t.tab.id)})),stopCaptureWatch:(e,t)=>o(void 0,void 0,void 0,(function*(){yield(0,b.stopCaptureWatch)()})),askAllUrlsAndTabsPermissions:()=>o(void 0,void 0,void 0,(function*(){return(0,b.askForAllUrlsAndTabsPermission)()})),checkQuickCaptureFeatureEnabled:()=>o(void 0,void 0,void 0,(function*(){if(!(yield(0,b.checkUserHasAllUrlsAndTabsPermission)()))return{enabled:!1};const e=yield l.db.quickCapture.load();return e||{enabled:!1}})),saveImageCache:e=>o(void 0,void 0,void 0,(function*(){const t=yield l.db.imageCacheInfo.load();if(!t.cachedUrls.find(t=>t===e.imageCache.url)){if(t.cachedUrls.length>=20){const e=t.cachedUrls.shift();yield l.db.imageCaches.remove(e)}t.cachedUrls.push(e.imageCache.url),yield l.db.imageCacheInfo.save(t),yield l.db.imageCaches.save(e.imageCache.url,e.imageCache)}})),getImageCache:e=>o(void 0,void 0,void 0,(function*(){return yield l.db.imageCaches.get(e.url)})),loadTooltipSession:()=>o(void 0,void 0,void 0,(function*(){return yield l.db.tooltipSession.load()})),loadToastSession:()=>o(void 0,void 0,void 0,(function*(){return yield l.db.toastSession.load()})),openPage:e=>o(void 0,void 0,void 0,(function*(){chrome.tabs.create({url:e.url})})),loadCaptureContext:()=>o(void 0,void 0,void 0,(function*(){let e=yield l.db.captureContext.load();return e?yield l.db.captureContext.remove():e={type:"note"},e})),updateTwitterSession:e=>o(void 0,void 0,void 0,(function*(){const t=(yield l.db.twitterSession.load())||{};yield l.db.twitterSession.save(Object.assign(Object.assign({},t),e))})),getExtensionContext:e=>o(void 0,void 0,void 0,(function*(){return{modalUrl:chrome.runtime.getURL("modal/modal.html"),tooltipUrl:chrome.runtime.getURL("tooltip/tooltip.html"),toastUrl:chrome.runtime.getURL("toast/toast.html"),extensionId:chrome.runtime.id}})),updateCaptureSession:e=>o(void 0,void 0,void 0,(function*(){yield l.db.quickCaptureSession.save(e.session)})),refreshNotionContext:()=>o(void 0,void 0,void 0,(function*(){const e=yield M(),t=yield S({});return yield l.db.quickCaptureSession.save(Object.assign(Object.assign({},t),{notionContext:e})),e})),setActiveUserId:function(e){return o(this,void 0,void 0,(function*(){p.default.set(r.NOTION_ACTIVE_USER_ID,e)}))},loadCaptureSession:S,searchPages:U,submitCapture:(e,n,i)=>o(void 0,void 0,void 0,(function*(){var n,o,r,s,c,p,h;const v=e.session;if("highlight"==e.payload.type?(0,_.telemetry)("save_highlight",{url:e.payload.highlightContextData.url}):"note"==e.payload.type&&(0,_.telemetry)("save_note"),"highlight"==e.payload.type){const t=(null===(n=e.payload.highlightContextData)||void 0===n?void 0:n.highlightFormat)||f.HighlightFormat.bullet,o=yield l.db.user.load();t!=((null==o?void 0:o.settings.highlightFormat)||f.HighlightFormat.bullet)&&(yield l.db.custom.saveUser(Object.assign(Object.assign({},o),{settings:Object.assign(Object.assign({},o.settings),{highlightFormat:t})})))}const g=v.page.id,m="collection"==v.page.type?{savingTo:"collection",notionPageId:null,notionCollectionId:v.page.id}:{savingTo:"page",notionPageId:v.page.id,notionCollectionId:null},b=null===(o=v.notionContext.spacesMap[v.page.spaceId])||void 0===o?void 0:o.linkedUserIds[0];let w=yield l.db.capturedWebpage.get(g);w||(w=yield l.db.custom.createCapturedWebpage(Object.assign({notionBookmarkId:null,capturedWebpageId:g,icon:null,url:null,source:"capture",notionListAfterId:null,title:null,formId:null,notionSpaceId:v.page.spaceId,clipFormat:f.ClipFormat.bookmark},m)));const O=Object.assign(Object.assign({id:(0,u.genUuid)()},e.payload.properties&&{properties:e.payload.properties}),{capturedWebpageId:w.id,uploadedAt:"",notionBlockId:null,createdAt:(new Date).toISOString(),notionUserId:b}),I="highlight"==e.payload.type&&"image"==(null===(r=e.payload.highlightContextData)||void 0===r?void 0:r.type),T=yield l.db.custom.createHighlight("highlight"==e.payload.type&&I?(0,a.cast)(Object.assign(Object.assign({},O),{type:"screenshot",name:e.payload.highlightContextData.text,caption:e.payload.caption,url:e.payload.highlightContextData.url,showCaption:!1})):"note"==e.payload.type?(0,a.cast)(Object.assign(Object.assign({},O),{note:e.payload.note,type:"note",showCaption:!1})):(0,a.cast)(Object.assign(Object.assign(Object.assign(Object.assign({},O),{type:"highlight",text:e.payload.highlightContextData.text}),e.payload.caption.length?{caption:e.payload.caption,showCaption:!0}:{showCaption:!1}),{selectionRange:e.payload.highlightContextData.selectionRange,highlightFormat:e.payload.highlightContextData.highlightFormat||f.HighlightFormat.bullet})));if("highlight"!=e.payload.type||I||(yield(0,y.runHighlightSelection)([T])),null===(s=e.context)||void 0===s?void 0:s.executeDirectly)try{console.log("submit",e);const n=yield(0,k.addHighlight)({type:"addHighlight",capturedWebpageId:g,activeUserId:b,highlight:T},{notionContext:v.notionContext,highlightContextData:null!==(c=e.payload.highlightContextData)&&void 0!==c?c:null,notionPageId:g,notionClient:yield(0,d.getNotionV3Client)(b),userId:b,db:l.db,log:console.log,updateToast:e=>{if(console.log("upload toast",e),!i)return t.bgActionsMap.updateAndShowToastEvent(e);null==i||i.onProgress(e)}});if(null===(p=e.context)||void 0===p?void 0:p.url){let t=(0,j.cleanupUrl)(null===(h=e.context)||void 0===h?void 0:h.url);console.log("add captured webpage");const o=Object.assign(Object.assign({},"page"==n.savingAs?{savingTo:"page",notionPageId:n.notionBlockId,notionCollectionId:n.notionParentId}:{savingTo:"page",notionBookmarkId:n.notionBlockId,notionPageId:n.notionParentId}),{capturedWebpageId:n.notionBlockId,icon:null,url:t,source:"capture",notionListAfterId:null,title:function(e){if(Array.isArray(e))return e.slice(0).map(e=>""+e[0]).join("").replace(/^.*?â€”\s?/g,"");return e}(n.title),formId:null,notionSpaceId:v.page.spaceId,clipFormat:f.ClipFormat.bookmark});console.log("payload",o),yield l.db.custom.createCapturedWebpage(o)}}catch(n){console.error(n);const o=function(e){let t=(0,P.ellipsis)((""+e).split("\n")[0].trim(),50);if(t.includes("Failed to fetch"))return"it seems you are not connected to internet, please check your internet connection and try again";if(t.includes("upload file"))return"Failed to upload file. Please try again.";return"Failed to upload to Notion. go to notion.so on this browser and ensure you are logged in to the right workspace, then try again with the clipper."}(n.toString());return i?null==i||i.onProgress({id:(0,u.genUuid)(),type:"error",message:o}):yield t.bgActionsMap.updateAndShowToastEvent({id:(0,u.genUuid)(),type:"error",message:"Failed to capture "+("highlight"==T.type?"highlight":"screenshot"==T.type?"screenshot":"note"),action:{message:"Try Again",bgAction:"submitCapture",bgActionProps:e}}),!1}else yield(0,C.addNotionSyncEvent)({type:"addHighlight",capturedWebpageId:g,activeUserId:b,highlight:T});return!0}))},t.addTelemetryEvent=E,t.addFeedback=N},function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function a(e){try{c(o.next(e))}catch(e){r(e)}}function s(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.contentAsk=void 0;const i=n(5);t.contentAsk=function(e,t,n,r=1){return o(this,void 0,void 0,(function*(){const o=n||(yield(0,i.currentTab)()).id;return new Promise(n=>{chrome.tabs.sendMessage(o,{event:e,props:t,destination:"content",v2:!0},e=>{n(e)})})}))}},function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function a(e){try{c(o.next(e))}catch(e){r(e)}}function s(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.dialogInjectAction=t.getPopupUrl=void 0;const i=n(4),r=n(3),a=n(22);function s(e){const t=""+(i.isFirefox?"moz-extension":"chrome-extension");return i.isFirefox?null===browser||void 0===browser?void 0:browser.runtime.getURL("popup/index.html"):`${t}://${e}/popup/index.html`}t.getPopupUrl=s,t.dialogInjectAction=function(e,t,n,i){return o(this,void 0,void 0,(function*(){const o=(0,a.getIdName)();(0,r.executeClipper)(`\n  var idName = "${o}";\n  var popupUrl = "${s(o)}"\n  var anchor = ${n?`{x:${n.x}, y:${n.x}}`:"null"};\n  var integration = ${i?`"${i}"`:"null"};\n  var action = ${JSON.stringify(e)}\n  `,t)}))}},function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function a(e){try{c(o.next(e))}catch(e){r(e)}}function s(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.getCurrentPageHtmlMetaData=void 0;const i=n(5);t.getCurrentPageHtmlMetaData=function(){return o(this,void 0,void 0,(function*(){let e;try{e=yield(0,i.currentTab)()}catch(e){return}let t=yield new Promise(t=>chrome.tabs.executeScript(e.id,{file:"/parseMetaTags.js"},e=>{t(e[0])}));return Object.assign(Object.assign(Object.assign({},t),{url:e.url,favIconUrl:e.favIconUrl}),function(e,t){const n=new URL(t.url).hostname.replace(/^www\./,"");return n in r?Object.entries(r[n]||{}).reduce((n,[o,i])=>(n[o]="string"==typeof i?i:i(e,t),n),{}):{}}(t,e))}))};const r={"mail.google.com":{icon:"https://upload.wikimedia.org/wikipedia/commons/7/7e/Gmail_icon_%282020%29.svg"},"youtube.com":{title:(e,t)=>"yt_author"in e&&`${t.title||""} - ${e.yt_author}`||t.title},"twitter.com":{title:(e,t)=>`${e.title.replace(/ on Twitter$/,"").trim()} ${e.description}`}}},function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function a(e){try{c(o.next(e))}catch(e){r(e)}}function s(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.logWrapper=t.catcherAsync=t.catcher=void 0;const i=n(20);t.catcher=function(e,t){try{const t=e();return(null==t?void 0:t.then)&&(null==t||t.catch(e=>{throw e})),t}catch(e){throw new t}},t.catcherAsync=function(e,t){return o(this,void 0,void 0,(function*(){try{return yield e()}catch(e){throw new t}}))},t.logWrapper=function(e,t){return o(this,void 0,void 0,(function*(){const n=(0,i.logProgress)(`'${e}' started`);try{const o=yield t();return n.done(`'${e}' successfully completed`),o}catch(t){throw n.done(`'${e}' failed to complete`),t}}))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CustomException=void 0;class o extends Error{constructor(){super(...arguments),this.helpMsg=null}}t.CustomException=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.chromeTabsQuery=t.chromeCookiesGet=void 0,t.chromeCookiesGet=function(e,t){return chrome.runtime.sendMessage({type:"chromeCookiesGet",data:e},e=>t(e))},t.chromeTabsQuery=function(e,t){return chrome.runtime.sendMessage({type:"chromeTabsQuery",data:e},t)}},function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function a(e){try{c(o.next(e))}catch(e){r(e)}}function s(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.debounce=t.promisify=t.hashCode=t.getQueryParameter=t.makeid=t.arrayMove=t.getUrlObj=t.timestamp=t.slugify=t.timeAgo=t.isCurrentlySSR=t.throttle=t.genId=t.sleep=t.getParameterByName=t.debounceImmediate=t.camelize=t.getUrlInfo=t.getUrlHostname=t.deepCopy=t.a2r=t.r2a=t.jdump=t.printdebug=t.print=void 0,t.print=(...e)=>{},t.printdebug=(...e)=>{};t.jdump=e=>JSON.stringify(e,null,2),t.r2a=function(e){return Object.keys(e).map(t=>e[t])},t.a2r=function(e,t){let n={};return e.forEach(e=>{"string"==typeof e?n[e]=e:n[e[t]]=e}),n},t.deepCopy=function(e){return JSON.parse(JSON.stringify(e))},t.getUrlHostname=function(e){return null==e?null:new URL(e).hostname.replace(/^www./,"")},t.getUrlInfo=function(e){if(null==e)return null;const t=new URL(e);return{hostname:t.hostname.replace(/^www./,""),pathname:t.pathname}},t.camelize=function(e){return e.replace(/(?:^\w|[A-Z]|\b\w|\s+)/g,(function(e,t){return 0==+e?"":0===t?e.toLowerCase():e.toUpperCase()}))},t.debounceImmediate=function(e,t){return function(e,t,n,o){var i,r=null;return function(...o){var a=n&&!r;return clearTimeout(r),r=setTimeout((function(){r=null,n||(i=e(...o))}),t),a&&(i=e(...o)),i}}(e,t,!0)},t.getParameterByName=function(e,t){t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var n=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null};t.sleep=e=>o(void 0,void 0,void 0,(function*(){return new Promise(t=>setTimeout(t,e))})),t.genId=function(e=4){for(var t="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",o=n.length,i=0;i<e;i++)t+=n.charAt(Math.floor(Math.random()*o));return t},t.throttle=function(e,t){let n,o,i;return(...r)=>{const a=new Date;return o&&(o(void 0),clearTimeout(i),o=null),new Promise(s=>{const c=n?Math.max(0,t-(a.getTime()-n.getTime())):0;o=s,i=setTimeout((function(){n=a,o=null,s(e.apply(null,r))}),c)})}},t.isCurrentlySSR=function(){return"undefined"==typeof window},t.timeAgo=function(e){const t=new Date;var n=Date.parse(t.toString())-Date.parse(e.toString());const o=e=>e>1?"s":"";if(n<6e4)return"just now";if(n<36e5){const e=Math.round(n/6e4);return e+` minute${o(e)} ago`}if(n<864e5){const e=Math.round(n/36e5);return Math.round(n/36e5)+` hour${o(e)} ago`}if(n<2592e6){const e=Math.round(n/864e5);return e+` day${o(e)} ago`}if(n<31536e6){const e=Math.round(n/2592e6);return e+` month${o(e)} ago`}{const e=Math.round(n/31536e6);return e+` year${o(e)} ago`}},t.slugify=function(e){e=(e=e.replace(/^\s+|\s+$/g,"")).toLowerCase();for(var t="Ã Ã¡Ã¤Ã¢Ã¨Ã©Ã«ÃªÃ¬Ã­Ã¯Ã®Ã²Ã³Ã¶Ã´Ã¹ÃºÃ¼Ã»Ã±Ã§Â·/_,:;",n=0,o=t.length;n<o;n++)e=e.replace(new RegExp(t.charAt(n),"g"),"aaaaeeeeiiiioooouuuunc------".charAt(n));return e=e.replace(/[^a-z0-9 -]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-")},t.timestamp=function(e){return Date.parse(e)};t.getUrlObj=function(e){try{e=`${e.startsWith("http")?"":"https://"}${e}`;const t=new URL(e);let n=t.host.split(".");return 1==n.length||n.some(e=>0==e.length)?null:t}catch(e){return null}};t.arrayMove=(e,t,n)=>(((e,t,n)=>{const o=n<0?e.length+n:n,i=e.splice(t,1)[0];e.splice(o,0,i)})(e=e.slice(),t,n),e),t.makeid=function(e){for(var t="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",o=n.length,i=0;i<e;i++)t+=n.charAt(Math.floor(Math.random()*o));return t},t.getQueryParameter=function(e,t=window.location.href){e=e.replace(/[\[\]]/g,"\\$&");var n=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null},t.hashCode=function(e){var t=0;if(0==e.length)return""+t;for(var n=0;n<e.length;n++){t=(t<<5)-t+e.charCodeAt(n),t&=t}return""+t},t.promisify=function(e){return new Promise((t,n)=>{e(t)})},t.debounce=function(e,t){let n;return(...o)=>{clearTimeout(n),n=setTimeout(()=>e(...o),t)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.loadTweetV2=t.openQuickCapturePopup=t.notionUploadFile=t.notionUpdatePageValues=t.notionGetCollection=t.notionGetPageItem=t.notionChangeOrderOptionProperty=t.notionUpdateOptionProperty=t.notionCreateNewOptionProperty=t.notionSearchRelations=t.backgroundNetworkFetch=void 0;var o=n(61);Object.defineProperty(t,"backgroundNetworkFetch",{enumerable:!0,get:function(){return o.backgroundNetworkFetch}});var i=n(62);Object.defineProperty(t,"notionSearchRelations",{enumerable:!0,get:function(){return i.notionSearchRelations}});var r=n(63);Object.defineProperty(t,"notionCreateNewOptionProperty",{enumerable:!0,get:function(){return r.notionCreateNewOptionProperty}});var a=n(33);Object.defineProperty(t,"notionUpdateOptionProperty",{enumerable:!0,get:function(){return a.notionUpdateOptionProperty}});var s=n(64);Object.defineProperty(t,"notionChangeOrderOptionProperty",{enumerable:!0,get:function(){return s.notionChangeOrderOptionProperty}});var c=n(65);Object.defineProperty(t,"notionGetPageItem",{enumerable:!0,get:function(){return c.notionGetPageItem}});var l=n(66);Object.defineProperty(t,"notionGetCollection",{enumerable:!0,get:function(){return l.notionGetCollection}});var u=n(67);Object.defineProperty(t,"notionUpdatePageValues",{enumerable:!0,get:function(){return u.notionUpdatePageValues}});var d=n(77);Object.defineProperty(t,"notionUploadFile",{enumerable:!0,get:function(){return d.notionUploadFile}});var p=n(78);Object.defineProperty(t,"openQuickCapturePopup",{enumerable:!0,get:function(){return p.openQuickCapturePopup}});var h=n(79);Object.defineProperty(t,"loadTweetV2",{enumerable:!0,get:function(){return h.loadTweetV2}})},function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function a(e){try{c(o.next(e))}catch(e){r(e)}}function s(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.notionUpdateOptionProperty=void 0,t.notionUpdateOptionProperty=function(e,{notionClient:t}){return o(this,void 0,void 0,(function*(){try{yield t.submitOperations([{pointer:{table:"collection",id:e.collectionId,spaceId:e.spaceId},command:"keyedObjectListUpdate",path:["schema",e.propertyId,"options"],args:{value:e.option}}],e.spaceId)}catch(e){return console.error(e),{success:!1}}return{success:!0}}))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mapIdToRelations=t.idToRelations=t.castSimplifiedToNotionValue=void 0;const o=n(35);function i(e,t){const n={relation:"p",person:"u"};let o=e||[],i=[];return o.forEach((e,r)=>{i.push(["â€£",[[n[t.type],e]]]),r+1<o.length&&i.push([","])}),i}t.castSimplifiedToNotionValue=function(e,t){try{const n=function(e,t){switch(t.type){case"relation":case"person":return(0,o.castToNotionValue)(i(e,t),t);case"multi_select":case"select":case"status":return(0,o.castToNotionValue)(function(e,t){const n=t.options.reduce((e,t)=>(e[t.id]=t.value,e),{});return e.map(e=>n[e]).filter(e=>null!=e)}(e||[],t),t);default:return(0,o.castToNotionValue)(e,t)}}(e,t);return console.log("casting",e,"to",n,"for property",t),n}catch(e){return console.error(e),null}},t.idToRelations=i,t.mapIdToRelations=function(e,t){const n={relation:"p",person:"u"};let o=e||[],i=[];return o.forEach((e,r)=>{i.push(["â€£",[[n[t],e]]]),r+1<o.length&&i.push([","])}),i}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.castToNotionValue=void 0;const o=n(0),i=n(14);t.castToNotionValue=(e,t)=>{switch(t.type){case"checkbox":if("boolean"!=typeof e)throw`value passed to property ${t.strippedName} must be bool`;return[[e?"Yes":"No"]];case"file":if(0==e.length)return null;let n=[];return(null!=e?e:[]).forEach((t,o)=>{let r=(0,i.getFilenameFromUrl)(t.imgUrl).trim();n.push([""+(r.length?r:"file"),[["a",t.imgUrl]]]),o+1<e.length&&n.push([","])}),n;case"date":if(null==e)return[];return[["â€£",[["d",Array.isArray(e)?{type:"daterange",start_date:(0,o.formatDateToNotionDate)(e[0]),end_date:(0,o.formatDateToNotionDate)(e[1])}:{type:"date",start_date:(0,o.formatDateToNotionDate)(e)}]]]];case"url":case"select":case"status":case"text":case"title":return[[null!=e?e:""]];case"number":return"percent"==(null==t?void 0:t.number_format)?[[String(parseFloat(e)/100)]]:[[String(parseFloat(e))]];case"multi_select":return[[e.join(",")]];case"person":case"relation":return e;default:return(0,o.print)(`WARNING: ${t.type} not uncasted`),[[e]]}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.log=void 0;const o=new(n(71).Logger)("notionapi-agent");t.log=o},function(e,t,n){(function(e,n){var o="[object Arguments]",i="[object Map]",r="[object Object]",a="[object Set]",s=/^\[object .+?Constructor\]$/,c=/^(?:0|[1-9]\d*)$/,l={};l["[object Float32Array]"]=l["[object Float64Array]"]=l["[object Int8Array]"]=l["[object Int16Array]"]=l["[object Int32Array]"]=l["[object Uint8Array]"]=l["[object Uint8ClampedArray]"]=l["[object Uint16Array]"]=l["[object Uint32Array]"]=!0,l[o]=l["[object Array]"]=l["[object ArrayBuffer]"]=l["[object Boolean]"]=l["[object DataView]"]=l["[object Date]"]=l["[object Error]"]=l["[object Function]"]=l[i]=l["[object Number]"]=l[r]=l["[object RegExp]"]=l[a]=l["[object String]"]=l["[object WeakMap]"]=!1;var u="object"==typeof e&&e&&e.Object===Object&&e,d="object"==typeof self&&self&&self.Object===Object&&self,p=u||d||Function("return this")(),h=t&&!t.nodeType&&t,f=h&&"object"==typeof n&&n&&!n.nodeType&&n,v=f&&f.exports===h,g=v&&u.process,m=function(){try{return g&&g.binding&&g.binding("util")}catch(e){}}(),y=m&&m.isTypedArray;function b(e,t){for(var n=-1,o=null==e?0:e.length;++n<o;)if(t(e[n],n,e))return!0;return!1}function _(e){var t=-1,n=Array(e.size);return e.forEach((function(e,o){n[++t]=[o,e]})),n}function w(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=e})),n}var C,O,I,k=Array.prototype,P=Function.prototype,j=Object.prototype,T=p["__core-js_shared__"],S=P.toString,x=j.hasOwnProperty,M=(C=/[^.]+$/.exec(T&&T.keys&&T.keys.IE_PROTO||""))?"Symbol(src)_1."+C:"",A=j.toString,U=RegExp("^"+S.call(x).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),E=v?p.Buffer:void 0,N=p.Symbol,D=p.Uint8Array,F=j.propertyIsEnumerable,R=k.splice,B=N?N.toStringTag:void 0,W=Object.getOwnPropertySymbols,L=E?E.isBuffer:void 0,V=(O=Object.keys,I=Object,function(e){return O(I(e))}),$=me(p,"DataView"),H=me(p,"Map"),q=me(p,"Promise"),K=me(p,"Set"),z=me(p,"WeakMap"),G=me(Object,"create"),Q=we($),J=we(H),Y=we(q),X=we(K),Z=we(z),ee=N?N.prototype:void 0,te=ee?ee.valueOf:void 0;function ne(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var o=e[t];this.set(o[0],o[1])}}function oe(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var o=e[t];this.set(o[0],o[1])}}function ie(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var o=e[t];this.set(o[0],o[1])}}function re(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new ie;++t<n;)this.add(e[t])}function ae(e){var t=this.__data__=new oe(e);this.size=t.size}function se(e,t){var n=Ie(e),o=!n&&Oe(e),i=!n&&!o&&ke(e),r=!n&&!o&&!i&&xe(e),a=n||o||i||r,s=a?function(e,t){for(var n=-1,o=Array(e);++n<e;)o[n]=t(n);return o}(e.length,String):[],c=s.length;for(var l in e)!t&&!x.call(e,l)||a&&("length"==l||i&&("offset"==l||"parent"==l)||r&&("buffer"==l||"byteLength"==l||"byteOffset"==l)||_e(l,c))||s.push(l);return s}function ce(e,t){for(var n=e.length;n--;)if(Ce(e[n][0],t))return n;return-1}function le(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":B&&B in Object(e)?function(e){var t=x.call(e,B),n=e[B];try{e[B]=void 0;var o=!0}catch(e){}var i=A.call(e);o&&(t?e[B]=n:delete e[B]);return i}(e):function(e){return A.call(e)}(e)}function ue(e){return Se(e)&&le(e)==o}function de(e,t,n,s,c){return e===t||(null==e||null==t||!Se(e)&&!Se(t)?e!=e&&t!=t:function(e,t,n,s,c,l){var u=Ie(e),d=Ie(t),p=u?"[object Array]":be(e),h=d?"[object Array]":be(t),f=(p=p==o?r:p)==r,v=(h=h==o?r:h)==r,g=p==h;if(g&&ke(e)){if(!ke(t))return!1;u=!0,f=!1}if(g&&!f)return l||(l=new ae),u||xe(e)?fe(e,t,n,s,c,l):function(e,t,n,o,r,s,c){switch(n){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":return!(e.byteLength!=t.byteLength||!s(new D(e),new D(t)));case"[object Boolean]":case"[object Date]":case"[object Number]":return Ce(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case i:var l=_;case a:var u=1&o;if(l||(l=w),e.size!=t.size&&!u)return!1;var d=c.get(e);if(d)return d==t;o|=2,c.set(e,t);var p=fe(l(e),l(t),o,r,s,c);return c.delete(e),p;case"[object Symbol]":if(te)return te.call(e)==te.call(t)}return!1}(e,t,p,n,s,c,l);if(!(1&n)){var m=f&&x.call(e,"__wrapped__"),y=v&&x.call(t,"__wrapped__");if(m||y){var b=m?e.value():e,C=y?t.value():t;return l||(l=new ae),c(b,C,n,s,l)}}if(!g)return!1;return l||(l=new ae),function(e,t,n,o,i,r){var a=1&n,s=ve(e),c=s.length,l=ve(t).length;if(c!=l&&!a)return!1;var u=c;for(;u--;){var d=s[u];if(!(a?d in t:x.call(t,d)))return!1}var p=r.get(e);if(p&&r.get(t))return p==t;var h=!0;r.set(e,t),r.set(t,e);var f=a;for(;++u<c;){d=s[u];var v=e[d],g=t[d];if(o)var m=a?o(g,v,d,t,e,r):o(v,g,d,e,t,r);if(!(void 0===m?v===g||i(v,g,n,o,r):m)){h=!1;break}f||(f="constructor"==d)}if(h&&!f){var y=e.constructor,b=t.constructor;y==b||!("constructor"in e)||!("constructor"in t)||"function"==typeof y&&y instanceof y&&"function"==typeof b&&b instanceof b||(h=!1)}return r.delete(e),r.delete(t),h}(e,t,n,s,c,l)}(e,t,n,s,de,c))}function pe(e){return!(!Te(e)||function(e){return!!M&&M in e}(e))&&(Pe(e)?U:s).test(we(e))}function he(e){if(n=(t=e)&&t.constructor,o="function"==typeof n&&n.prototype||j,t!==o)return V(e);var t,n,o,i=[];for(var r in Object(e))x.call(e,r)&&"constructor"!=r&&i.push(r);return i}function fe(e,t,n,o,i,r){var a=1&n,s=e.length,c=t.length;if(s!=c&&!(a&&c>s))return!1;var l=r.get(e);if(l&&r.get(t))return l==t;var u=-1,d=!0,p=2&n?new re:void 0;for(r.set(e,t),r.set(t,e);++u<s;){var h=e[u],f=t[u];if(o)var v=a?o(f,h,u,t,e,r):o(h,f,u,e,t,r);if(void 0!==v){if(v)continue;d=!1;break}if(p){if(!b(t,(function(e,t){if(a=t,!p.has(a)&&(h===e||i(h,e,n,o,r)))return p.push(t);var a}))){d=!1;break}}else if(h!==f&&!i(h,f,n,o,r)){d=!1;break}}return r.delete(e),r.delete(t),d}function ve(e){return function(e,t,n){var o=t(e);return Ie(e)?o:function(e,t){for(var n=-1,o=t.length,i=e.length;++n<o;)e[i+n]=t[n];return e}(o,n(e))}(e,Me,ye)}function ge(e,t){var n,o,i=e.__data__;return("string"==(o=typeof(n=t))||"number"==o||"symbol"==o||"boolean"==o?"__proto__"!==n:null===n)?i["string"==typeof t?"string":"hash"]:i.map}function me(e,t){var n=function(e,t){return null==e?void 0:e[t]}(e,t);return pe(n)?n:void 0}ne.prototype.clear=function(){this.__data__=G?G(null):{},this.size=0},ne.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},ne.prototype.get=function(e){var t=this.__data__;if(G){var n=t[e];return"__lodash_hash_undefined__"===n?void 0:n}return x.call(t,e)?t[e]:void 0},ne.prototype.has=function(e){var t=this.__data__;return G?void 0!==t[e]:x.call(t,e)},ne.prototype.set=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=G&&void 0===t?"__lodash_hash_undefined__":t,this},oe.prototype.clear=function(){this.__data__=[],this.size=0},oe.prototype.delete=function(e){var t=this.__data__,n=ce(t,e);return!(n<0)&&(n==t.length-1?t.pop():R.call(t,n,1),--this.size,!0)},oe.prototype.get=function(e){var t=this.__data__,n=ce(t,e);return n<0?void 0:t[n][1]},oe.prototype.has=function(e){return ce(this.__data__,e)>-1},oe.prototype.set=function(e,t){var n=this.__data__,o=ce(n,e);return o<0?(++this.size,n.push([e,t])):n[o][1]=t,this},ie.prototype.clear=function(){this.size=0,this.__data__={hash:new ne,map:new(H||oe),string:new ne}},ie.prototype.delete=function(e){var t=ge(this,e).delete(e);return this.size-=t?1:0,t},ie.prototype.get=function(e){return ge(this,e).get(e)},ie.prototype.has=function(e){return ge(this,e).has(e)},ie.prototype.set=function(e,t){var n=ge(this,e),o=n.size;return n.set(e,t),this.size+=n.size==o?0:1,this},re.prototype.add=re.prototype.push=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this},re.prototype.has=function(e){return this.__data__.has(e)},ae.prototype.clear=function(){this.__data__=new oe,this.size=0},ae.prototype.delete=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n},ae.prototype.get=function(e){return this.__data__.get(e)},ae.prototype.has=function(e){return this.__data__.has(e)},ae.prototype.set=function(e,t){var n=this.__data__;if(n instanceof oe){var o=n.__data__;if(!H||o.length<199)return o.push([e,t]),this.size=++n.size,this;n=this.__data__=new ie(o)}return n.set(e,t),this.size=n.size,this};var ye=W?function(e){return null==e?[]:(e=Object(e),function(e,t){for(var n=-1,o=null==e?0:e.length,i=0,r=[];++n<o;){var a=e[n];t(a,n,e)&&(r[i++]=a)}return r}(W(e),(function(t){return F.call(e,t)})))}:function(){return[]},be=le;function _e(e,t){return!!(t=null==t?9007199254740991:t)&&("number"==typeof e||c.test(e))&&e>-1&&e%1==0&&e<t}function we(e){if(null!=e){try{return S.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function Ce(e,t){return e===t||e!=e&&t!=t}($&&"[object DataView]"!=be(new $(new ArrayBuffer(1)))||H&&be(new H)!=i||q&&"[object Promise]"!=be(q.resolve())||K&&be(new K)!=a||z&&"[object WeakMap]"!=be(new z))&&(be=function(e){var t=le(e),n=t==r?e.constructor:void 0,o=n?we(n):"";if(o)switch(o){case Q:return"[object DataView]";case J:return i;case Y:return"[object Promise]";case X:return a;case Z:return"[object WeakMap]"}return t});var Oe=ue(function(){return arguments}())?ue:function(e){return Se(e)&&x.call(e,"callee")&&!F.call(e,"callee")},Ie=Array.isArray;var ke=L||function(){return!1};function Pe(e){if(!Te(e))return!1;var t=le(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t}function je(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}function Te(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function Se(e){return null!=e&&"object"==typeof e}var xe=y?function(e){return function(t){return e(t)}}(y):function(e){return Se(e)&&je(e.length)&&!!l[le(e)]};function Me(e){return null!=(t=e)&&je(t.length)&&!Pe(t)?se(e):he(e);var t}n.exports=function(e,t){return de(e,t)}}).call(this,n(81),n(82)(e))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.findTemplateFieldDefaultValue=void 0,t.findTemplateFieldDefaultValue=function(e){var t;const n=null===(t=e.daps)||void 0===t?void 0:t.find(e=>{var t;return"template"==(null===(t=e.property)||void 0===t?void 0:t.type)});if(n)return n.options.defaultValue}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ellipsis=void 0,t.ellipsis=function(e,t){return e.length>t?e.substring(0,t)+"...":e}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.cast=void 0,t.cast=function(e){return e}},function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function a(e){try{c(o.next(e))}catch(e){r(e)}}function s(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.addHighlight=t.manageUploadingFiles=t.uploadFile=void 0;const i=n(11),r=n(2),a=n(42),s=n(0),c=n(34);function l(e,{capturedWebpage:t}){var n,o;return"page"==t.savingTo&&null!=(null===(o=null===(n=null==e?void 0:e.properties)||void 0===n?void 0:n.content)||void 0===o?void 0:o.content)}function u(e,t){return"screenshot"==e.type?function(e,{notionParent:t,capturedWebpage:n,activeUserId:o,savingAs:i}){var r,a;return Object.assign(Object.assign({},t),{text:e.url?[["[ðŸ”— link]",[["a",e.url]]],[" â€” "+(null!==(a=null===(r=e.name)||void 0===r?void 0:r.trim())&&void 0!==a?a:"Untitled")]]:e.name,blockFormat:i,isSubpage:"page"==n.savingTo&&"page"==i,afterId:n.notionListAfterId,notionSpaceId:n.notionSpaceId,userId:o,properties:{}})}(e,t):"highlight"==e.type?function(e,{notionParent:t,capturedWebpage:n,notionClient:o,activeUserId:i,savingAs:s}){var c,l;let u=e;const d=(null===(c=u.caption)||void 0===c?void 0:c.length)>0,p="collection"==n.savingTo;let h=p?`"${u.text}"${d?" â€” "+u.caption:""}`:u.text;return Object.assign(Object.assign({},t),{text:h,blockFormat:p?"page":null!==(l=u.highlightFormat)&&void 0!==l?l:r.HighlightFormat.bullet,afterId:n.notionListAfterId,notionSpaceId:n.notionSpaceId,userId:i,extraOperationsFn:!p&&d?({newBlockId:e,operations:t})=>o.custom.addBlockGetOperations({notionParentId:e,text:`${a.PREFIX_CAPTION} ${u.caption}`,blockFormat:r.HighlightFormat.bullet,notionSpaceId:n.notionSpaceId,userId:i,blockColor:"gray"}).operations:void 0})}(e,t):function(e,{notionParent:t,capturedWebpage:n,activeUserId:o,savingAs:i}){return Object.assign(Object.assign({},t),{text:e.note,blockFormat:i,isSubpage:"page"==n.savingTo&&"page"==i,afterId:n.notionListAfterId,notionSpaceId:n.notionSpaceId,userId:o,properties:{}})}(e,t)}function d(e){return"page"==e.capturedWebpage.savingTo?{notionParentId:e.capturedWebpage.notionPageId,notionParentTable:"block"}:{notionParentId:e.capturedWebpage.notionCollectionId,notionParentTable:"collection"}}function p(e){var t,n,o,i,r,a,l,u,d,p,h,f,v,g;const m=Object.keys(e)[0];switch(m){case"image":{let i=e[m];return null!==(o=null===(n=null===(t=null==i?void 0:i.items)||void 0===t?void 0:t[0])||void 0===n?void 0:n.imgUrl)&&void 0!==o?o:void 0}case"file":{let t=e[m];if(0==t.items.length)return;let n=[];return t.items.forEach((e,o)=>{let i=(r=e.imgUrl,r.split("/").pop().split("#")[0].split("?")[0]).trim();var r;n.push([""+(i.length?i:"file"),[["a",e.imgUrl]]]),o+1<t.items.length&&n.push([","])}),n}case"select":return[[null!==(a=null===(r=null===(i=e[m].items)||void 0===i?void 0:i[0])||void 0===r?void 0:r.value)&&void 0!==a?a:""]];case"status":return[[null!==(d=null===(u=null===(l=e[m].items)||void 0===l?void 0:l[0])||void 0===u?void 0:u.value)&&void 0!==d?d:""]];case"multi_select":return[[null!==(f=null===(h=null===(p=e[m].items)||void 0===p?void 0:p.map(e=>e.value))||void 0===h?void 0:h.join(","))&&void 0!==f?f:""]];case"relation":{let t=e[m];return(0,c.mapIdToRelations)(null===(v=t.items)||void 0===v?void 0:v.map(e=>e.id),"relation")}case"person":{let t=e[m];return(0,c.mapIdToRelations)(null===(g=t.items)||void 0===g?void 0:g.map(e=>e.id),"person")}case"date":{let t=e[m];if(null==t)return[];return[["â€£",[["d",Array.isArray(t)?{type:"daterange",start_date:(0,s.formatDateToNotionDate)(t[0]),end_date:(0,s.formatDateToNotionDate)(t[1])}:{type:"date",start_date:(0,s.formatDateToNotionDate)(t)}]]]]}case"url":{let t=e[m];return[[null!=t?t:""]]}case"text":{let t=e[m];return[[null!=t?t:""]]}case"title":{let t=e[m];return[[null!=t?t:""]]}case"email":{let t=e[m];return[[null!=t?t:""]]}case"phone_number":{let t=e[m];return[[null!=t?t:""]]}case"number":{let t=e[m];return[[null!=t?t:""]]}case"checkbox":return[[e[m]?"Yes":"No"]]}}const h={icon:"page_icon",pageIcon:"page_icon",pageCover:"page_cover"};function f(e){e.withChildren={content:[],contentBlocks:[]}}function v(e){const t={large:{width:672,height:380},normal:{width:672,height:250},small:{width:336,height:175}};if("fitImage"==e.type)return function(){if(!e.width||!e.height)return{format:{block_full_width:!1,block_page_width:!1}};let n={width:e.width,height:e.height};n.width>t.normal.width&&(n.height=Math.floor(n.height*(t.normal.width/n.width)),n.width=t.normal.width);n.height>t.normal.height&&(n.width=Math.floor(n.width*(t.normal.height/n.height)),n.height=t.normal.height);return e.width>=t.normal.width?{format:{block_full_width:!0,block_page_width:!1}}:{format:{block_width:e.width,block_full_width:!1,block_page_width:!1}}}();const n=t[e.size].width,o=t[e.size].height;let i=null,r=null,a=!1,s=!1;switch(e.type){case"coverLike":"large"==e.size&&(s=!0),i=e.width,r=e.height,i!=n&&(r=Math.floor(r*(n/i)),i=n),r>o&&(i=Math.floor(i*(o/r)),r=o),i<n&&(s=!1),r=null;break;case"fullWidthCover":a=!0,r=o}return{format:{block_height:r,block_width:i,block_full_width:a,block_page_width:s}}}const g={pageFrontImage:(e,t,n)=>{const r=e.image;0!=r.items.length&&r.items.forEach(e=>{!function(e,t,n){o(this,void 0,void 0,(function*(){const o=function(e){const t=e.match(/^(https:\/\/pbs\.twimg\.com\/media\/\w+)(\?format=(jpg|png).*)$/);return t?t[1]+"."+t[3]+t[2]:e}(e.imgUrl),r=e.caption,a=e.fileId;a&&(e.fileId=null),t.withChildren||f(t);const s=(0,i.genUuid)();t.withChildren.content.push(s),t.withChildren.contentBlocks.push({role:"reader",value:Object.assign(Object.assign(Object.assign({id:s,version:1,type:"image",properties:Object.assign({source:[[o]]},r?{caption:[[r]]}:{})},a?{file_ids:[a]}:{}),{alive:!0,created_time:Date.now(),last_edited_time:Date.now(),created_by_table:"notion_user",created_by_id:n.activeUserId,last_edited_by_table:"notion_user",last_edited_by_id:n.activeUserId,space_id:n.capturedWebpage.notionSpaceId}),v({type:"fitImage",size:"normal",width:e.width,height:e.height}))})}))}(e,t,n)})},template:(e,t,n)=>{var i,r;if(!e.template)return;t.withCallback=t=>o(void 0,void 0,void 0,(function*(){yield n.notionClient.custom.createAsyncTaskToCopyTemplateContent({templateId:e.template.id,targetPageId:t,currentUserId:n.activeUserId,spaceId:n.spaceId})}));let a=null!==(i=e.template.properties)&&void 0!==i?i:{},c=null!==(r=e.template.format)&&void 0!==r?r:{};t.format=Object.assign(Object.assign({},c),t.format),t.properties=Object.assign(Object.assign({},(0,s.omit)(a,"title")),t.properties)},content:(e,t,n)=>{function o(e){const[n,...o]=Object.values(e);"page"!=n.value.type?(t.withChildren.content.push(n.value.id),t.withChildren.contentBlocks.push(n,...o)):(t.withChildren.content.push(...n.value.content),t.withChildren.contentBlocks.push(...o))}e.content&&(t.withChildren||f(t),e.content.notionOutput?o(e.content.notionOutput):"list"==e.content.type&&e.content.items.forEach(e=>{o(e.notionOutput)}))}};function m(e,t,n){const o=Object.entries(null!=t?t:{}),i=o.filter(([e,t])=>e in h).map(([e,t])=>[h[e],p(t)]).filter(([e,t])=>null!=t),r=o.filter(([e,t])=>e in g).map(([e,t])=>[e,t]),a=Object.assign(Object.assign({},Object.fromEntries(i)),Object.fromEntries(r)),s=o.filter(([e,t])=>!(e in a)).map(([e,t])=>[e,p(t)]).filter(([e,t])=>null!=t),c=function(e){return Object.entries(null!=e?e:{}).flatMap(([e,t])=>{var n,o,i;const r=Object.keys(t)[0];return"template"==r?t.template.fileIds||[]:"file"!=r&&"image"!=r?[]:null!==(i=null===(o=null===(n=t[r])||void 0===n?void 0:n.items)||void 0===o?void 0:o.filter(e=>null!=e.fileId).map(e=>e.fileId))&&void 0!==i?i:[]})}(t),l=Object.assign({properties:Object.fromEntries(s),format:Object.fromEntries(i)},c.length>0?{fileIds:c}:{});return r.forEach(([e,t])=>{g[e](t,l,n)}),l}function y(e){return o(this,void 0,void 0,(function*(){return e.context.notionClient.custom.uploadFile({dataB64:e.dataB64,record:e.record,onProgress:t=>{e.onProgress(t)}})}))}function b({properties:e,record:t,context:n}){return o(this,void 0,void 0,(function*(){const o=Object.entries(null!=e?e:{}).flatMap(([e,t])=>{var n,o,i;if(null==(null==(i=t)?void 0:i.image)&&null==(null==i?void 0:i.file))return[];const r=null===(o=null===(n=t[Object.keys(t)[0]])||void 0===n?void 0:n.items)||void 0===o?void 0:o.map((e,t)=>({item:e,index:t})).filter(({item:e,index:t})=>e.needToUploadFile);return r&&r.length?r.map(({item:n,index:o})=>({propertyId:e,item:n,type:t.image?"image":"file",index:o})):[]});let i=0;for(const{propertyId:r,item:a,type:s,index:c}of o){n.updateProgressToast({message:`Uploading ${i+1}/${o.length} file... 0%`});const l=yield y({dataB64:a.imgUrl,record:t,onProgress:e=>{n.updateProgressToast({message:`Uploading ${i+1}/${o.length} file... ${e}%`})},context:n});if(null==l||0==l.success)throw new Error("failed to upload file");const u=e[r][s];u.items[c].needToUploadFile=!1,u.items[c]=Object.assign(Object.assign({},u.items[c]),{needToUploadFile:!1,fileId:l.fileId,imgUrl:l.url}),i+=1}}))}function _(e){return e.replace(/-/g,"")}t.uploadFile=y,t.manageUploadingFiles=b,t.addHighlight=function(e,{notionClient:t,log:n,db:i,updateToast:a,highlightContextData:c}){var p,h;return o(this,void 0,void 0,(function*(){const f=e.highlight,v=yield i.user.load(),g=yield i.capturedWebpage.get(f.capturedWebpageId);let y;n("save highlight to Notion");let w=null!==(p=v.settings.highlightFormat)&&void 0!==p?p:r.HighlightFormat.bullet;const C={capturedWebpage:g,activeUserId:t.activeUserId,spaceId:g.notionSpaceId,notionParent:d({capturedWebpage:g}),notionClient:t,savingAs:"collection"==g.savingTo||l(f,{capturedWebpage:g})?"page":r.HighlightFormat.bullet,updateProgressToast:e=>o(this,void 0,void 0,(function*(){return a({id:f.id,type:"progress",message:e.message})})),updateHighlight:e=>o(this,void 0,void 0,(function*(){}))};let O=f.properties;"screenshot"==f.type&&(O=Object.assign(Object.assign({},O),{pageFrontImage:{image:{items:[Object.assign({imgUrl:null===(h=null==c?void 0:c.image)||void 0===h?void 0:h.imageBase64,needToUploadFile:!0},f.caption&&{caption:f.caption})]}}}));const I=u(f,C);if(yield b({properties:O,record:{id:I.notionParentId,table:I.notionParentTable,spaceId:I.notionSpaceId},context:C}),n("save highlight... in database"),function(e,t,n){const o=m(0,t,n);(0,s.mergeDeep)(e,o)}(I,O,C),console.debug("saving",I,">",O,C),yield a({id:f.id,type:"progress",message:"Saving to Notion..."}),y=yield t.custom.addBlock(I),null==y)throw new Error("Failed to save to Notion");n("save highlight in database");const k=yield i.highlight.get(f.id),P=Object.assign(Object.assign({},k),{notionBlockId:y,notionBlockFormat:w});yield i.highlight.save(f.id,P),n("update capturedWebpage.listAfter in database"),yield i.capturedWebpage.save(g.id,Object.assign(Object.assign({},g),{notionListAfterId:y}));const j=function(e,t){return"page"==t.savingAs?"https://notion.so/"+_(e):`https://notion.so/${_(t.capturedWebpage.notionPageId)}#${_(e)}`}(y,C);return yield a({id:f.id,type:"success",message:"Saved to Notion!",action:{url:j,message:"Open in Notion"},timeout:4e3}),n("success!"),{notionBlockId:y,notionBlockFormat:I.blockFormat,title:I.text,notionParentId:I.notionParentId,savingAs:C.savingAs}}))}},function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function a(e){try{c(o.next(e))}catch(e){r(e)}}function s(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.updateCaptionHighlight=t.PREFIX_CAPTION=void 0,t.PREFIX_CAPTION="ðŸ“",t.updateCaptionHighlight=function(e,{notionClient:t,log:n,db:i}){return o(this,void 0,void 0,(function*(){}))}},function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function a(e){try{c(o.next(e))}catch(e){r(e)}}function s(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.clipContent=t.injectQuickCapture=t.quickCapture=void 0;const i=n(26),r=n(3),a=n(22);function s(e,t,n){return o(this,void 0,void 0,(function*(){(0,a.getIdName)();yield(0,r.executeQuickCapture)(null,n)}))}t.quickCapture=s,t.injectQuickCapture=function(e){return o(this,void 0,void 0,(function*(){return s(0,0,e)}))},t.clipContent=function(e,t,n){return o(this,void 0,void 0,(function*(){const o=(0,a.getIdName)();(0,r.executeClipContent)(`\n  var idName = "${o}";\n  var popupUrl = ${JSON.stringify((0,i.getPopupUrl)(o))};\n  var action = ${JSON.stringify(e)};\n  var props = ${JSON.stringify(t)};\n  `,n)}))}},function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function a(e){try{c(o.next(e))}catch(e){r(e)}}function s(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.injectPopupIframe=void 0;const i=n(26),r="Save to Notion cannot be used on the current page, please try on a different page.",a=["chrome://","https://chrome.google.com/","https://www.homedepot.com"];t.injectPopupIframe=function(e){return o(this,void 0,void 0,(function*(){if(a.some(t=>e.url.startsWith(t)))alert(r);else try{(0,i.dialogInjectAction)("open",e.id)}catch(e){alert(r)}}))}},function(e,t,n){"use strict";window.global||(window.global=window)},function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function a(e){try{c(o.next(e))}catch(e){r(e)}}function s(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.handleSocketCommunication=t.handleMessage=t.replyMessages=void 0;const i=n(0),r=n(27),a=n(47),s=n(98),c=n(99),l=n(100),u=n(101),d=n(19),p=n(24),h=n(25),f=[u.basicRepliesMap,s.mailIntegrationRepliesMap,c.paymentRepliesMap,l.screenshotRepliesMap,d.notionSyncMap];function v(e,t){var n,r;return o(this,void 0,void 0,(function*(){if(e.popup)return(0,i.print)("send again",null===(n=t.tab)||void 0===n?void 0:n.id),chrome.tabs.sendMessage(null===(r=t.tab)||void 0===r?void 0:r.id,Object.assign(Object.assign({},e),{fromBackground:!0})),null;const o=function(e){const t=f.find(t=>e in t);return t&&t[e]}(e.type);return o?o(e,t):((0,i.print)("command not recognized:",null==e?void 0:e.type),null)}))}function g(e,t){return new Promise(n=>o(this,void 0,void 0,(function*(){e(yield t()),n(!0)}))),!0}t.replyMessages=v,t.handleMessage=function(e,t,n){var o;return e.v2?(console.log("event v2",null==e?void 0:e.event,e),"background"!=e.destination?"content"===e.destination?((0,h.contentAsk)(e.event,e.props,null===(o=t.tab)||void 0===o?void 0:o.id).then(n),!0):void 0:g(n,()=>{var n,o;return null===(o=(n=p.bgActionsMap)[e.event])||void 0===o?void 0:o.call(n,e.props,t)})):((0,i.print)("bgEvent",null==e?void 0:e.type,e),g(n,()=>v(e,t)))},t.handleSocketCommunication=function(e){return o(this,void 0,void 0,(function*(){if(e.name in p.bgActionsMap)e.onMessage.addListener((function(t){"payload"==t.event&&p.bgActionsMap[e.name](t.props,e.sender,{onProgress:t=>{e.postMessage({event:"progress",props:t})}}).then(t=>{e.postMessage({event:"done",props:t}),e.disconnect()}).catch(t=>{e.postMessage({event:"error",props:null}),e.disconnect()})}));else switch(e.name){case"submit_form_to_notion":return void e.onMessage.addListener((function(t){return o(this,void 0,void 0,(function*(){switch((0,i.print)("received",t),t.type){case"initial_data":try{(0,i.print)("initial_data"),yield(0,a.savePageToNotion)({port:e,form:t.params.form,currentUrl:t.params.currentUrl,capturedWebpageId:t.params.capturedWebpageId,mode:t.params.mode})}catch(t){(0,i.print)("FATAL ERROR"),console.error(t);const n={code:"BACKGROUND_FAILED_CODE"};e.postMessage({type:"error",error:n}),e.disconnect()}}}))}));case"get_metadatas":const t=yield(0,r.getCurrentPageHtmlMetaData)();return t?e.postMessage({type:"done",data:t}):e.postMessage({type:"error"}),void e.disconnect()}}))}},function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function a(e){try{c(o.next(e))}catch(e){r(e)}}function s(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.savePageToNotion=void 0;const i=n(9),r=n(0),a=n(38),s=n(86),c=n(39),l=n(1),u=n(2),d=n(15),p=n(18),h=n(19);t.savePageToNotion=function({port:e,form:t,currentUrl:n,capturedWebpageId:f,mode:v}){var g,m;return o(this,void 0,void 0,(function*(){e.postMessage({type:"submitting"});const y=yield(0,i.getClient)();if("error"==y.status)return k({code:"BACKGROUND_ON_SUBMIT_NOT_LOGGED_IN_TO_NOTION"});let b=y.client;const _=new d.NotionV3Client({token:b.authToken,activeUserId:b.agent.activeUserId});if("page"==t.savingTo)return function(e,t){return o(this,void 0,void 0,(function*(){const n=yield(0,s.formatData)(e.form),o=yield t.notionClient.custom.addBookmark({notionParentId:e.form.page.id,notionSpaceId:e.form.spaceId,url:e.currentUrl,title:n.title});yield l.db.custom.createCapturedWebpage(Object.assign(Object.assign({savingTo:"page",notionBookmarkId:o,capturedWebpageId:e.capturedWebpageId,notionPageId:e.form.page.id,notionCollectionId:null,icon:null,url:"quickNote"==e.mode?null:e.currentUrl},"quickNote"==e.mode&&{source:"capture"}),{notionListAfterId:o,title:n.title||null,formId:e.form.id,notionSpaceId:e.form.spaceId,clipFormat:1==e.form.savePageContent?u.ClipFormat.extractFullPage:u.ClipFormat.bookmark})),e.port.postMessage({type:"success_submit",id:o}),(0,p.showSavedBadgeIfPossible)()}))}({port:e,form:t,currentUrl:n,capturedWebpageId:f,mode:v},{notionClient:_});let w,C;try{w=yield b.getCollectionLocally(t.collection.id,t.collection.parent_id,t.collection.schema,t.spaceId)}catch(e){return k({code:"BACKGROUND_FAILED_CODE"})}try{C=yield(0,s.formatData)(t)}catch(e){return k({code:"BACKGROUND_FORMATING_ERROR",log:(0,c.ellipsis)((""+e).split("\n")[0].trim(),50)})}C.title||(C.title="Untitled"),t.clipData&&(0,r.print)("CLIP DATA",t.clipData);const O=(0,a.findTemplateFieldDefaultValue)(t);if(O){const e=yield function(e,t,n,a,s){return o(this,void 0,void 0,(function*(){(0,r.print)("fetching template",t.needToRefreshTemplate,null==n?void 0:n.id);try{let o=yield(0,i.getUpToDateTemplateBlocksMap)(a,n.id,t.needToRefreshTemplate);if((0,r.print)("now",n.id,o),e.__template={blocksMap:o,id:n.id},t.needToRefreshTemplate){(0,r.print)("save template info");const e=yield(0,i.getFormData)(t.id,{client:a,saveToNotionClient:null,app:null});yield(0,i.saveFormData)(Object.assign(Object.assign({},e),{daps:e.daps.map(e=>"template"===e.key?Object.assign(Object.assign({},e),{options:Object.assign(Object.assign({},e.options),{defaultValue:Object.assign(Object.assign({},n),{lastEditedTime:Date.now()})})}):e)}),"edit",t.id,void 0,void 0,s)}}catch(e){(0,r.print)("failed to fetch template...",e);let t=(0,c.ellipsis)((""+e).split("\n")[0].trim(),50);return(0,r.print)("error formatting",e),t.includes("APIError")&&t.includes("Token")?{code:"BACKGROUND_TOKEN_EXPIRED"}:{code:"BACKGROUND_FAILED_TO_FETCH_NOTION_TEMPLATE",log:t,logDetailed:""+e}}return null}))}(C,t,O,b,v);if(e)return k(e)}let I;(0,r.print)("formatted data",C),(0,r.print)("submit to notion..."),(0,r.print)("got",t.savePageContent,w,n);try{I=yield w.createRow(C,t.spaceId,t.clipData?t.clipData.clipOption:t.savePageContent?u.ClipOption.defaultClip:u.ClipOption.noClip,{title:"Full Page Articles",url:n})}catch(e){(0,r.print)("failed to submit",e);let t=(0,c.ellipsis)((""+e).split("\n")[0].trim(),50);return t.includes("Failed to fetch")?k({code:"NO_INTERNET"}):t.includes("APIError")&&t.includes("Token")?k({code:"BACKGROUND_TOKEN_EXPIRED"}):k({code:"BACKGROUND_FAILED_TO_CREATE_PAGE",log:t,logDetailed:`${e}\n${e.stack}`})}if(null!=n||"quickNote"==v){let e=n;yield l.db.custom.createCapturedWebpage(Object.assign(Object.assign({capturedWebpageId:f,notionPageId:I.id,notionCollectionId:t.collection.id,icon:I.pageIcon||null,url:"quickNote"==v?null:e},"quickNote"==v&&{source:"capture"}),{notionListAfterId:I.highlightAfterId,title:C.title||null,formId:t.id,notionSpaceId:t.spaceId,clipFormat:1==t.savePageContent?u.ClipFormat.extractFullPage:u.ClipFormat.bookmark}))}if(null===(m=null===(g=t.clipData)||void 0===g?void 0:g.clips)||void 0===m?void 0:m.length){let e=1;for(let n of t.clipData.clips)yield(0,h.addNotionSyncEvent)({type:"uploadClip",capturedWebpageId:f,clipCount:1,clip:n}),e++}function k(t){e.postMessage({type:"error",error:t}),e.disconnect()}e.postMessage({type:"success_submit",id:I.id}),(0,p.showSavedBadgeIfPossible)()}))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.databaseV2=void 0;const o=n(10),i=n(6);t.databaseV2={user:(0,i.genSingle)("user",{forms:[],settings:o.defaultAppSettings}),form:(0,i.genCrud)("forms",null),notionCollection:(0,i.genCrud)("notionCollections")}},function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function a(e){try{c(o.next(e))}catch(e){r(e)}}function s(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.migrationV1=t.FORM_KEY_PREFIX=t.FORM_LIST_KEY=void 0,t.FORM_LIST_KEY="STORAGE_KEY_FORM_LIST",t.FORM_KEY_PREFIX="form-",t.migrationV1={storageKeysToRemove:["FORM_LIST_KEY"],up(e,n){var i,r,a;return o(this,void 0,void 0,(function*(){const e=yield n.get(t.FORM_LIST_KEY,[]);this.storageKeysToRemove.push(t.FORM_LIST_KEY);const o={forms:e.map(e=>{var t;return{id:e.id,name:e.name,favorite:e.favorite,isFolder:null!==(t=e.isFolder)&&void 0!==t&&t,parentFolderId:e.parentFolderId}})},s={},c={};for(let o of e){const e=yield n.get(t.FORM_KEY_PREFIX+o.id,null);e&&(e.collection&&(s[null===(i=e.collection)||void 0===i?void 0:i.id]=e.collection),c[e.id]={id:e.id,name:e.name,fields:e.daps,favorite:o.favorite,parentFolderId:o.parentFolderId,notionCollectionId:null===(r=e.collection)||void 0===r?void 0:r.id,notionParentCollectionId:null===(a=e.collection)||void 0===a?void 0:a.parent_id,spaceId:e.spaceId,userId:e.userId,template:e.template,savePageContent:e.savePageContent,needToRefreshTemplate:e.needToRefreshTemplate},this.storageKeysToRemove.push(t.FORM_KEY_PREFIX+o.id))}return{user:o,form:c,notionCollection:s}}))}}},function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function a(e){try{c(o.next(e))}catch(e){r(e)}}function s(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.migrationV2=t.defaultAppSettingsV2=void 0;const i=n(2),r=n(0);t.defaultAppSettingsV2={highlightAsBulletPoint:!1,showPremiumFeatures:!1,supportGmailIntegration:!1,highlightFormat:i.HighlightFormat.bullet,openDesktopUrl:!1},t.migrationV2={storageKeysToRemove:["settings","open-desktop"],up:(e,n)=>o(void 0,void 0,void 0,(function*(){const o=Object.fromEntries(Object.entries(e.form).map(([t,n])=>{var o,i;const r=e.notionCollection[n.notionCollectionId],a=null!==(i=null!==(o=function(e){var t,n;return null===(n=null===(t=/^\s*\p{Emoji}/u.exec(e))||void 0===t?void 0:t[0])||void 0===n?void 0:n.trim()}(n.name))&&void 0!==o?o:null==r?void 0:r.icon)&&void 0!==i?i:null,s=n.name.replace(/^\s*\p{Emoji}/u,"").trim();return a?[t,Object.assign(Object.assign({},n),{name:s,icon:a})]:[t,n]})),i=yield n.get("settings",t.defaultAppSettingsV2),a=yield n.get("open-desktop",!1),s=Object.assign(Object.assign({},e.user),{forms:e.user.forms.map(e=>Object.assign(Object.assign({},e),(0,r.pick)(o[e.id]||{},"icon","name","notionCollectionId","notionParentCollectionId"))),settings:Object.assign(Object.assign({},i),a&&{openDesktopUrl:a})});return Object.assign(Object.assign({},e),{form:o,user:s})}))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.databaseV1=void 0;const o=n(6);t.databaseV1={user:(0,o.genSingle)("user",{forms:[]}),form:(0,o.genCrud)("forms",null),notionCollection:(0,o.genCrud)("notionCollections")}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.databaseV3=void 0;const o=n(10),i=n(6);t.databaseV3={user:(0,i.genSingle)("user",{forms:[],settings:o.defaultAppSettings,capturedWebpages:[]}),form:(0,i.genCrud)("forms",null),notionCollection:(0,i.genCrud)("notionCollections"),capturedWebpage:(0,i.genCrud)("capturedWebpage",null),highlight:(0,i.genCrud)("highlight",null)}},function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function a(e){try{c(o.next(e))}catch(e){r(e)}}function s(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.migrationV3=void 0,t.migrationV3={storageKeysToRemove:[],up:(e,t)=>o(void 0,void 0,void 0,(function*(){return Object.assign(Object.assign({},e),{user:Object.assign(Object.assign({},e.user),{capturedWebpages:[]}),capturedWebpage:{},highlight:{}})}))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.databaseV4=void 0;const o=n(10),i=n(6);t.databaseV4={user:(0,i.genSingle)("user",{forms:[],settings:o.defaultAppSettings,capturedWebpages:[]}),form:(0,i.genCrud)("forms",null),notionCollection:(0,i.genCrud)("notionCollections"),capturedWebpage:(0,i.genCrud)("capturedWebpage",null),highlight:(0,i.genCrud)("highlight",null)}},function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function a(e){try{c(o.next(e))}catch(e){r(e)}}function s(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.migrationV4=void 0;const i=n(0),r=n(31);t.migrationV4={storageKeysToRemove:[],up:(e,t)=>o(void 0,void 0,void 0,(function*(){return Object.assign(Object.assign({},e),{form:Object.fromEntries(Object.entries(e.form).map(([e,t])=>[e,(0,i.omit)(Object.assign(Object.assign({},t),{fields:[...t.fields.map(e=>(0,i.omit)(e,"kind")),...t.template?[{key:(0,r.genId)(6),property:{name:"Template",type:"template",id:"template"},options:{defaultValue:t.template},fieldOptions:{locked:!0}}]:[]]}),"template")]))})}))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.databaseV5=void 0;const o=n(10),i=n(6);t.databaseV5={user:(0,i.genSingle)("user",{forms:[],settings:o.defaultAppSettings,capturedWebpages:[]}),form:(0,i.genCrud)("forms",null),notionCollection:(0,i.genCrud)("notionCollections"),capturedWebpage:(0,i.genCrud)("capturedWebpage",null),urlToCapturedWebpage:(0,i.genCrud)("urlToCapturedWebpage",null),highlight:(0,i.genCrud)("highlight",null),notionSync:(0,i.genSingle)("notionSync",{pendingEvents:[],failedEvents:[]})}},function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function a(e){try{c(o.next(e))}catch(e){r(e)}}function s(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.migrationV5=void 0;const i=n(2),r=n(0);t.migrationV5={storageKeysToRemove:[],up(e,t){return o(this,void 0,void 0,(function*(){const n=yield t.getAll(/page-.*/),o={};let a=[];const s={};for(let[e,t]of Object.entries(n)){this.storageKeysToRemove.push(e);const n=(0,r.makeid)(10);let c=[];o[n]={url:t.url,id:n,clipFormat:i.ClipFormat.bookmark,title:null,notionCollectionId:null,notionSpaceId:null,icon:null,highlights:c,formId:null,notionPageId:t.notionPageId,notionListAfterId:t.notionListAfterId,createdAt:t.createdAt},a.push(n),s[t.url]={capturedWebpageId:n,url:t.url}}return Object.assign(Object.assign({},e),{user:Object.assign(Object.assign({},e.user),{capturedWebpages:a}),notionSync:{pendingEvents:[],failedEvents:[]},urlToCapturedWebpage:s,capturedWebpage:o,highlight:{}})}))}}},function(e,t,n){"use strict";var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,i)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&o(t,e,n);return i(t,e),t},a=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function a(e){try{c(o.next(e))}catch(e){r(e)}}function s(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((o=o.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.databaseV6=t.syncStorage=void 0;const c=n(31),l=n(10),u=r(n(7)),d=n(59),p=n(0),h=n(6),f=s(n(37));t.syncStorage=new class{constructor(e,t,n={get:u.get,set:u.set,remove:u.remove,getAll:u.getAll}){this.watchableKeysMap={},this.pendingEntries=[],this.canSync=!1,this.watchableKeysMap=Object.fromEntries((e||[]).map(e=>[e,e in t?t[e]:e=>e])),this.localStorage=n,this.debouncedPushUpdates=function(e,t){let n=null;return function(){n&&clearTimeout(n),n=setTimeout(e,t)}}(()=>this.pushUpdates(),1e3)}_splitKey(e){var t;const n=e.match(/^data-([^-]*)(?:-(.*))?$/);return n?{name:n[1],id:null!==(t=n[2])&&void 0!==t?t:null}:{name:e,id:null}}get(e,t){return this.localStorage.get(e,t)}remove(e){return a(this,void 0,void 0,(function*(){const{name:t,id:n}=this._splitKey(e);return t in this.watchableKeysMap&&(yield this.addSyncEntry({name:t,id:n,action:"delete"})),this.localStorage.remove(e)}))}set(e,t,n=!0){return a(this,void 0,void 0,(function*(){return n&&this.canSync&&(yield this.syncSet(e,t)),this.localStorage.set(e,t)}))}syncSet(e,t,n){return a(this,void 0,void 0,(function*(){if(!this.canSync&&!n)return;const{name:o,id:i}=this._splitKey(e);console.log("syncSet",{canSync:this.canSync,key:e,value:t,name:o,id:i,watchableKeysMap:this.watchableKeysMap}),o in this.watchableKeysMap&&(yield this.addSyncEntry({name:o,id:i,value:this.watchableKeysMap[o](t),action:"set"}))}))}addSyncEntry(e){return a(this,void 0,void 0,(function*(){(0,c.printdebug)("adding sync entry v0",e),this.canSync&&((0,c.printdebug)("adding sync entry",e),this.pendingEntries.push(e),this.debouncedPushUpdates())}))}_removedDupEntries(e){const t=Object.fromEntries(e.map(e=>[`${e.name}-${e.id}`,e]));return Object.values(t)}_saveEntriesInCache(e){return a(this,void 0,void 0,(function*(){const t=Object.fromEntries(e.map(e=>[`${e.name}-${e.id}`,e]));for(const[e,n]of Object.entries(t))"set"==n.action?yield this.localStorage.set("sync-"+e,n.value):"delete"==n.action&&(yield this.localStorage.remove("sync-"+e))}))}getValidEntries(e){return a(this,void 0,void 0,(function*(){const t=Object.fromEntries(e.map(e=>[`${e.name}-${e.id}`,e])),n=[];for(const[e,o]of Object.entries(t)){const t=yield this.localStorage.get("sync-"+e,null);"set"==o.action?(0,f.default)(t,o.value)||n.push(o):"delete"==o.action&&null!=t&&n.push(o)}return n}))}attachSharedIdToEntries(e){return e.map(e=>{var t,n;return"forms"==e.name&&"set"==e.action&&(null===(t=e.value)||void 0===t?void 0:t.isPublic)?Object.assign(Object.assign({},e),{sharedSpaceId:null===(n=e.value)||void 0===n?void 0:n.spaceId}):e})}pushUpdates(e){var t,n,o,i;return a(this,void 0,void 0,(function*(){console.log("pending",this.pendingEntries);const r=this.attachSharedIdToEntries(this._removedDupEntries(this.pendingEntries));if(!r.length)return;this.pendingEntries=[];const a=yield this.localStorage.get("data-user",null);if((0,c.printdebug)("send entries",r,a),!a)return;if(!(null===(n=null===(t=a.auth)||void 0===t?void 0:t.credentials)||void 0===n?void 0:n.idToken))return;if(!(null===(i=null===(o=a.auth)||void 0===o?void 0:o.user)||void 0===i?void 0:i.dataSyncEnabled)&&!e)return;(0,c.printdebug)("send entries user");const s=new d.SaveToNotionProClient(a.auth),l=yield s.api.pushSyncEntries({entries:r});(0,c.printdebug)("sync response",l)}))}pullUpdates(){var e,t;return a(this,void 0,void 0,(function*(){const n=new Date(2e3,0,1).toISOString(),o=yield this.localStorage.get("data-user",null);if(!o)return;if(!(null===(t=null===(e=o.auth)||void 0===e?void 0:e.credentials)||void 0===t?void 0:t.idToken))return;const i=(yield this.localStorage.get("sync-last-date",null))||n,r=(new Date).toISOString(),a=new d.SaveToNotionProClient(o.auth),s=yield a.api.loadSyncEntries({lastSyncAt:i});return yield this.localStorage.set("sync-last-date",r),s}))}getAll(e){return this.localStorage.getAll(e)}turnOnSync(){this.canSync=!0}turnOffSync(){this.canSync=!1}}(["forms","user"],{user:e=>({forms:e.forms,settings:(0,p.omit)(e.settings||{},"showFloatingQuickAddButton")})}),t.databaseV6={user:(0,h.genSingle)("user",{forms:[],settings:l.defaultAppSettings,capturedWebpages:[]},t.syncStorage,["forms","settings"]),form:(0,h.genCrud)("forms",null,t.syncStorage),notionCollection:(0,h.genCrud)("notionCollections"),notionPage:(0,h.genCrud)("notionPage"),capturedWebpage:(0,h.genCrud)("capturedWebpage",null),urlToCapturedWebpage:(0,h.genCrud)("urlToCapturedWebpage",null),highlight:(0,h.genCrud)("highlight",null),notionSync:(0,h.genSingle)("notionSync",{pendingEvents:[],failedEvents:[]}),notionCollectionFormatOptions:(0,h.genCrud)("notionCollectionFormatOptions",null),recent:(0,h.genSingle)("recent",null),lastUpdated:(0,h.genSingle)("lastUpdated",{spaces:{}}),twitterSession:(0,h.genSingle)("twitterSession",null),twitterIntegrationUsage:(0,h.genSingle)("countThreadUsage",{threadSavedCount:0}),info:(0,h.genSingle)("info",{installedAt:null}),quickCapture:(0,h.genSingle)("quickCapture",null),gmailIntegrationUsage:(0,h.genSingle)("gmailIntegrationUsage",{savedCount:0}),quickCaptureSession:(0,h.genSingle)("quickCaptureSession",null),tooltipSession:(0,h.genSingle)("tooltipSession",null),captureContext:(0,h.genSingle)("captureContext",null),toastSession:(0,h.genSingle)("toastSession",{events:[]}),imageCacheInfo:(0,h.genSingle)("imageCacheInfo",{cachedUrls:[]}),imageCaches:(0,h.genCrud)("imageCaches",null)}},function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function a(e){try{c(o.next(e))}catch(e){r(e)}}function s(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.SaveToNotionProClient=void 0;const i=n(12),r=n(60),a=n(1),s=n(80);function c(e){return JSON.parse(atob(e.split(".")[1]))}t.SaveToNotionProClient=class{constructor(e){this.defaultHeaders={accept:"*/*","accept-language":"en-US,en;q=0.9","accept-encoding":"gzip, deflate, br"},this._refreshIdTokenIfNeeded=()=>o(this,void 0,void 0,(function*(){if(!this.credentials)return!0;const e=c(this.credentials.idToken);if(this.FIX_checkRefreshTokenExpired())throw new Error("Refresh token expired");if(this._checkIdTokenExpired(e)){const t=yield this._axios("auth/refresh","post",{refreshToken:this.credentials.refreshToken,email:e.sub},{},{ignoreCheckTokenRefresh:!0,ignoreIdToken:!0});t.success&&(yield this._saveCredentials(t.credentials))}})),this.auth={login:e=>o(this,void 0,void 0,(function*(){return yield this.post("auth/login",e)})),status:()=>o(this,void 0,void 0,(function*(){return this.get("auth/status")})),confirmCodeAndLogin:e=>o(this,void 0,void 0,(function*(){return this.post("auth/signup-confirm-code-and-login",e)})),resetPassword:e=>o(this,void 0,void 0,(function*(){return this.post("auth/reset-password",e)})),logout:()=>o(this,void 0,void 0,(function*(){return this.post("auth/logout")})),signupResendConfirmCode:e=>o(this,void 0,void 0,(function*(){return this.post("auth/signup-resend-confirm-code",e)})),sendResetPasswordLink:e=>o(this,void 0,void 0,(function*(){return this.post("auth/send-reset-password-link",e)})),signUp:e=>o(this,void 0,void 0,(function*(){return yield this.post("auth/signup",e)})),googleSsoCompleteLogin:e=>o(this,void 0,void 0,(function*(){return yield this.post("auth/google-sso-complete-login",e)})),getCognitoUrlWithSessionId:e=>{const t=e||(0,i.v4)(),n={redirectionUri:s.CONSTANTS.backend.url+"/auth/google-sso-callback",clientId:s.CONSTANTS.auth.clientId,domain:s.CONSTANTS.auth.cognitoUrl},o=new URLSearchParams({client_id:n.clientId,response_type:"code",scope:"email openid profile",identity_provider:"Google",state:t,redirect_uri:n.redirectionUri});return{sessionId:t,url:`${n.domain}/oauth2/authorize?${o.toString()}`}},changePassword:e=>o(this,void 0,void 0,(function*(){return this.post("auth/change-password",e)}))},this.api={stripeCreateCheckoutSession:e=>o(this,void 0,void 0,(function*(){return this.post("api/stripe/create-checkout-session",e)})),stripeConfirmCheckoutSession:()=>o(this,void 0,void 0,(function*(){return this.post("api/stripe/confirm-checkout-session")})),stripeManageSubscription:()=>o(this,void 0,void 0,(function*(){return this.post("api/stripe/get-billing-portal")})),loadSyncEntries:e=>o(this,void 0,void 0,(function*(){return this.post("api/load-sync-entries",e)})),getUser:()=>o(this,void 0,void 0,(function*(){return this.get("api/user")})),pushSyncEntries:e=>o(this,void 0,void 0,(function*(){return this.post("api/push-sync-entries",e)})),completeOnboarding:()=>o(this,void 0,void 0,(function*(){return this.post("api/complete-onboarding")})),togglePublishForm:e=>o(this,void 0,void 0,(function*(){return this.post("/api/toggle-publish-form",e)})),loadSharedForms:e=>o(this,void 0,void 0,(function*(){return this.post("/api/load-shared-forms",e)})),enableDataSync:()=>o(this,void 0,void 0,(function*(){return this.post("api/enable-data-sync")})),updateUser:e=>o(this,void 0,void 0,(function*(){return this.post("api/update-user",{user:e})}))},this.integration={loadTweet:e=>o(this,void 0,void 0,(function*(){return this.post("/integration/load-tweet",e)}))},this.custom={getForm:e=>o(this,void 0,void 0,(function*(){var t,n;return null===(n=null===(t=(yield this.api.loadSyncEntries({lastSyncAt:"2020-01-01T00:00:00.000Z",entries:[{name:"forms",id:e}]})).updatedEntries)||void 0===t?void 0:t[0])||void 0===n?void 0:n.value}))},e&&(this.credentials=e.credentials,this.user=e.user)}_checkIdTokenExpired(e){return 1e3*e.exp<Date.now()}FIX_checkRefreshTokenExpired(){const e=c(this.credentials.accessToken),t=1e3*e.iat<Date.now()-2592e6,n=1e3*e.iat<Date.parse("2023-10-01");return!(!t||!n)}_saveCredentials(e){return this.credentials=e,a.db.custom.saveUser({auth:{credentials:this.credentials,user:this.user}})}_axios(e,t="get",n={},i={},a={}){var s;return o(this,void 0,void 0,(function*(){return a.ignoreCheckTokenRefresh||(yield this._refreshIdTokenIfNeeded()),r.actionsV2.backgroundNetworkFetch({url:`${(null==a?void 0:a.devMode)?"https://909z0pzer3.execute-api.us-east-1.amazonaws.com/dev/":"https://6kbxs6snzg.execute-api.us-east-1.amazonaws.com/v1/"}${e.startsWith("/")&&e.slice(1)||e}`,props:{method:t.toUpperCase(),headers:Object.assign(Object.assign(Object.assign({"content-type":"application/json"},this.defaultHeaders),(null===(s=this.credentials)||void 0===s?void 0:s.idToken)&&!a.ignoreIdToken&&{Authorization:this.credentials.idToken}),i),body:t in{post:!0,put:!0}?JSON.stringify(n):void 0}})}))}post(e,t={},n={}){return this._axios(e,"post",t,n)}put(e,t={},n={}){return this._axios(e,"put",t,n)}delete(e){return this._axios(e,"delete")}get(e){return this._axios(e,"get",null)}}},function(e,t,n){"use strict";var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,i)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&o(t,e,n);return i(t,e),t},a=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function a(e){try{c(o.next(e))}catch(e){r(e)}}function s(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.actionsV2=void 0;const s=r(n(32));t.actionsV2=Object.fromEntries(Object.keys(s).map(e=>[e,t=>a(void 0,void 0,void 0,(function*(){return new Promise(n=>{chrome.runtime.sendMessage({type:"action",fnName:e,props:t},n)})}))]))},function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function a(e){try{c(o.next(e))}catch(e){r(e)}}function s(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.backgroundNetworkFetch=void 0,t.backgroundNetworkFetch=function(e,{}){var t,n,i,r,a;return o(this,void 0,void 0,(function*(){let o;try{o=yield fetch(e.url,e.props)}catch(e){return console.error(e),401==(null===(t=null==e?void 0:e.response)||void 0===t?void 0:t.status)?{success:!1,error:{code:"Unauthorized",message:"Unauthorized"}}:{success:!1,error:{code:"NETWORK_ERROR",message:"Network error"}}}const s=yield o.json();return!("success"in s)||s.success||(console.error(s),null===(n=s.error)||void 0===n?void 0:n.message)?s:{success:!1,error:{code:(null===(i=s.error)||void 0===i?void 0:i.code)||"UnknownError",message:(null===(r=s.error)||void 0===r?void 0:r.code)&&`error (${null===(a=s.error)||void 0===a?void 0:a.code})`||"something went wrong"}}}))}},function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function a(e){try{c(o.next(e))}catch(e){r(e)}}function s(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.notionSearchRelations=void 0;const i=n(13);t.notionSearchRelations=function(e,{notionClient:t}){var n,r;return o(this,void 0,void 0,(function*(){let o=yield t.search({type:"BlocksInCollection",query:e.text,spaceId:e.spaceId,collectionId:e.collectionId,limit:20,filters:{isDeletedOnly:!1,excludeTemplates:!0,navigableBlockContentOnly:!0,requireEditPermissions:!1,includePublicPagesWithoutExplicitAccess:!0,ancestors:[],createdBy:[],editedBy:[],lastEditedTime:{},createdTime:{},inTeams:[]},sort:{field:"relevance"},source:"relation_menu",recentPagesForBoosting:[],ignoresHighlight:!0}),a=[];for(let e of o.results){let t=e.id;if(!(t in o.recordMap.block))continue;let s=o.recordMap.block[t].value;s.is_template||a.push({id:s.id,name:(0,i.getDepVal)(s.properties,"title","Untitled"),title:null===(n=s.properties)||void 0===n?void 0:n.title,icon:(null===(r=s.format)||void 0===r?void 0:r.page_icon)||null})}return a}))}},function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function a(e){try{c(o.next(e))}catch(e){r(e)}}function s(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.notionCreateNewOptionProperty=void 0;const i=n(33);t.notionCreateNewOptionProperty=function(e,t){return o(this,void 0,void 0,(function*(){return(0,i.notionUpdateOptionProperty)(e,t)}))}},function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function a(e){try{c(o.next(e))}catch(e){r(e)}}function s(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.notionChangeOrderOptionProperty=void 0,t.notionChangeOrderOptionProperty=function(e,{notionClient:t}){var n;return o(this,void 0,void 0,(function*(){try{yield t.submitOperations([(null===(n=e.pos)||void 0===n?void 0:n.beforeId)?{pointer:{table:"collection",id:e.collectionId,spaceId:e.spaceId},command:"keyedObjectListBefore",path:["schema",e.propertyId,"options"],args:{value:e.option,before:{id:e.pos.beforeId}}}:{pointer:{table:"collection",id:e.collectionId,spaceId:e.spaceId},command:"keyedObjectListAfter",path:["schema",e.propertyId,"options"],args:{value:e.option}}],e.spaceId)}catch(e){return console.error(e),{success:!1}}return{success:!0}}))}},function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function a(e){try{c(o.next(e))}catch(e){r(e)}}function s(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.notionGetPageItem=void 0,t.notionGetPageItem=function(e,{notionClient:t}){return o(this,void 0,void 0,(function*(){try{return{success:!0,page:(yield t.custom.getPage({pageId:e.pageId})).value}}catch(e){return console.error(e),{success:!1}}}))}},function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function a(e){try{c(o.next(e))}catch(e){r(e)}}function s(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.notionGetCollection=void 0,t.notionGetCollection=function(e,{notionClient:t}){return o(this,void 0,void 0,(function*(){try{return{success:!0,collection:(yield t.custom.getCollection({collectionId:e.collectionId})).value}}catch(e){return console.error(e),{success:!1}}}))}},function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function a(e){try{c(o.next(e))}catch(e){r(e)}}function s(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.notionUpdatePageValues=t.getNotionPageUpdatedObject=void 0;const i=n(34);t.getNotionPageUpdatedObject=function(e,t){const n={},o={};for(const[a,s]of Object.entries(e))a in r?n[r[a]]=s:o[a]=(0,i.castSimplifiedToNotionValue)(s,t[a]);return Object.assign(Object.assign({},Object.keys(n).length&&{format:n}),Object.keys(o).length&&{properties:o})},t.notionUpdatePageValues=function(e,{notionClient:t}){return o(this,void 0,void 0,(function*(){try{yield t.saveOperations(function(e){return[...Object.entries(e.notionPageUpdatedObject.format||{}).map(([t,n])=>function(e){return{pointer:{table:"block",id:e.pageId,spaceId:e.spaceId},path:["format",e.propertyId],command:"set",args:e.value}}({value:n,propertyId:t,pageId:e.pageId,spaceId:e.spaceId})),...Object.entries(e.notionPageUpdatedObject.properties||{}).map(([t,n])=>function(e){return{pointer:{table:"block",id:e.pageId,spaceId:e.spaceId},path:["properties",e.propertyId],command:"set",args:e.value}}({value:n,pageId:e.pageId,property:e.schema[t],propertyId:t,spaceId:e.spaceId})),a({spaceId:e.spaceId,pageId:e.pageId})]}(e),e.spaceId);return{success:!0}}catch(e){return console.error(e),{success:!1}}}))};const r={icon:"page_icon",cover:"page_cover"};function a(e){return{pointer:{table:"block",id:e.pageId,spaceId:e.pageId},path:[],command:"update",args:{last_edited_time:Date.now()}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createAgent=void 0;const o=n(69);Object.defineProperty(t,"createAgent",{enumerable:!0,get:function(){return o.createAgent}})},function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function a(e){try{c(o.next(e))}catch(e){r(e)}}function s(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.createAgent=t.Agent=void 0;const i=n(70),r=n(36),a=n(73),s=n(74);class c{constructor(e={}){this.server=a.Default.server,this.token=e.token?e.token:"",this.server=e.server?e.server:a.Default.server,e.activeUserId&&(this.activeUserId=e.activeUserId)}_post(e,t){return o(this,void 0,void 0,(function*(){r.log.debug(`agent.ts: Call API "${e}".`);const n=(0,i.post)(`${this.server}${e.startsWith("/")?"":"/"}${e}`).setHeader("accept","*/*").setHeader("accept-language","en-US,en;q=0.9").setHeader("cookie",`token_v2=${this.token};`).setHeader("origin",a.Default.server).setHeader("referer",a.Default.server).setHeader("user-agent",a.Default.userAgent);this.activeUserId&&n.setHeader("x-notion-active-user-header",this.activeUserId);const o=yield n.sendAsJson(t);if(o.hasOwnProperty("errorId")){const e=o;throw new s.APIError(e)}return o}))}getActivityLog(e){return this._post("/api/v3/getActivityLog",e)}getAssetsJson(e){return this._post("/api/v3/getAssetsJson",e)}getRecordValues(e){return this._post("/api/v3/getRecordValues",e)}getSnapshotsList(e){return this._post("/api/v3/getSnapshotsList",e)}getUserSharedPages(e){return this._post("/api/v3/getUserSharedPages",e)}loadPageChunk(e){return this._post("/api/v3/loadPageChunk",e)}loadUserContent(e){return this._post("/api/v3/loadUserContent",e)}queryCollection(e){return this._post("/api/v3/queryCollection",e)}submitTransaction(e){return this._post("/api/v3/submitTransaction",e)}search(e){return this._post("/api/v3/search",e)}}t.Agent=c,t.createAgent=function(e={}){return new c(e)}},function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function a(e){try{c(o.next(e))}catch(e){r(e)}}function s(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.post=void 0;const i=n(36),r=n(72);t.post=function(e){const t=new URL(e);if("http:"!==t.protocol&&"https:"!==t.protocol)throw new r.RequestError("Unsupported protocol: "+t.protocol);const n=t.port?t.port:"http:"===t.protocol?80:443,a={hostname:t.hostname,authority:t.hostname,port:n,path:t.pathname+t.search,method:"POST",headers:{}};return{setHeader:function(e,t){return a.headers[e]=t,this},sendAsJson:function(e){return o(this,void 0,void 0,(function*(){i.log.debug(`http-util.ts: ${a.method} ${a.hostname} ${a.port} ${a.path}`),this.setHeader("accept-encoding","gzip, deflate"),this.setHeader("content-type","application/json");let n,o="";try{e&&(o=JSON.stringify(e))}catch(e){throw e}try{n=yield fetch(t.toString(),{method:"post",headers:a.headers,body:o})}catch(e){throw e}try{return yield n.json()}catch(e){throw e}}))}}}},function(e,t,n){"use strict";const o=2,i=3,r=4,a=5,s=6,c=a,l="[31m",u="[32m",d="[33m",p="[34m",h="[0m",f="[1m";e.exports={Logger:class{constructor(e,t={}){this.appName=e,this.useColor=void 0===t.useColor||t.useColor,this.setLogLevel(t.logLevel)}verbose(){if(o>=this.logLevel){let e=Array.from(arguments);return e.unshift(this._makeHeader("V",f+p)),console.error.apply(console,e),0}return-1}debug(){if(i>=this.logLevel){let e=Array.from(arguments);return e.unshift(this._makeHeader("D",f+p)),console.log.apply(console,e),0}return-1}info(){if(r>=this.logLevel){let e=Array.from(arguments);return e.unshift(this._makeHeader("I",f+u)),console.log.apply(console,e),0}return-1}warn(){if(a>=this.logLevel){let e=Array.from(arguments);return e.unshift(this._makeHeader("W",f+d)),console.log.apply(console,e),0}return-1}error(){if(s>=this.logLevel){let e=Array.from(arguments);return e.unshift(this._makeHeader("E",f+l)),console.error.apply(console,e),0}return-1}setLogLevel(e){switch(e){case"verbose":this.logLevel=o;break;case"debug":this.logLevel=i;break;case"info":this.logLevel=r;break;case"warn":this.logLevel=a;break;case"error":this.logLevel=s;break;default:return this.warn(`Unknown log level string: ${e}, please specify one of verbose, debug, info, warn, error.`),this.logLevel=c,-1}return 0}_makeHeader(e,t){const n=`${e}/${this.appName}(${function(){let e=6e4*(new Date).getTimezoneOffset(),t=Date.now()-e;return new Date(t).toISOString().replace(/Z|-|:/g,"")}()}):`;return this.useColor&&t?t+n+h:n}},RET_FAIL:-1,RET_SUCCESS:0}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RequestError=void 0;class o extends Error{constructor(e){super(),this.name="RequestError",Object.setPrototypeOf(this,o.prototype),this.message=e}}t.RequestError=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Default=void 0;t.Default={server:"https://www.notion.so",userAgent:"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.130 Safari/537.36"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.APIError=void 0;class o extends Error{constructor(e){super(),this.name="APIError",Object.setPrototypeOf(this,o.prototype),this.message=`Server says "${e.name}: ${e.message}`,e.status&&(this.message+=" Status: "+e.status),this.message+='"'}}t.APIError=o},function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function a(e){try{c(o.next(e))}catch(e){r(e)}}function s(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.jdump=t.sleep=void 0;t.sleep=e=>o(void 0,void 0,void 0,(function*(){return new Promise(t=>setTimeout(t,e))}));t.jdump=e=>JSON.stringify(e,null,2)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.fetchWithProgress=void 0,t.fetchWithProgress=function(e,t){return new Promise((n,o)=>{const i=new XMLHttpRequest;i.open(t.method,e);for(const e in t.headers)i.setRequestHeader(e,t.headers[e]);i.upload&&(i.upload.onprogress=e=>{if(e.lengthComputable){const n=Math.round(100*e.loaded/e.total);t.onProgress(n)}}),i.onload=()=>{i.status>=200&&i.status<300?n(i.response):o(i.statusText)},i.onerror=()=>{o(i.statusText)},i.send(t.body)})}},function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function a(e){try{c(o.next(e))}catch(e){r(e)}}function s(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.notionUploadFile=void 0,t.notionUploadFile=function(e,t){return o(this,void 0,void 0,(function*(){return t.notionClient.custom.uploadFile({dataB64:e.dataB64,onProgress:function(e){chrome.runtime.sendMessage({popup:{name:"notionUploadFilePercent",args:{percent:e}}})},record:e.record})}))}},function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function a(e){try{c(o.next(e))}catch(e){r(e)}}function s(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.openQuickCapturePopup=void 0,t.openQuickCapturePopup=function(e,{}){return o(this,void 0,void 0,(function*(){return console.log("TODO"),{}}))}},function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function a(e){try{c(o.next(e))}catch(e){r(e)}}function s(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((o=o.apply(e,t||[])).next())}))};function i(...e){return console.log("loadTweetV2.ts",...e)}Object.defineProperty(t,"__esModule",{value:!0}),t.extractTweets=t.MediaType=t.TwitterUnofficialClient=t.loadTweetV2=void 0,t.loadTweetV2=function(e,t){return o(this,void 0,void 0,(function*(){i("test");const n=yield t.db.twitterSession.load(),o=new r(n);try{return yield o.loadThread(e.tweetId)}catch(e){return console.error(e),[]}}))};class r{constructor(e){this.defaultHeaders={accept:"*/*","accept-language":"en-US,en;q=0.9","accept-encoding":"gzip, deflate, br"},this.twitterSession=e}fetchTweetDetail(e,t){return o(this,void 0,void 0,(function*(){return(yield fetch(`https://twitter.com/i/api/graphql/7d8fexGPbM0BRc5DkacJqA/TweetDetail?variables=${a(Object.assign(Object.assign({focalTweetId:e,rux_context:"HHwWgICi-c7sl-gbAAAA",with_rux_injections:!0},t&&{cursor:t}),{includePromotedContent:!0,withCommunity:!0,withQuickPromoteEligibilityTweetFields:!0,withBirdwatchNotes:!1,withDownvotePerspective:!1,withVoice:!0,withV2Timeline:!0}))}\n            &features=${a({blue_business_profile_image_shape_enabled:!1,responsive_web_graphql_exclude_directive_enabled:!0,verified_phone_label_enabled:!1,responsive_web_graphql_timeline_navigation_enabled:!0,responsive_web_graphql_skip_user_profile_image_extensions_enabled:!1,tweetypie_unmention_optimization_enabled:!0,vibe_api_enabled:!0,responsive_web_edit_tweet_api_enabled:!0,graphql_is_translatable_rweb_tweet_is_translatable_enabled:!0,view_counts_everywhere_api_enabled:!0,longform_notetweets_consumption_enabled:!0,tweet_awards_web_tipping_enabled:!1,freedom_of_speech_not_reach_fetch_enabled:!1,standardized_nudges_misinfo:!0,tweet_with_visibility_results_prefer_gql_limited_actions_policy_enabled:!1,interactive_text_enabled:!0,responsive_web_text_conversations_enabled:!1,longform_notetweets_rich_text_read_enabled:!1,responsive_web_enhance_cards_enabled:!1})}`,{headers:Object.assign(Object.assign(Object.assign({},this.defaultHeaders),{authorization:this.twitterSession.authorization,"x-csrf-token":this.twitterSession.csrfToken}),this.twitterSession.guestToken?{"x-guest-token":this.twitterSession.guestToken}:{})})).json()}))}loadThread(e){return o(this,void 0,void 0,(function*(){i("loadThread",e);const t={};let n=null,o=null,r=[];for(;;){const i=yield this.fetchTweetDetail((null==o?void 0:o.id)||e,n);r=a(r,yield s((null==o?void 0:o.id)||e,i,o));const c=r[r.length-1];if(c._meta.nextCursorId&&!t[c._meta.nextCursorId]?(t[c._meta.nextCursorId]=!0,n=c._meta.nextCursorId,o=c):(n=null,o=null),null==n)break}return r;function a(e,t){const n=e.map(e=>e.id),o=t.filter(e=>!n.includes(e.id));return[...e,...o].sort((e,t)=>e.createdAt>t.createdAt?1:-1)}}))}}function a(e){return encodeURIComponent(JSON.stringify(e))}function s(e,t,n){var o,r;const a=null===(o=t.data.threaded_conversation_with_injections_v2)||void 0===o?void 0:o.instructions[0];if(!a)return[];const s=(null===(r=a.entries||a.moduleItems)||void 0===r?void 0:r.flatMap(e=>{var t,n,o,i,r,a;if("TimelineTimelineItem"==(null===(t=e.content)||void 0===t?void 0:t.entryType)){const t=e.content.itemContent.tweet_results;return t?[l(t)]:[]}return"TimelineTimelineModule"==(null===(n=e.content)||void 0===n?void 0:n.entryType)?(null===(i=null===(o=e.content.items)||void 0===o?void 0:o.map((e,t)=>({block:e,pos:t})))||void 0===i?void 0:i.filter(({block:e})=>"TimelineTweet"==e.item.itemContent.itemType).map(({block:t,pos:n})=>{var o,i;let r=null;return(null===(o=e.content.items[n+1])||void 0===o?void 0:o.item.itemContent.itemType.toLowerCase().includes("cursor"))&&(r=(null===(i=e.content.items[n+1])||void 0===i?void 0:i.item.itemContent).value),l(t.item.itemContent.tweet_results,r)}))||[]:"TimelineTweet"==(null===(a=null===(r=e.item)||void 0===r?void 0:r.itemContent)||void 0===a?void 0:a.itemType)?[l(e.item.itemContent.tweet_results)]:void 0}))||[];i("tweets",s);const u=n||s.find(t=>t.id==e),d=[u,...s.filter(e=>{var t,n;return e.author.id==(null===(t=u.author)||void 0===t?void 0:t.id)&&e._meta.replyingToUserId==(null===(n=u.author)||void 0===n?void 0:n.id)})],p=Object.fromEntries(d.map(e=>[e.id,!1])),h=d.filter(e=>!p[e.id]&&(p[e.id]=!0,!0));return h.sort((e,t)=>{const n=new Date(e.createdAt),o=new Date(t.createdAt);return n.getTime()-o.getTime()}),i("filtered tweets",h),h.map(e=>function(e){const t=Object.fromEntries(e.medias.map(e=>[e.shortenedUrl,e]));return c(e.text).forEach(n=>{t[n]&&(e.text=e.text.replace(n,""))}),e}(e))}function c(e){return e.match(/(https?:\/\/[^\s]+)/g)||[]}function l(e,t){var n,o,r,a,s,c,l,u,d,p,h,f;let v="TweetWithVisibilityResults"==e.result.__typename?e.result.tweet:e.result;const g=v.legacy,m=v.core.user_results.result,y=m.legacy.screen_name,b=null!==(a=null===(r=null===(o=null===(n=e.result.note_tweet)||void 0===n?void 0:n.note_tweet_results)||void 0===o?void 0:o.result)||void 0===r?void 0:r.text)&&void 0!==a?a:g.full_text,_=null!==(f=null!==(d=null===(u=null===(l=null===(c=null===(s=e.result.note_tweet)||void 0===s?void 0:s.note_tweet_results)||void 0===c?void 0:c.result)||void 0===l?void 0:l.entity_set)||void 0===u?void 0:u.urls)&&void 0!==d?d:null===(h=null===(p=v.legacy)||void 0===p?void 0:p.entities)||void 0===h?void 0:h.urls)&&void 0!==f?f:[],w=function(){var e,t;i("tweetContent.full_text",g,g.full_text);return[...null===(e=g.entities)||void 0===e?void 0:e.urls.filter(e=>e.expanded_url.match(/https:\/\/twitter.com\/[^\s]*\/status\/[^\s]*/g)).map(e=>({url:e.expanded_url})),...(null===(t=g.full_text.match(/(https:\/\/twitter.com\/[^\s]*\/status\/[^\s]*)/g))||void 0===t?void 0:t.map(e=>({url:e})))||[]]}(),C=function(e,t){function n(e){const t=e.match(/^(@\w+)/g);return t?{s:e.replace(t[0],"").trim(),continue:!0}:{s:e,continue:!1}}let o=!0,i=e;for(;o;){const e=n(i);o=e.continue,i=e.s}return i}(function(e){return e.replace(/(https:\/\/twitter.com\/[^\s]*\/status\/[^\s]*)/g,"")}(function(e,t){const n=Object.fromEntries(t.map(e=>[e.url,e.expanded_url]));let o=e;return Object.keys(n).forEach(e=>{o=o.replace(e,n[e])}),o}(b,_)));return{id:g.id_str,url:`https://twitter.com/${y}/status/${g.id_str}`,author:{id:g.user_id_str,username:y,name:m.legacy.name},createdAt:new Date(g.created_at).toISOString(),text:C,medias:function(){var e;return(null===(e=g.extended_entities)||void 0===e?void 0:e.media.map(e=>{var t,n,o;const i=(null===(o=null===(n=null===(t=e.video_info)||void 0===t?void 0:t.variants)||void 0===n?void 0:n.filter(e=>"video/mp4"==e.content_type).sort((e,t)=>t.bitrate-e.bitrate)[0])||void 0===o?void 0:o.url)||null;return Object.assign({id:e.id_str,width:e.sizes.medium.w,height:e.sizes.medium.h,url:e.media_url_https,shortenedUrl:e.url,type:e.type},i&&{videoUrl:i})}))||[]}(),tweetEmbeds:w,_meta:{conversationId:g.conversation_id_str,nextCursorId:t,replyingToUserId:g.in_reply_to_user_id_str||null}}}t.TwitterUnofficialClient=r,function(e){e.Photo="photo"}(t.MediaType||(t.MediaType={})),t.extractTweets=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CONSTANTS=void 0,t.CONSTANTS={pageFrontImageId:"pageFrontImage",pageIconId:"pageIcon",stripe:{buyLink:"https://buy.stripe.com/8wM5mY9dteBX1kA6op"},color:{text200:"#E7E5E4",text300:"#D6D3D1",text400:"#A8A29E",text700:"#44403C"},limits:{clipTwitterThread:3,clipEmail:6,showRemain:3,freeForms:5},signup:{privacyPolicyUrl:"https://anisg.notion.site/Privacy-Policy-Save-to-Notion-11e1ac17c54f42f1b7b6f95e5187ba32",termsOfServiceUrl:"https://anisg.notion.site/Terms-Conditions-Save-to-Notion-1e2e8dfb37bc408fb682ea2c9753ea6f"},auth:{clientId:"6mm6i3ehl149cicimepgkplu8i",cognitoUrl:"https://auth.savetonotion.so"},backend:{url:"https://6kbxs6snzg.execute-api.us-east-1.amazonaws.com/v1"}}},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function a(e){try{c(o.next(e))}catch(e){r(e)}}function s(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.migrationV6=void 0,t.migrationV6={storageKeysToRemove:[],up(e,t){return o(this,void 0,void 0,(function*(){return Object.assign(Object.assign({},e),{notionPage:{}})}))}}},function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function a(e){try{c(o.next(e))}catch(e){r(e)}}function s(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.fetchFullContentPage=void 0;const i=n(85);t.fetchFullContentPage=function(e,t){return o(this,void 0,void 0,(function*(){const n=(yield(0,i.fetchPageById)(e,t)).recordMap.block;return{[e]:n[e]}}))}},function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function a(e){try{c(o.next(e))}catch(e){r(e)}}function s(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.fetchNotionSearch=t.fetchBlocks=t.fetchNotionUsers=t.fetchTableData=t.fetchPageById=t.loadPageChunkBody=void 0;t.loadPageChunkBody={limit:100,cursor:{stack:[]},chunkNumber:0,verticalColumns:!1};const i=({resource:e,body:t,notionToken:n})=>o(void 0,void 0,void 0,(function*(){return(yield fetch("https://www.notion.so/api/v3/"+e,{method:"POST",headers:Object.assign({"content-type":"application/json"},n&&{cookie:"token_v2="+n}),body:JSON.stringify(t)})).json()}));t.fetchPageById=(e,n,r=t.loadPageChunkBody)=>o(void 0,void 0,void 0,(function*(){return yield i({resource:"loadPageChunk",body:Object.assign({pageId:e},r),notionToken:n})}));const r={query:{aggregations:[{property:"title",aggregator:"count"}]},loader:{type:"table",limit:100,searchQuery:"",userTimeZone:"Europe/Vienna",userLocale:"en",loadContentCover:!0}};t.fetchTableData=(e,t,n)=>o(void 0,void 0,void 0,(function*(){return yield i({resource:"queryCollection",body:Object.assign({collectionId:e,collectionViewId:t},r),notionToken:n})}));t.fetchNotionUsers=(e,t)=>o(void 0,void 0,void 0,(function*(){const n=yield i({resource:"getRecordValues",body:{requests:e.map(e=>({id:e,table:"notion_user"}))},notionToken:t});return n&&n.results?n.results.map(e=>({id:e.value.id,firstName:e.value.given_name,lastLame:e.value.family_name,fullName:e.value.given_name+" "+e.value.family_name,profilePhoto:e.value.profile_photo})):[]}));t.fetchBlocks=(e,t)=>o(void 0,void 0,void 0,(function*(){return yield i({resource:"syncRecordValues",body:{recordVersionMap:{block:e.reduce((e,t)=>(e[t]=-1,e),{})}},notionToken:t})}));t.fetchNotionSearch=(e,t)=>o(void 0,void 0,void 0,(function*(){return i({resource:"search",body:{type:"BlocksInAncestor",source:"quick_find_public",ancestorId:e.ancestorId,filters:Object.assign({isDeletedOnly:!1,excludeTemplates:!0,isNavigableOnly:!0,requireEditPermissions:!1,ancestors:[],createdBy:[],editedBy:[],lastEditedTime:{},createdTime:{}},e.filters),sort:"Relevance",limit:e.limit||20,query:e.query},notionToken:t})}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.formatData=void 0;const o=n(87);function i(e){const t=e.match(/^(https:\/\/pbs\.twimg\.com\/media\/\w+)(\?format=(jpg|png).*)$/);return t?t[1]+"."+t[3]+t[2]:e}function r(e,t){var n,r,a,s;let c;switch(t.type){case"select":case"status":return t.options?(c=t.options.filter(t=>t.id==e.options.defaultSelectId),0==c.length?"":c[0].value):"";case"date":return null===(n=e.options)||void 0===n?void 0:n.defaultValue;case"person":{let t=[],n=(null===(r=e.options)||void 0===r?void 0:r.defaultSelectIds)||[];return n.forEach((e,o)=>{t.push(["â€£",[["u",e]]]),o+1<n.length&&t.push([","])}),t}case"relation":let l=[],u=(null===(a=e.options)||void 0===a?void 0:a.defaultSelectIds)||[];return u.forEach((e,t)=>{l.push(["â€£",[["p",e]]]),t+1<u.length&&l.push([","])}),l;case"multi_select":if(!t.options)return[];let d={};return null===(s=e.options.defaultSelectIds)||void 0===s||s.forEach(e=>d[e]=!0),c=t.options.filter(e=>d[e.id]),0==c.length?[]:c.map(e=>e.value);case"file":case"image":if(!e.options.defaultValue)return;return(0,o.compact)(e.options.defaultValue.map(t=>{var n,o;if(t.imgUrl){return Object.assign(Object.assign({},t),{imgUrl:i(t.imgUrl),opts:(null===(n=e.fieldOptions)||void 0===n?void 0:n.image)?null===(o=e.fieldOptions)||void 0===o?void 0:o.image:{size:"normal",type:"coverLike"}})}}));case"text":default:return e.options.defaultValue}}t.formatData=function(e){let t={};for(let n of e.daps){let e=n.property,o=n.property.id;t[o]=r(n,e),void 0===t[o]&&delete t[o]}return t}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.compact=void 0,t.compact=function(e){return e.filter(e=>null!=e)}},function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function a(e){try{c(o.next(e))}catch(e){r(e)}}function s(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.displaySnackBar=void 0;const i=n(5);t.displaySnackBar=function({action:e,msg:t,timeout:n=2e3,tutorial:r}){return o(this,void 0,void 0,(function*(){const o=yield(0,i.currentTab)();return yield new Promise(i=>chrome.tabs.executeScript(o.id,{code:`var action = "${e}"; timeout = ${n}; msg = "${t}"; tutorial = ${!!r}`},()=>chrome.tabs.executeScript(o.id,{file:"/displaySnackBar.js"},e=>{i(e[0])})))}))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.uploadClip=t.removeCaptionHighlight=t.updateCaptionHighlight=t.removeHighlight=t.addHighlight=void 0;var o=n(41);Object.defineProperty(t,"addHighlight",{enumerable:!0,get:function(){return o.addHighlight}});var i=n(90);Object.defineProperty(t,"removeHighlight",{enumerable:!0,get:function(){return i.removeHighlight}});var r=n(42);Object.defineProperty(t,"updateCaptionHighlight",{enumerable:!0,get:function(){return r.updateCaptionHighlight}});var a=n(91);Object.defineProperty(t,"removeCaptionHighlight",{enumerable:!0,get:function(){return a.removeCaptionHighlight}});var s=n(92);Object.defineProperty(t,"uploadClip",{enumerable:!0,get:function(){return s.uploadClip}})},function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function a(e){try{c(o.next(e))}catch(e){r(e)}}function s(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.removeHighlight=void 0,t.removeHighlight=function(e,{notionClient:t,log:n,db:i}){return o(this,void 0,void 0,(function*(){const o=yield i.capturedWebpage.get(e.capturedWebpageId),r=yield i.highlight.get(e.highlightId);n("remove block from Notion"),yield t.custom.removeBlock({notionParentId:o.notionPageId,notionBlockId:r.notionBlockId,notionSpaceId:o.notionSpaceId}),n("remove highlight from local database"),yield i.highlight.delete(r.id),yield i.capturedWebpage.save(o.id,Object.assign(Object.assign({},o),{highlights:o.highlights.filter(e=>e!=r.id)}))}))}},function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function a(e){try{c(o.next(e))}catch(e){r(e)}}function s(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.removeCaptionHighlight=void 0,t.removeCaptionHighlight=function(e,{notionClient:t,log:n,db:i}){return o(this,void 0,void 0,(function*(){const o=yield i.capturedWebpage.get(e.capturedWebpageId),r=yield i.highlight.get(e.highlightId);r.notionCaptionBlockId?(n("remove caption block from Notion"),yield t.custom.removeBlock({notionParentId:r.notionBlockId,notionBlockId:r.notionCaptionBlockId,notionSpaceId:o.notionSpaceId})):n("no need to delete caption on Notion"),yield i.highlight.save(e.highlightId,Object.assign(Object.assign({},r),{caption:null,notionCaptionBlockId:null,showCaption:!1}))}))}},function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function a(e){try{c(o.next(e))}catch(e){r(e)}}function s(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.uploadClip=void 0,t.uploadClip=function(e,{notionClient:t,log:n,db:i}){var r,a,s,c,l;return o(this,void 0,void 0,(function*(){n("upload clip");const o=yield i.capturedWebpage.get(e.capturedWebpageId),u=null===(s=null===(a=Object.values(null===(r=e.clip)||void 0===r?void 0:r.notionOutput).find(t=>{var n,o;return t.value.id in(null===(n=e.clip)||void 0===n?void 0:n.notionOutput)&&"page"==(null===(o=e.clip)||void 0===o?void 0:o.notionOutput[t.value.id].value.type)}))||void 0===a?void 0:a.value)||void 0===s?void 0:s.content,d=null!==(c=Object.values(e.clip.notionOutput).filter(e=>"page"!=e.value.type))&&void 0!==c?c:[];let p={blockFormat:"callout",notionParentId:o.notionPageId,text:e.clip.title||"clip #"+e.clipCount,calloutIcon:e.clip.icon,afterId:o.notionListAfterId,notionSpaceId:o.notionSpaceId,withChildren:{contentBlocks:d,content:u}};(null===(l=e.clip)||void 0===l?void 0:l.noWrap)&&1==u.length&&(p.blockFormat=d[0].value.type,p.withChildren=null,p.text=null,p.properties=Object.assign({},d[0].value.properties||{}));const h=yield t.custom.addBlock(p);yield i.capturedWebpage.save(o.id,Object.assign(Object.assign({},o),{notionListAfterId:h}))}))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.toastAsk=t.modalAsk=void 0;const o=n(94);t.modalAsk=function(e,t){return new Promise(n=>{chrome.runtime.sendMessage({v2:!0,destination:"modal",event:e,props:t},e=>{n(e)})})},t.toastAsk=function(e,t,n){return o.isFirefox?new Promise(o=>{chrome.tabs.sendMessage(n,{v2:!0,destination:"toast",event:e,props:t},e=>{o(e)})}):new Promise(n=>{chrome.runtime.sendMessage({v2:!0,destination:"toast",event:e,props:t},e=>{n(e)})})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isFirefox=void 0,t.isFirefox=!(null===chrome||void 0===chrome?void 0:chrome.app)},function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function a(e){try{c(o.next(e))}catch(e){r(e)}}function s(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.notionLoadElement=void 0,t.notionLoadElement=function(e,{notionClient:t}){return o(this,void 0,void 0,(function*(){try{const n=yield"collection"==e.type?t.custom.getCollection({collectionId:e.id}):t.custom.getPage({pageId:e.id});return n.value?{success:!0,item:n.value}:{success:!1}}catch(e){return console.error(e),{success:!1}}}))}},function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function a(e){try{c(o.next(e))}catch(e){r(e)}}function s(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.telemetry=void 0,t.telemetry=function(e,t){return o(this,void 0,void 0,(function*(){}))}},function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function a(e){try{c(o.next(e))}catch(e){r(e)}}function s(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.waitForAsync=t.waitFor=void 0,t.waitFor=function(e,t={timeout:7e3,interval:1e3}){return new Promise((n,o)=>{const i=Date.now(),r=setInterval(()=>{e()?(clearInterval(r),n(!0)):Date.now()-i>t.timeout&&(clearInterval(r),o(new Error("Timeout")))},t.interval)})},t.waitForAsync=function(e,t={timeout:7e3,interval:1e3}){return new Promise((n,i)=>{const r=Date.now(),a=setInterval(()=>o(this,void 0,void 0,(function*(){(yield e())?(clearInterval(a),n(!0)):Date.now()-r>t.timeout&&(clearInterval(a),i(new Error("Timeout")))})),t.interval)})}},function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function a(e){try{c(o.next(e))}catch(e){r(e)}}function s(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.mailIntegrationRepliesMap=void 0;const i=n(3),r=n(9),a=n(0);t.mailIntegrationRepliesMap={loadInboxSDK:(e,t)=>o(void 0,void 0,void 0,(function*(){return yield(0,i.executeScript)("inboxSDK.js",t.tab),{success:!0}})),getGmailMessageHistory:(e,t)=>o(void 0,void 0,void 0,(function*(){const t=yield(0,r.getPageHighlightData)("gmail-"+e.data.messageId);return{success:null!=t,data:t}})),clipGmailMessage:(e,t)=>o(void 0,void 0,void 0,(function*(){return(yield(0,a.promisify)(e=>chrome.permissions.request({origins:["https://mail.google.com/*"]},e)))?{success:!0}:(alert("you need to allow previous permission to save an email\nPlease try again\n(no worry we won't read any of your emails ðŸ˜Š)"),{success:!1})}))}},function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function a(e){try{c(o.next(e))}catch(e){r(e)}}function s(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.paymentRepliesMap=void 0;const i=n(4),r=n(0);t.paymentRepliesMap={checkUserPaid:()=>o(void 0,void 0,void 0,(function*(){const e=yield i.extpay.getUser();return(0,r.print)("ok",e),e.paid})),getExtPayUser:()=>o(void 0,void 0,void 0,(function*(){return yield i.extpay.getUser()})),openPaymentPage:()=>o(void 0,void 0,void 0,(function*(){try{return yield i.extpay.openPaymentPage(),!0}catch(e){return!1}}))}},function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function a(e){try{c(o.next(e))}catch(e){r(e)}}function s(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.screenshotRepliesMap=void 0;const i=n(4),r=n(0);t.screenshotRepliesMap={asyncExecTakeScreenshot:(e,t)=>o(void 0,void 0,void 0,(function*(){return yield(0,r.promisify)(t=>{chrome.tabs.captureVisibleTab(n=>{i.asyncIds[e.asyncId]({success:null!=n,imageBase64:n}),t(!0)})}),{success:!0}})),asyncExecTakeScreenshotGetImg:(e,t)=>o(void 0,void 0,void 0,(function*(){return{success:!0,imageBase64:yield(0,r.promisify)(e=>chrome.tabs.captureVisibleTab(e))}})),asyncExecPassScreenshot:(e,t)=>o(void 0,void 0,void 0,(function*(){return i.asyncIds[e.asyncId]({success:null!=e.imageBase64,imageBase64:e.imageBase64,width:e.width,height:e.height}),null}))}},function(e,t,n){"use strict";var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,i)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&o(t,e,n);return i(t,e),t},a=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function a(e){try{c(o.next(e))}catch(e){r(e)}}function s(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((o=o.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.basicRepliesMap=void 0;const c=n(0),l=n(27),u=n(26),d=n(3),p=n(4),h=n(102),f=n(103),v=n(23),g=n(1),m=n(18),y=n(0),b=r(n(32)),_=n(15),w=n(17),C=s(n(7)),O=n(43);t.basicRepliesMap={asyncExec:e=>a(void 0,void 0,void 0,(function*(){const t=yield p.asyncIds[e.asyncId](e);return(0,c.print)("sending back",t),t})),getTabId:(e,t)=>a(void 0,void 0,void 0,(function*(){return t.tab.id})),getMetadatas:(e,t)=>a(void 0,void 0,void 0,(function*(){return yield(0,l.getCurrentPageHtmlMetaData)()})),createNewTab:(e,t)=>a(void 0,void 0,void 0,(function*(){return chrome.tabs.create({url:e.data.url}),null})),executeScript:(e,t)=>a(void 0,void 0,void 0,(function*(){yield(0,d.executeCode)(`\n    var __params = ${JSON.stringify(e.params)}; \n    `);return yield(0,d.executeScript)(e.name+".js",t.tab)})),executeActionWithResp:(e,t)=>a(void 0,void 0,void 0,(function*(){return yield(0,c.promisify)(t=>{var n;return(0,d.executeAsyncScript)(((null===(n=e.action)||void 0===n?void 0:n.action)||e.action)+".js",t,e.extraParams)})})),executeAction:(e,t)=>a(void 0,void 0,void 0,(function*(){var n,o;let i=null;"object"==typeof e.action&&"closeAndOpenUrl"==(null===(n=e.action)||void 0===n?void 0:n.action)&&(null===(o=e.action)||void 0===o?void 0:o.url)&&(i=e.action.url,e.action.action="close");const r=t.tab.id;return yield(0,u.dialogInjectAction)(e.action,r,void 0,e.mode),i&&setTimeout(()=>{chrome.tabs.create({url:e.action.url})},200),null})),notion:e=>a(void 0,void 0,void 0,(function*(){try{return{success:!0,data:yield(0,h.executeNotionScript)(e.cmd,e.params)}}catch(e){return{success:!1,errorMsg:e.toString()}}})),chromeCookiesGet:e=>a(void 0,void 0,void 0,(function*(){return(0,c.promisifyCallback)(chrome.cookies.get,e.data)})),chromeTabsQuery:e=>a(void 0,void 0,void 0,(function*(){return(0,c.promisifyCallback)(chrome.tabs.query,e.data)})),expandPopup:e=>a(void 0,void 0,void 0,(function*(){})),getDataOnPage:e=>a(void 0,void 0,void 0,(function*(){let t=yield(0,f.getCustomCss)(e.data.customs);return null!=t?t:[]})),findAllHighlightsOnPage:e=>a(void 0,void 0,void 0,(function*(){const t=yield Promise.all(e.capturedWebpage.highlights.map(e=>g.db.highlight.get(e)));(0,v.runHighlightSelection)(t)})),removeHighlightOnPage:e=>a(void 0,void 0,void 0,(function*(){yield(0,v.runRemoveSelection)(e.highlightId)})),checkUserHasTabsPermission:e=>a(void 0,void 0,void 0,(function*(){return yield(0,m.checkUserHasTabsPermission)()})),askForTabsPermission:e=>a(void 0,void 0,void 0,(function*(){return yield(0,m.askForTabsPermission)()})),askForAllUrlsAndTabsPermission:e=>a(void 0,void 0,void 0,(function*(){return yield(0,m.askForAllUrlsAndTabsPermission)()})),checkUserHasAllUrlsAndTabsPermission:e=>a(void 0,void 0,void 0,(function*(){return yield(0,m.checkUserHasAllUrlsAndTabsPermission)()})),turnOffSavedPageBadgeChecking:e=>a(void 0,void 0,void 0,(function*(){return(0,m.turnOffSavedPageBadgeChecking)()})),turnOnSavedPageBadgeChecking:e=>a(void 0,void 0,void 0,(function*(){return(0,m.turnOnSavedPageBadgeChecking)()})),turnOnCaptureFloatingButtonWatcher:e=>a(void 0,void 0,void 0,(function*(){return(0,m.startCaptureWatch)()})),turnOffCaptureFloatingButtonWatcher:(e,t)=>a(void 0,void 0,void 0,(function*(){return(0,m.stopCaptureWatch)()})),showSavedBadgeIfPossible:e=>a(void 0,void 0,void 0,(function*(){return(0,m.showSavedBadgeIfPossible)()})),turnOffClipperHeaderExpandButton:(e,t)=>a(void 0,void 0,void 0,(function*(){yield(0,y.sleep)(400),(0,u.dialogInjectAction)("turnOffClipperHeaderExpandButton",t.tab.id)})),openingQuickNoteIframe:e=>a(void 0,void 0,void 0,(function*(){return yield C.default.set("iframeOpenMode","quickNote"),!0})),clipContent:(e,t)=>a(void 0,void 0,void 0,(function*(){return(0,O.clipContent)(e.action,e.props||null,t.tab.id),!0})),quickCapture:e=>a(void 0,void 0,void 0,(function*(){})),openQuickCaptureFloatingButton:(e,t)=>a(void 0,void 0,void 0,(function*(){return(0,O.quickCapture)("openQuickCaptureFloatingButton",void 0,t.tab.id),!0})),closeQuickCaptureFloatingButton:(e,t)=>a(void 0,void 0,void 0,(function*(){return(0,O.quickCapture)("closeQuickCaptureFloatingButton",void 0,t.tab.id),!0})),openQuickCapturePopup:(e,t)=>a(void 0,void 0,void 0,(function*(){return(0,O.quickCapture)("openQuickCapturePopup",void 0,t.tab.id),!0})),closePopupQuickCapture:(e,t)=>a(void 0,void 0,void 0,(function*(){(0,O.quickCapture)("closePopupQuickCapture",void 0,t.tab.id)})),saveQuickNoteFloatingButtonPosition:e=>a(void 0,void 0,void 0,(function*(){const t=e.data.floatingPosition,n=yield g.db.user.load();return yield g.db.custom.saveUser({settings:Object.assign(Object.assign({},n.settings),{floatingQuickAddButtonOptions:{floatingPosition:t}})}),!0})),getInitialFloatingButtonPosition:e=>a(void 0,void 0,void 0,(function*(){var e;return(null===(e=(yield g.db.user.load()).settings.floatingQuickAddButtonOptions)||void 0===e?void 0:e.floatingPosition)||{left:"64px",bottom:"64px"}})),action:e=>a(void 0,void 0,void 0,(function*(){const t=e.fnName,n=e.props,{status:o,errorMsg:i,client:r}=yield(0,w.getClient)();if("error"==o)throw new Error(`incorrect '${event.type}'`);const a={notionClient:new _.NotionV3Client({token:r.authToken,activeUserId:r.agent.activeUserId}),log:c.print,db:g.db};return yield b[t](n,a)}))}},function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function a(e){try{c(o.next(e))}catch(e){r(e)}}function s(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.executeNotionScript=void 0;const i=n(9);t.executeNotionScript=function(e,t){return o(this,void 0,void 0,(function*(){const{status:n,errorMsg:o,client:r}=yield(0,i.getClient)();if("error"==n)throw new Error(`incorrect '${e}'`);if("loadPageChunk"==e)return r.agent.loadPageChunk(t[0]);if("loadUserContent"==e)return r.agent.loadUserContent(t[0]);if(!(e in r))throw`incorrect route '${e}'`;return r[e](...t)}))}},function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function a(e){try{c(o.next(e))}catch(e){r(e)}}function s(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.getCustomCss=void 0;const i=n(3);t.getCustomCss=function(e){return o(this,void 0,void 0,(function*(){return yield(0,i.executeCode)(`\n  var __save_to_notion_customs = ${JSON.stringify(e)}; \n  `),(0,i.executeScript)("getCustomCssData.js")}))}}]);